var Box2D={},Vector,Vector_a2j_Number,i;for(function(n,t){function i(){}!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(n,t,i){i.get instanceof Function&&n.__defineGetter__(t,i.get);i.set instanceof Function&&n.__defineSetter__(t,i.set)});n.inherit=function(n,t){var r=n;i.prototype=t.prototype;n.prototype=new i;n.prototype.constructor=r};n.generateCallback=function(n,t){return function(){t.apply(n,arguments)}};n.NVector=function(n){var r,i;for(n===t&&(n=0),r=new Array(n||0),i=0;i<n;++i)r[i]=0;return r};n.is=function(n,i){return n===null?!1:i instanceof Function&&n instanceof i?!0:n.constructor.__implements!=t&&n.constructor.__implements[i]?!0:!1};n.parseUInt=function(n){return Math.abs(parseInt(n))}}(Box2D),Vector=Array,Vector_a2j_Number=Box2D.NVector,typeof Box2D=="undefined"&&(Box2D={}),typeof Box2D.Collision=="undefined"&&(Box2D.Collision={}),typeof Box2D.Collision.Shapes=="undefined"&&(Box2D.Collision.Shapes={}),typeof Box2D.Common=="undefined"&&(Box2D.Common={}),typeof Box2D.Common.Math=="undefined"&&(Box2D.Common.Math={}),typeof Box2D.Dynamics=="undefined"&&(Box2D.Dynamics={}),typeof Box2D.Dynamics.Contacts=="undefined"&&(Box2D.Dynamics.Contacts={}),typeof Box2D.Dynamics.Controllers=="undefined"&&(Box2D.Dynamics.Controllers={}),typeof Box2D.Dynamics.Joints=="undefined"&&(Box2D.Dynamics.Joints={}),function(){function li(){li.b2AABB.apply(this,arguments)}function ai(){ai.b2Bound.apply(this,arguments)}function n(){n.b2BoundValues.apply(this,arguments);this.constructor===n&&this.b2BoundValues.apply(this,arguments)}function vi(){vi.b2Collision.apply(this,arguments)}function t(){t.b2ContactID.apply(this,arguments);this.constructor===t&&this.b2ContactID.apply(this,arguments)}function yi(){yi.b2ContactPoint.apply(this,arguments)}function pi(){pi.b2Distance.apply(this,arguments)}function wi(){wi.b2DistanceInput.apply(this,arguments)}function bi(){bi.b2DistanceOutput.apply(this,arguments)}function ki(){ki.b2DistanceProxy.apply(this,arguments)}function i(){i.b2DynamicTree.apply(this,arguments);this.constructor===i&&this.b2DynamicTree.apply(this,arguments)}function di(){di.b2DynamicTreeBroadPhase.apply(this,arguments)}function gi(){gi.b2DynamicTreeNode.apply(this,arguments)}function nr(){nr.b2DynamicTreePair.apply(this,arguments)}function r(){r.b2Manifold.apply(this,arguments);this.constructor===r&&this.b2Manifold.apply(this,arguments)}function u(){u.b2ManifoldPoint.apply(this,arguments);this.constructor===u&&this.b2ManifoldPoint.apply(this,arguments)}function tr(){tr.b2Point.apply(this,arguments)}function f(){f.b2RayCastInput.apply(this,arguments);this.constructor===f&&this.b2RayCastInput.apply(this,arguments)}function ir(){ir.b2RayCastOutput.apply(this,arguments)}function rr(){rr.b2Segment.apply(this,arguments)}function ur(){ur.b2SeparationFunction.apply(this,arguments)}function e(){e.b2Simplex.apply(this,arguments);this.constructor===e&&this.b2Simplex.apply(this,arguments)}function fr(){fr.b2SimplexCache.apply(this,arguments)}function er(){er.b2SimplexVertex.apply(this,arguments)}function or(){or.b2TimeOfImpact.apply(this,arguments)}function sr(){sr.b2TOIInput.apply(this,arguments)}function o(){o.b2WorldManifold.apply(this,arguments);this.constructor===o&&this.b2WorldManifold.apply(this,arguments)}function hr(){hr.ClipVertex.apply(this,arguments)}function cr(){cr.Features.apply(this,arguments)}function s(){s.b2CircleShape.apply(this,arguments);this.constructor===s&&this.b2CircleShape.apply(this,arguments)}function h(){h.b2EdgeChainDef.apply(this,arguments);this.constructor===h&&this.b2EdgeChainDef.apply(this,arguments)}function c(){c.b2EdgeShape.apply(this,arguments);this.constructor===c&&this.b2EdgeShape.apply(this,arguments)}function lr(){lr.b2MassData.apply(this,arguments)}function l(){l.b2PolygonShape.apply(this,arguments);this.constructor===l&&this.b2PolygonShape.apply(this,arguments)}function a(){a.b2Shape.apply(this,arguments);this.constructor===a&&this.b2Shape.apply(this,arguments)}function v(){v.b2Color.apply(this,arguments);this.constructor===v&&this.b2Color.apply(this,arguments)}function ar(){ar.b2Settings.apply(this,arguments)}function y(){y.b2Mat22.apply(this,arguments);this.constructor===y&&this.b2Mat22.apply(this,arguments)}function p(){p.b2Mat33.apply(this,arguments);this.constructor===p&&this.b2Mat33.apply(this,arguments)}function vr(){vr.b2Math.apply(this,arguments)}function yr(){yr.b2Sweep.apply(this,arguments)}function w(){w.b2Transform.apply(this,arguments);this.constructor===w&&this.b2Transform.apply(this,arguments)}function b(){b.b2Vec2.apply(this,arguments);this.constructor===b&&this.b2Vec2.apply(this,arguments)}function k(){k.b2Vec3.apply(this,arguments);this.constructor===k&&this.b2Vec3.apply(this,arguments)}function d(){d.b2Body.apply(this,arguments);this.constructor===d&&this.b2Body.apply(this,arguments)}function g(){g.b2BodyDef.apply(this,arguments);this.constructor===g&&this.b2BodyDef.apply(this,arguments)}function pr(){pr.b2ContactFilter.apply(this,arguments)}function wr(){wr.b2ContactImpulse.apply(this,arguments)}function br(){br.b2ContactListener.apply(this,arguments)}function nt(){nt.b2ContactManager.apply(this,arguments);this.constructor===nt&&this.b2ContactManager.apply(this,arguments)}function tt(){tt.b2DebugDraw.apply(this,arguments);this.constructor===tt&&this.b2DebugDraw.apply(this,arguments)}function kr(){kr.b2DestructionListener.apply(this,arguments)}function dr(){dr.b2FilterData.apply(this,arguments)}function it(){it.b2Fixture.apply(this,arguments);this.constructor===it&&this.b2Fixture.apply(this,arguments)}function rt(){rt.b2FixtureDef.apply(this,arguments);this.constructor===rt&&this.b2FixtureDef.apply(this,arguments)}function ut(){ut.b2Island.apply(this,arguments);this.constructor===ut&&this.b2Island.apply(this,arguments)}function gr(){gr.b2TimeStep.apply(this,arguments)}function ft(){ft.b2World.apply(this,arguments);this.constructor===ft&&this.b2World.apply(this,arguments)}function nu(){nu.b2CircleContact.apply(this,arguments)}function et(){et.b2Contact.apply(this,arguments);this.constructor===et&&this.b2Contact.apply(this,arguments)}function ot(){ot.b2ContactConstraint.apply(this,arguments);this.constructor===ot&&this.b2ContactConstraint.apply(this,arguments)}function tu(){tu.b2ContactConstraintPoint.apply(this,arguments)}function iu(){iu.b2ContactEdge.apply(this,arguments)}function st(){st.b2ContactFactory.apply(this,arguments);this.constructor===st&&this.b2ContactFactory.apply(this,arguments)}function ru(){ru.b2ContactRegister.apply(this,arguments)}function uu(){uu.b2ContactResult.apply(this,arguments)}function ht(){ht.b2ContactSolver.apply(this,arguments);this.constructor===ht&&this.b2ContactSolver.apply(this,arguments)}function fu(){fu.b2EdgeAndCircleContact.apply(this,arguments)}function ct(){ct.b2NullContact.apply(this,arguments);this.constructor===ct&&this.b2NullContact.apply(this,arguments)}function eu(){eu.b2PolyAndCircleContact.apply(this,arguments)}function ou(){ou.b2PolyAndEdgeContact.apply(this,arguments)}function su(){su.b2PolygonContact.apply(this,arguments)}function lt(){lt.b2PositionSolverManifold.apply(this,arguments);this.constructor===lt&&this.b2PositionSolverManifold.apply(this,arguments)}function hu(){hu.b2BuoyancyController.apply(this,arguments)}function cu(){cu.b2ConstantAccelController.apply(this,arguments)}function lu(){lu.b2ConstantForceController.apply(this,arguments)}function au(){au.b2Controller.apply(this,arguments)}function vu(){vu.b2ControllerEdge.apply(this,arguments)}function yu(){yu.b2GravityController.apply(this,arguments)}function pu(){pu.b2TensorDampingController.apply(this,arguments)}function at(){at.b2DistanceJoint.apply(this,arguments);this.constructor===at&&this.b2DistanceJoint.apply(this,arguments)}function vt(){vt.b2DistanceJointDef.apply(this,arguments);this.constructor===vt&&this.b2DistanceJointDef.apply(this,arguments)}function yt(){yt.b2FrictionJoint.apply(this,arguments);this.constructor===yt&&this.b2FrictionJoint.apply(this,arguments)}function pt(){pt.b2FrictionJointDef.apply(this,arguments);this.constructor===pt&&this.b2FrictionJointDef.apply(this,arguments)}function wt(){wt.b2GearJoint.apply(this,arguments);this.constructor===wt&&this.b2GearJoint.apply(this,arguments)}function bt(){bt.b2GearJointDef.apply(this,arguments);this.constructor===bt&&this.b2GearJointDef.apply(this,arguments)}function wu(){wu.b2Jacobian.apply(this,arguments)}function kt(){kt.b2Joint.apply(this,arguments);this.constructor===kt&&this.b2Joint.apply(this,arguments)}function dt(){dt.b2JointDef.apply(this,arguments);this.constructor===dt&&this.b2JointDef.apply(this,arguments)}function bu(){bu.b2JointEdge.apply(this,arguments)}function gt(){gt.b2LineJoint.apply(this,arguments);this.constructor===gt&&this.b2LineJoint.apply(this,arguments)}function ni(){ni.b2LineJointDef.apply(this,arguments);this.constructor===ni&&this.b2LineJointDef.apply(this,arguments)}function ti(){ti.b2MouseJoint.apply(this,arguments);this.constructor===ti&&this.b2MouseJoint.apply(this,arguments)}function ii(){ii.b2MouseJointDef.apply(this,arguments);this.constructor===ii&&this.b2MouseJointDef.apply(this,arguments)}function ri(){ri.b2PrismaticJoint.apply(this,arguments);this.constructor===ri&&this.b2PrismaticJoint.apply(this,arguments)}function ui(){ui.b2PrismaticJointDef.apply(this,arguments);this.constructor===ui&&this.b2PrismaticJointDef.apply(this,arguments)}function fi(){fi.b2PulleyJoint.apply(this,arguments);this.constructor===fi&&this.b2PulleyJoint.apply(this,arguments)}function ei(){ei.b2PulleyJointDef.apply(this,arguments);this.constructor===ei&&this.b2PulleyJointDef.apply(this,arguments)}function oi(){oi.b2RevoluteJoint.apply(this,arguments);this.constructor===oi&&this.b2RevoluteJoint.apply(this,arguments)}function si(){si.b2RevoluteJointDef.apply(this,arguments);this.constructor===si&&this.b2RevoluteJointDef.apply(this,arguments)}function hi(){hi.b2WeldJoint.apply(this,arguments);this.constructor===hi&&this.b2WeldJoint.apply(this,arguments)}function ci(){ci.b2WeldJointDef.apply(this,arguments);this.constructor===ci&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";Box2D.Collision.b2AABB=li;Box2D.Collision.b2Bound=ai;Box2D.Collision.b2BoundValues=n;Box2D.Collision.b2Collision=vi;Box2D.Collision.b2ContactID=t;Box2D.Collision.b2ContactPoint=yi;Box2D.Collision.b2Distance=pi;Box2D.Collision.b2DistanceInput=wi;Box2D.Collision.b2DistanceOutput=bi;Box2D.Collision.b2DistanceProxy=ki;Box2D.Collision.b2DynamicTree=i;Box2D.Collision.b2DynamicTreeBroadPhase=di;Box2D.Collision.b2DynamicTreeNode=gi;Box2D.Collision.b2DynamicTreePair=nr;Box2D.Collision.b2Manifold=r;Box2D.Collision.b2ManifoldPoint=u;Box2D.Collision.b2Point=tr;Box2D.Collision.b2RayCastInput=f;Box2D.Collision.b2RayCastOutput=ir;Box2D.Collision.b2Segment=rr;Box2D.Collision.b2SeparationFunction=ur;Box2D.Collision.b2Simplex=e;Box2D.Collision.b2SimplexCache=fr;Box2D.Collision.b2SimplexVertex=er;Box2D.Collision.b2TimeOfImpact=or;Box2D.Collision.b2TOIInput=sr;Box2D.Collision.b2WorldManifold=o;Box2D.Collision.ClipVertex=hr;Box2D.Collision.Features=cr;Box2D.Collision.Shapes.b2CircleShape=s;Box2D.Collision.Shapes.b2EdgeChainDef=h;Box2D.Collision.Shapes.b2EdgeShape=c;Box2D.Collision.Shapes.b2MassData=lr;Box2D.Collision.Shapes.b2PolygonShape=l;Box2D.Collision.Shapes.b2Shape=a;Box2D.Common.b2internal="Box2D.Common.b2internal";Box2D.Common.b2Color=v;Box2D.Common.b2Settings=ar;Box2D.Common.Math.b2Mat22=y;Box2D.Common.Math.b2Mat33=p;Box2D.Common.Math.b2Math=vr;Box2D.Common.Math.b2Sweep=yr;Box2D.Common.Math.b2Transform=w;Box2D.Common.Math.b2Vec2=b;Box2D.Common.Math.b2Vec3=k;Box2D.Dynamics.b2Body=d;Box2D.Dynamics.b2BodyDef=g;Box2D.Dynamics.b2ContactFilter=pr;Box2D.Dynamics.b2ContactImpulse=wr;Box2D.Dynamics.b2ContactListener=br;Box2D.Dynamics.b2ContactManager=nt;Box2D.Dynamics.b2DebugDraw=tt;Box2D.Dynamics.b2DestructionListener=kr;Box2D.Dynamics.b2FilterData=dr;Box2D.Dynamics.b2Fixture=it;Box2D.Dynamics.b2FixtureDef=rt;Box2D.Dynamics.b2Island=ut;Box2D.Dynamics.b2TimeStep=gr;Box2D.Dynamics.b2World=ft;Box2D.Dynamics.Contacts.b2CircleContact=nu;Box2D.Dynamics.Contacts.b2Contact=et;Box2D.Dynamics.Contacts.b2ContactConstraint=ot;Box2D.Dynamics.Contacts.b2ContactConstraintPoint=tu;Box2D.Dynamics.Contacts.b2ContactEdge=iu;Box2D.Dynamics.Contacts.b2ContactFactory=st;Box2D.Dynamics.Contacts.b2ContactRegister=ru;Box2D.Dynamics.Contacts.b2ContactResult=uu;Box2D.Dynamics.Contacts.b2ContactSolver=ht;Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=fu;Box2D.Dynamics.Contacts.b2NullContact=ct;Box2D.Dynamics.Contacts.b2PolyAndCircleContact=eu;Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=ou;Box2D.Dynamics.Contacts.b2PolygonContact=su;Box2D.Dynamics.Contacts.b2PositionSolverManifold=lt;Box2D.Dynamics.Controllers.b2BuoyancyController=hu;Box2D.Dynamics.Controllers.b2ConstantAccelController=cu;Box2D.Dynamics.Controllers.b2ConstantForceController=lu;Box2D.Dynamics.Controllers.b2Controller=au;Box2D.Dynamics.Controllers.b2ControllerEdge=vu;Box2D.Dynamics.Controllers.b2GravityController=yu;Box2D.Dynamics.Controllers.b2TensorDampingController=pu;Box2D.Dynamics.Joints.b2DistanceJoint=at;Box2D.Dynamics.Joints.b2DistanceJointDef=vt;Box2D.Dynamics.Joints.b2FrictionJoint=yt;Box2D.Dynamics.Joints.b2FrictionJointDef=pt;Box2D.Dynamics.Joints.b2GearJoint=wt;Box2D.Dynamics.Joints.b2GearJointDef=bt;Box2D.Dynamics.Joints.b2Jacobian=wu;Box2D.Dynamics.Joints.b2Joint=kt;Box2D.Dynamics.Joints.b2JointDef=dt;Box2D.Dynamics.Joints.b2JointEdge=bu;Box2D.Dynamics.Joints.b2LineJoint=gt;Box2D.Dynamics.Joints.b2LineJointDef=ni;Box2D.Dynamics.Joints.b2MouseJoint=ti;Box2D.Dynamics.Joints.b2MouseJointDef=ii;Box2D.Dynamics.Joints.b2PrismaticJoint=ri;Box2D.Dynamics.Joints.b2PrismaticJointDef=ui;Box2D.Dynamics.Joints.b2PulleyJoint=fi;Box2D.Dynamics.Joints.b2PulleyJointDef=ei;Box2D.Dynamics.Joints.b2RevoluteJoint=oi;Box2D.Dynamics.Joints.b2RevoluteJointDef=si;Box2D.Dynamics.Joints.b2WeldJoint=hi;Box2D.Dynamics.Joints.b2WeldJointDef=ci}(),Box2D.postDefs=[],function(){var lt=Box2D.Collision.Shapes.b2CircleShape,bt=Box2D.Collision.Shapes.b2EdgeChainDef,kt=Box2D.Collision.Shapes.b2EdgeShape,dt=Box2D.Collision.Shapes.b2MassData,at=Box2D.Collision.Shapes.b2PolygonShape,rt=Box2D.Collision.Shapes.b2Shape,gt=Box2D.Common.b2Color,ni=Box2D.Common.b2internal,u=Box2D.Common.b2Settings,ti=Box2D.Common.Math.b2Mat22,ii=Box2D.Common.Math.b2Mat33,n=Box2D.Common.Math.b2Math,ut=Box2D.Common.Math.b2Sweep,ft=Box2D.Common.Math.b2Transform,i=Box2D.Common.Math.b2Vec2,ri=Box2D.Common.Math.b2Vec3,s=Box2D.Collision.b2AABB,k=Box2D.Collision.b2Bound,et=Box2D.Collision.b2BoundValues,r=Box2D.Collision.b2Collision,l=Box2D.Collision.b2ContactID,vt=Box2D.Collision.b2ContactPoint,a=Box2D.Collision.b2Distance,ot=Box2D.Collision.b2DistanceInput,st=Box2D.Collision.b2DistanceOutput,y=Box2D.Collision.b2DistanceProxy,o=Box2D.Collision.b2DynamicTree,f=Box2D.Collision.b2DynamicTreeBroadPhase,g=Box2D.Collision.b2DynamicTreeNode,ht=Box2D.Collision.b2DynamicTreePair,e=Box2D.Collision.b2Manifold,p=Box2D.Collision.b2ManifoldPoint,nt=Box2D.Collision.b2Point,tt=Box2D.Collision.b2RayCastInput,yt=Box2D.Collision.b2RayCastOutput,w=Box2D.Collision.b2Segment,h=Box2D.Collision.b2SeparationFunction,c=Box2D.Collision.b2Simplex,ct=Box2D.Collision.b2SimplexCache,b=Box2D.Collision.b2SimplexVertex,t=Box2D.Collision.b2TimeOfImpact,pt=Box2D.Collision.b2TOIInput,it=Box2D.Collision.b2WorldManifold,d=Box2D.Collision.ClipVertex,v=Box2D.Collision.Features,wt=Box2D.Collision.IBroadPhase;s.b2AABB=function(){this.lowerBound=new i;this.upperBound=new i};s.prototype.IsValid=function(){var n=this.upperBound.x-this.lowerBound.x,t=this.upperBound.y-this.lowerBound.y,i=n>=0&&t>=0;return i&&this.lowerBound.IsValid()&&this.upperBound.IsValid()};s.prototype.GetCenter=function(){return new i((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};s.prototype.GetExtents=function(){return new i((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};s.prototype.Contains=function(n){var t=!0;return t=t&&this.lowerBound.x<=n.lowerBound.x,t=t&&this.lowerBound.y<=n.lowerBound.y,t=t&&n.upperBound.x<=this.upperBound.x,t&&n.upperBound.y<=this.upperBound.y};s.prototype.RayCast=function(n,t){var u=-Number.MAX_VALUE,f=Number.MAX_VALUE,s=t.p1.x,h=t.p1.y,a=t.p2.x-t.p1.x,v=t.p2.y-t.p1.y,y=Math.abs(a),p=Math.abs(v),c=n.normal,e=0,i=0,r=0,l=0,o=0;if(y<Number.MIN_VALUE){if(s<this.lowerBound.x||this.upperBound.x<s)return!1}else if(e=1/a,i=(this.lowerBound.x-s)*e,r=(this.upperBound.x-s)*e,o=-1,i>r&&(l=i,i=r,r=l,o=1),i>u&&(c.x=o,c.y=0,u=i),f=Math.min(f,r),u>f)return!1;if(p<Number.MIN_VALUE){if(h<this.lowerBound.y||this.upperBound.y<h)return!1}else if(e=1/v,i=(this.lowerBound.y-h)*e,r=(this.upperBound.y-h)*e,o=-1,i>r&&(l=i,i=r,r=l,o=1),i>u&&(c.y=o,c.x=0,u=i),f=Math.min(f,r),u>f)return!1;return n.fraction=u,!0};s.prototype.TestOverlap=function(n){var t=n.lowerBound.x-this.upperBound.x,i=n.lowerBound.y-this.upperBound.y,r=this.lowerBound.x-n.upperBound.x,u=this.lowerBound.y-n.upperBound.y;return t>0||i>0?!1:r>0||u>0?!1:!0};s.Combine=function(n,t){var i=new s;return i.Combine(n,t),i};s.prototype.Combine=function(n,t){this.lowerBound.x=Math.min(n.lowerBound.x,t.lowerBound.x);this.lowerBound.y=Math.min(n.lowerBound.y,t.lowerBound.y);this.upperBound.x=Math.max(n.upperBound.x,t.upperBound.x);this.upperBound.y=Math.max(n.upperBound.y,t.upperBound.y)};k.b2Bound=function(){};k.prototype.IsLower=function(){return(this.value&1)==0};k.prototype.IsUpper=function(){return(this.value&1)==1};k.prototype.Swap=function(n){var t=this.value,i=this.proxy,r=this.stabbingCount;this.value=n.value;this.proxy=n.proxy;this.stabbingCount=n.stabbingCount;n.value=t;n.proxy=i;n.stabbingCount=r};et.b2BoundValues=function(){};et.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number;this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=new Vector_a2j_Number;this.upperValues[0]=0;this.upperValues[1]=0};r.b2Collision=function(){};r.ClipSegmentToLine=function(n,t,i,r){var u,f,e,l,a,h;r===undefined&&(r=0);f=0;u=t[0];e=u.v;u=t[1];var s=u.v,o=i.x*e.x+i.y*e.y-r,c=i.x*s.x+i.y*s.y-r;return o<=0&&n[f++].Set(t[0]),c<=0&&n[f++].Set(t[1]),o*c<0&&(l=o/(o-c),u=n[f],a=u.v,a.x=e.x+l*(s.x-e.x),a.y=e.y+l*(s.y-e.y),u=n[f],o>0?(h=t[0],u.id=h.id):(h=t[1],u.id=h.id),++f),f};r.EdgeSeparation=function(n,t,i,r,u){var s,h,o,c,w,b,l,a;i===undefined&&(i=0);var it=parseInt(n.m_vertexCount),k=n.m_vertices,d=n.m_normals,g=parseInt(r.m_vertexCount),v=r.m_vertices,f,e;f=t.R;e=d[i];s=f.col1.x*e.x+f.col2.x*e.y;h=f.col1.y*e.x+f.col2.y*e.y;f=u.R;var nt=f.col1.x*s+f.col1.y*h,tt=f.col2.x*s+f.col2.y*h,y=0,p=Number.MAX_VALUE;for(o=0;o<g;++o)e=v[o],c=e.x*nt+e.y*tt,c<p&&(p=c,y=o);return e=k[i],f=t.R,w=t.position.x+(f.col1.x*e.x+f.col2.x*e.y),b=t.position.y+(f.col1.y*e.x+f.col2.y*e.y),e=v[y],f=u.R,l=u.position.x+(f.col1.x*e.x+f.col2.x*e.y),a=u.position.y+(f.col1.y*e.x+f.col2.y*e.y),l-=w,a-=b,l*s+a*h};r.FindMaxSeparation=function(n,t,i,u,f){var l=parseInt(t.m_vertexCount),it=t.m_normals,e,o,y,p,a,w;o=f.R;e=u.m_centroid;y=f.position.x+(o.col1.x*e.x+o.col2.x*e.y);p=f.position.y+(o.col1.y*e.x+o.col2.y*e.y);o=i.R;e=t.m_centroid;y-=i.position.x+(o.col1.x*e.x+o.col2.x*e.y);p-=i.position.y+(o.col1.y*e.x+o.col2.y*e.y);var rt=y*i.R.col1.x+p*i.R.col1.y,ut=y*i.R.col2.x+p*i.R.col2.y,s=0,g=-Number.MAX_VALUE;for(a=0;a<l;++a)e=it[a],w=e.x*rt+e.y*ut,w>g&&(g=w,s=a);var c=r.EdgeSeparation(t,i,s,u,f),nt=parseInt(s-1>=0?s-1:l-1),b=r.EdgeSeparation(t,i,nt,u,f),tt=parseInt(s+1<l?s+1:0),k=r.EdgeSeparation(t,i,tt,u,f),h=0,v=0,d=0;if(b>c&&b>k)d=-1,h=nt,v=b;else if(k>c)d=1,h=tt,v=k;else return n[0]=s,c;for(;;)if(s=d==-1?h-1>=0?h-1:l-1:h+1<l?h+1:0,c=r.EdgeSeparation(t,i,s,u,f),c>v)h=s,v=c;else break;return n[0]=h,v};r.FindIncidentEdge=function(n,t,i,r,u,f){var h,c,d,v,y,l,p,s,a,w;r===undefined&&(r=0);var tt=parseInt(t.m_vertexCount),g=t.m_normals,b=parseInt(u.m_vertexCount),k=u.m_vertices,nt=u.m_normals,e,o;for(e=i.R,o=g[r],h=e.col1.x*o.x+e.col2.x*o.y,c=e.col1.y*o.x+e.col2.y*o.y,e=f.R,d=e.col1.x*h+e.col1.y*c,c=e.col2.x*h+e.col2.y*c,h=d,v=0,y=Number.MAX_VALUE,l=0;l<b;++l)o=nt[l],p=h*o.x+c*o.y,p<y&&(y=p,v=l);a=parseInt(v);w=parseInt(a+1<b?a+1:0);s=n[0];o=k[a];e=f.R;s.v.x=f.position.x+(e.col1.x*o.x+e.col2.x*o.y);s.v.y=f.position.y+(e.col1.y*o.x+e.col2.y*o.y);s.id.features.referenceEdge=r;s.id.features.incidentEdge=a;s.id.features.incidentVertex=0;s=n[1];o=k[w];e=f.R;s.v.x=f.position.x+(e.col1.x*o.x+e.col2.x*o.y);s.v.y=f.position.y+(e.col1.y*o.x+e.col2.y*o.y);s.id.features.referenceEdge=r;s.id.features.incidentEdge=w;s.id.features.incidentVertex=1};r.MakeClipPointVector=function(){var n=new Vector(2);return n[0]=new d,n[1]=new d,n};r.CollidePolygons=function(n,t,i,f,o){var w,b,it,ht,rt,ct,vt,l,ut,pt,h,ft,y,p,nt,ot,st,gt,tt,wt,bt;if((n.m_pointCount=0,b=t.m_radius+f.m_radius,it=0,r.s_edgeAO[0]=it,ht=r.FindMaxSeparation(r.s_edgeAO,t,i,f,o),it=r.s_edgeAO[0],!(ht>b))&&(rt=0,r.s_edgeBO[0]=rt,ct=r.FindMaxSeparation(r.s_edgeBO,f,o,t,i),rt=r.s_edgeBO[0],!(ct>b))){var g,lt,a,k,d=0,at=0,s;ct>.98*ht+.001?(g=f,lt=t,a=o,k=i,d=rt,n.m_type=e.e_faceB,at=1):(g=t,lt=f,a=i,k=o,d=it,n.m_type=e.e_faceA,at=0);vt=r.s_incidentEdge;r.FindIncidentEdge(vt,g,a,d,lt,k);var ni=parseInt(g.m_vertexCount),yt=g.m_vertices,v=yt[d],c;c=d+1<ni?yt[parseInt(d+1)]:yt[0];l=r.s_localTangent;l.Set(c.x-v.x,c.y-v.y);l.Normalize();ut=r.s_localNormal;ut.x=l.y;ut.y=-l.x;pt=r.s_planePoint;pt.Set(.5*(v.x+c.x),.5*(v.y+c.y));h=r.s_tangent;s=a.R;h.x=s.col1.x*l.x+s.col2.x*l.y;h.y=s.col1.y*l.x+s.col2.y*l.y;ft=r.s_tangent2;ft.x=-h.x;ft.y=-h.y;y=r.s_normal;y.x=h.y;y.y=-h.x;p=r.s_v11;nt=r.s_v12;p.x=a.position.x+(s.col1.x*v.x+s.col2.x*v.y);p.y=a.position.y+(s.col1.y*v.x+s.col2.y*v.y);nt.x=a.position.x+(s.col1.x*c.x+s.col2.x*c.y);nt.y=a.position.y+(s.col1.y*c.x+s.col2.y*c.y);var ti=y.x*p.x+y.y*p.y,ii=-h.x*p.x-h.y*p.y+b,ri=h.x*nt.x+h.y*nt.y+b,kt=r.s_clipPoints1,dt=r.s_clipPoints2,et=0;if((et=r.ClipSegmentToLine(kt,vt,ft,ii),!(et<2))&&(et=r.ClipSegmentToLine(dt,kt,h,ri),!(et<2))){for(n.m_localPlaneNormal.SetV(ut),n.m_localPoint.SetV(pt),ot=0,st=0;st<u.b2_maxManifoldPoints;++st)w=dt[st],gt=y.x*w.v.x+y.y*w.v.y-ti,gt<=b&&(tt=n.m_points[ot],s=k.R,wt=w.v.x-k.position.x,bt=w.v.y-k.position.y,tt.m_localPoint.x=wt*s.col1.x+bt*s.col1.y,tt.m_localPoint.y=wt*s.col2.x+bt*s.col2.y,tt.m_id.Set(w.id),tt.m_id.features.flip=at,++ot);n.m_pointCount=ot}}};r.CollideCircles=function(n,t,i,r,u){var f,o,s,h;n.m_pointCount=0;f=i.R;o=t.m_p;s=i.position.x+(f.col1.x*o.x+f.col2.x*o.y);h=i.position.y+(f.col1.y*o.x+f.col2.y*o.y);f=u.R;o=r.m_p;var v=u.position.x+(f.col1.x*o.x+f.col2.x*o.y),y=u.position.y+(f.col1.y*o.x+f.col2.y*o.y),c=v-s,l=y-h,p=c*c+l*l,a=t.m_radius+r.m_radius;p>a*a||(n.m_type=e.e_circles,n.m_localPoint.SetV(t.m_p),n.m_localPlaneNormal.SetZero(),n.m_pointCount=1,n.m_points[0].m_localPoint.SetV(r.m_p),n.m_points[0].m_id.key=0)};r.CollidePolygonAndCircle=function(n,t,i,r,u){var rt,ut,p,d,et,ot,tt,it;n.m_pointCount=0;var w=0,b=0,s,h;h=u.R;s=r.m_p;rt=u.position.x+(h.col1.x*s.x+h.col2.x*s.y);ut=u.position.y+(h.col1.y*s.x+h.col2.y*s.y);w=rt-i.position.x;b=ut-i.position.y;h=i.R;var c=w*h.col1.x+b*h.col1.y,l=w*h.col2.x+b*h.col2.y,g=0,k=-Number.MAX_VALUE,v=t.m_radius+r.m_radius,ft=parseInt(t.m_vertexCount),nt=t.m_vertices,y=t.m_normals;for(p=0;p<ft;++p){if(s=nt[p],w=c-s.x,b=l-s.y,s=y[p],d=s.x*w+s.y*b,d>v)return;d>k&&(k=d,g=p)}var a=parseInt(g),st=parseInt(a+1<ft?a+1:0),f=nt[a],o=nt[st];if(k<Number.MIN_VALUE){n.m_pointCount=1;n.m_type=e.e_faceA;n.m_localPlaneNormal.SetV(y[g]);n.m_localPoint.x=.5*(f.x+o.x);n.m_localPoint.y=.5*(f.y+o.y);n.m_points[0].m_localPoint.SetV(r.m_p);n.m_points[0].m_id.key=0;return}if(et=(c-f.x)*(o.x-f.x)+(l-f.y)*(o.y-f.y),ot=(c-o.x)*(f.x-o.x)+(l-o.y)*(f.y-o.y),et<=0){if((c-f.x)*(c-f.x)+(l-f.y)*(l-f.y)>v*v)return;n.m_pointCount=1;n.m_type=e.e_faceA;n.m_localPlaneNormal.x=c-f.x;n.m_localPlaneNormal.y=l-f.y;n.m_localPlaneNormal.Normalize();n.m_localPoint.SetV(f);n.m_points[0].m_localPoint.SetV(r.m_p);n.m_points[0].m_id.key=0}else if(ot<=0){if((c-o.x)*(c-o.x)+(l-o.y)*(l-o.y)>v*v)return;n.m_pointCount=1;n.m_type=e.e_faceA;n.m_localPlaneNormal.x=c-o.x;n.m_localPlaneNormal.y=l-o.y;n.m_localPlaneNormal.Normalize();n.m_localPoint.SetV(o);n.m_points[0].m_localPoint.SetV(r.m_p);n.m_points[0].m_id.key=0}else{if(tt=.5*(f.x+o.x),it=.5*(f.y+o.y),k=(c-tt)*y[a].x+(l-it)*y[a].y,k>v)return;n.m_pointCount=1;n.m_type=e.e_faceA;n.m_localPlaneNormal.x=y[a].x;n.m_localPlaneNormal.y=y[a].y;n.m_localPlaneNormal.Normalize();n.m_localPoint.Set(tt,it);n.m_points[0].m_localPoint.SetV(r.m_p);n.m_points[0].m_id.key=0}};r.TestOverlap=function(n,t){var i=t.lowerBound,r=n.upperBound,e=i.x-r.x,o=i.y-r.y,u,f;return(i=n.lowerBound,r=t.upperBound,u=i.x-r.x,f=i.y-r.y,e>0||o>0)?!1:u>0||f>0?!1:!0};Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=r.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints1=r.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints2=r.MakeClipPointVector();Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_localTangent=new i;Box2D.Collision.b2Collision.s_localNormal=new i;Box2D.Collision.b2Collision.s_planePoint=new i;Box2D.Collision.b2Collision.s_normal=new i;Box2D.Collision.b2Collision.s_tangent=new i;Box2D.Collision.b2Collision.s_tangent2=new i;Box2D.Collision.b2Collision.s_v11=new i;Box2D.Collision.b2Collision.s_v12=new i;Box2D.Collision.b2Collision.b2CollidePolyTempVec=new i;Box2D.Collision.b2Collision.b2_nullFeature=255});l.b2ContactID=function(){this.features=new v};l.prototype.b2ContactID=function(){this.features._m_id=this};l.prototype.Set=function(n){this.key=n._key};l.prototype.Copy=function(){var n=new l;return n.key=this.key,n};Object.defineProperty(l.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}});Object.defineProperty(l.prototype,"key",{enumerable:!1,configurable:!0,set:function(n){n===undefined&&(n=0);this._key=n;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}});vt.b2ContactPoint=function(){this.position=new i;this.velocity=new i;this.normal=new i;this.id=new l};a.b2Distance=function(){};a.Distance=function(t,r,f){var b,s,rt,l,v,c;++a.b2_gjkCalls;var y=f.proxyA,p=f.proxyB,k=f.transformA,d=f.transformB,e=a.s_simplex;e.ReadCache(r,y,k,p,d);for(var g=e.m_vertices,ut=a.s_saveA,ft=a.s_saveB,nt=0,et=e.GetClosestPoint(),tt=et.LengthSquared(),it=tt,o=0,h,w=0;w<20;){for(nt=e.m_count,o=0;o<nt;o++)ut[o]=g[o].indexA,ft[o]=g[o].indexB;switch(e.m_count){case 1:break;case 2:e.Solve2();break;case 3:e.Solve3();break;default:u.b2Assert(!1)}if(e.m_count==3)break;if(h=e.GetClosestPoint(),it=h.LengthSquared(),it>tt,tt=it,b=e.GetSearchDirection(),b.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;for(s=g[e.m_count],s.indexA=y.GetSupport(n.MulTMV(k.R,b.GetNegative())),s.wA=n.MulX(k,y.GetVertex(s.indexA)),s.indexB=p.GetSupport(n.MulTMV(d.R,b)),s.wB=n.MulX(d,p.GetVertex(s.indexB)),s.w=n.SubtractVV(s.wB,s.wA),++w,++a.b2_gjkIters,rt=!1,o=0;o<nt;o++)if(s.indexA==ut[o]&&s.indexB==ft[o]){rt=!0;break}if(rt)break;++e.m_count}a.b2_gjkMaxIters=n.Max(a.b2_gjkMaxIters,w);e.GetWitnessPoints(t.pointA,t.pointB);t.distance=n.SubtractVV(t.pointA,t.pointB).Length();t.iterations=w;e.WriteCache(r);f.useRadii&&(l=y.m_radius,v=p.m_radius,t.distance>l+v&&t.distance>Number.MIN_VALUE?(t.distance-=l+v,c=n.SubtractVV(t.pointB,t.pointA),c.Normalize(),t.pointA.x+=l*c.x,t.pointA.y+=l*c.y,t.pointB.x-=v*c.x,t.pointB.y-=v*c.y):(h=new i,h.x=.5*(t.pointA.x+t.pointB.x),h.y=.5*(t.pointA.y+t.pointB.y),t.pointA.x=t.pointB.x=h.x,t.pointA.y=t.pointB.y=h.y,t.distance=0))};Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new c;Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3);Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)});ot.b2DistanceInput=function(){};st.b2DistanceOutput=function(){this.pointA=new i;this.pointB=new i};y.b2DistanceProxy=function(){};y.prototype.Set=function(n){var i,t;switch(n.GetType()){case rt.e_circleShape:i=n instanceof lt?n:null;this.m_vertices=new Vector(1,!0);this.m_vertices[0]=i.m_p;this.m_count=1;this.m_radius=i.m_radius;break;case rt.e_polygonShape:t=n instanceof at?n:null;this.m_vertices=t.m_vertices;this.m_count=t.m_vertexCount;this.m_radius=t.m_radius;break;default:u.b2Assert(!1)}};y.prototype.GetSupport=function(n){for(var i,r=0,u=this.m_vertices[0].x*n.x+this.m_vertices[0].y*n.y,t=1;t<this.m_count;++t)i=this.m_vertices[t].x*n.x+this.m_vertices[t].y*n.y,i>u&&(r=t,u=i);return r};y.prototype.GetSupportVertex=function(n){for(var i,r=0,u=this.m_vertices[0].x*n.x+this.m_vertices[0].y*n.y,t=1;t<this.m_count;++t)i=this.m_vertices[t].x*n.x+this.m_vertices[t].y*n.y,i>u&&(r=t,u=i);return this.m_vertices[r]};y.prototype.GetVertexCount=function(){return this.m_count};y.prototype.GetVertex=function(n){return n===undefined&&(n=0),u.b2Assert(0<=n&&n<this.m_count),this.m_vertices[n]};o.b2DynamicTree=function(){};o.prototype.b2DynamicTree=function(){this.m_root=null;this.m_freeList=null;this.m_path=0;this.m_insertionCount=0};o.prototype.CreateProxy=function(n,t){var i=this.AllocateNode(),r=u.b2_aabbExtension,f=u.b2_aabbExtension;return i.aabb.lowerBound.x=n.lowerBound.x-r,i.aabb.lowerBound.y=n.lowerBound.y-f,i.aabb.upperBound.x=n.upperBound.x+r,i.aabb.upperBound.y=n.upperBound.y+f,i.userData=t,this.InsertLeaf(i),i};o.prototype.DestroyProxy=function(n){this.RemoveLeaf(n);this.FreeNode(n)};o.prototype.MoveProxy=function(n,t,i){if(u.b2Assert(n.IsLeaf()),n.aabb.Contains(t))return!1;this.RemoveLeaf(n);var r=u.b2_aabbExtension+u.b2_aabbMultiplier*(i.x>0?i.x:-i.x),f=u.b2_aabbExtension+u.b2_aabbMultiplier*(i.y>0?i.y:-i.y);return n.aabb.lowerBound.x=t.lowerBound.x-r,n.aabb.lowerBound.y=t.lowerBound.y-f,n.aabb.upperBound.x=t.upperBound.x+r,n.aabb.upperBound.y=t.upperBound.y+f,this.InsertLeaf(n),!0};o.prototype.Rebalance=function(n){var r,t,i;if(n===undefined&&(n=0),this.m_root!=null)for(r=0;r<n;r++){for(t=this.m_root,i=0;t.IsLeaf()==!1;)t=this.m_path>>i&1?t.child2:t.child1,i=i+1&31;++this.m_path;this.RemoveLeaf(t);this.InsertLeaf(t)}};o.prototype.GetFatAABB=function(n){return n.aabb};o.prototype.GetUserData=function(n){return n.userData};o.prototype.Query=function(n,t){var u,i,r,f;if(this.m_root!=null)for(u=new Vector,i=0,u[i++]=this.m_root;i>0;)if(r=u[--i],r.aabb.TestOverlap(t))if(r.IsLeaf()){if(f=n(r),!f)return}else u[i++]=r.child1,u[i++]=r.child2};o.prototype.RayCast=function(t,i){var a,c,f,v;if(this.m_root!=null){var r=i.p1,l=i.p2,p=n.SubtractVV(r,l);p.Normalize();var y=n.CrossFV(1,p),w=n.AbsV(y),e=i.maxFraction,u=new s,o=0,h=0;for(o=r.x+e*(l.x-r.x),h=r.y+e*(l.y-r.y),u.lowerBound.x=Math.min(r.x,o),u.lowerBound.y=Math.min(r.y,h),u.upperBound.x=Math.max(r.x,o),u.upperBound.y=Math.max(r.y,h),a=new Vector,c=0,a[c++]=this.m_root;c>0;)if(f=a[--c],f.aabb.TestOverlap(u)!=!1){var b=f.aabb.GetCenter(),k=f.aabb.GetExtents(),d=Math.abs(y.x*(r.x-b.x)+y.y*(r.y-b.y))-w.x*k.x-w.y*k.y;if(!(d>0))if(f.IsLeaf()){if(v=new tt,v.p1=i.p1,v.p2=i.p2,v.maxFraction=i.maxFraction,e=t(v,f),e==0)return;e>0&&(o=r.x+e*(l.x-r.x),h=r.y+e*(l.y-r.y),u.lowerBound.x=Math.min(r.x,o),u.lowerBound.y=Math.min(r.y,h),u.upperBound.x=Math.max(r.x,o),u.upperBound.y=Math.max(r.y,h))}else a[c++]=f.child1,a[c++]=f.child2}}};o.prototype.AllocateNode=function(){if(this.m_freeList){var n=this.m_freeList;return this.m_freeList=n.parent,n.parent=null,n.child1=null,n.child2=null,n}return new g};o.prototype.FreeNode=function(n){n.parent=this.m_freeList;this.m_freeList=n};o.prototype.InsertLeaf=function(n){var u,i,r,t;if(++this.m_insertionCount,this.m_root==null){this.m_root=n;this.m_root.parent=null;return}if(u=n.aabb.GetCenter(),i=this.m_root,i.IsLeaf()==!1)do{var f=i.child1,e=i.child2,o=Math.abs((f.aabb.lowerBound.x+f.aabb.upperBound.x)/2-u.x)+Math.abs((f.aabb.lowerBound.y+f.aabb.upperBound.y)/2-u.y),s=Math.abs((e.aabb.lowerBound.x+e.aabb.upperBound.x)/2-u.x)+Math.abs((e.aabb.lowerBound.y+e.aabb.upperBound.y)/2-u.y);i=o<s?f:e}while(i.IsLeaf()==!1);if(r=i.parent,t=this.AllocateNode(),t.parent=r,t.userData=null,t.aabb.Combine(n.aabb,i.aabb),r){i.parent.child1==i?r.child1=t:r.child2=t;t.child1=i;t.child2=n;i.parent=t;n.parent=t;do{if(r.aabb.Contains(t.aabb))break;r.aabb.Combine(r.child1.aabb,r.child2.aabb);t=r;r=r.parent}while(r)}else t.child1=i,t.child2=n,i.parent=t,n.parent=t,this.m_root=t};o.prototype.RemoveLeaf=function(n){var i,t,r,u;if(n==this.m_root){this.m_root=null;return}if(i=n.parent,t=i.parent,r=i.child1==n?i.child2:i.child1,t)for(t.child1==i?t.child1=r:t.child2=r,r.parent=t,this.FreeNode(i);t;){if(u=t.aabb,t.aabb=s.Combine(t.child1.aabb,t.child2.aabb),u.Contains(t.aabb))break;t=t.parent}else this.m_root=r,r.parent=null,this.FreeNode(i)};f.b2DynamicTreeBroadPhase=function(){this.m_tree=new o;this.m_moveBuffer=new Vector;this.m_pairBuffer=new Vector;this.m_pairCount=0};f.prototype.CreateProxy=function(n,t){var i=this.m_tree.CreateProxy(n,t);return++this.m_proxyCount,this.BufferMove(i),i};f.prototype.DestroyProxy=function(n){this.UnBufferMove(n);--this.m_proxyCount;this.m_tree.DestroyProxy(n)};f.prototype.MoveProxy=function(n,t,i){var r=this.m_tree.MoveProxy(n,t,i);r&&this.BufferMove(n)};f.prototype.TestOverlap=function(n,t){var i=this.m_tree.GetFatAABB(n),r=this.m_tree.GetFatAABB(t);return i.TestOverlap(r)};f.prototype.GetUserData=function(n){return this.m_tree.GetUserData(n)};f.prototype.GetFatAABB=function(n){return this.m_tree.GetFatAABB(n)};f.prototype.GetProxyCount=function(){return this.m_proxyCount};f.prototype.UpdatePairs=function(n){var t=this,r,e,i,f;for(t.m_pairCount=0,i=0,i=0;i<t.m_moveBuffer.length;++i){r=t.m_moveBuffer[i];function o(n){if(n==r)return!0;t.m_pairCount==t.m_pairBuffer.length&&(t.m_pairBuffer[t.m_pairCount]=new ht);var i=t.m_pairBuffer[t.m_pairCount];return i.proxyA=n<r?n:r,i.proxyB=n>=r?n:r,++t.m_pairCount,!0}e=t.m_tree.GetFatAABB(r);t.m_tree.Query(o,e)}for(t.m_moveBuffer.length=0,i=0;i<t.m_pairCount;){var u=t.m_pairBuffer[i],s=t.m_tree.GetUserData(u.proxyA),h=t.m_tree.GetUserData(u.proxyB);for(n(s,h),++i;i<t.m_pairCount;){if(f=t.m_pairBuffer[i],f.proxyA!=u.proxyA||f.proxyB!=u.proxyB)break;++i}}};f.prototype.Query=function(n,t){this.m_tree.Query(n,t)};f.prototype.RayCast=function(n,t){this.m_tree.RayCast(n,t)};f.prototype.Validate=function(){};f.prototype.Rebalance=function(n){n===undefined&&(n=0);this.m_tree.Rebalance(n)};f.prototype.BufferMove=function(n){this.m_moveBuffer[this.m_moveBuffer.length]=n};f.prototype.UnBufferMove=function(n){var t=parseInt(this.m_moveBuffer.indexOf(n));this.m_moveBuffer.splice(t,1)};f.prototype.ComparePairs=function(){return 0};f.__implements={};f.__implements[wt]=!0;g.b2DynamicTreeNode=function(){this.aabb=new s};g.prototype.IsLeaf=function(){return this.child1==null};ht.b2DynamicTreePair=function(){};e.b2Manifold=function(){this.m_pointCount=0};e.prototype.b2Manifold=function(){this.m_points=new Vector(u.b2_maxManifoldPoints);for(var n=0;n<u.b2_maxManifoldPoints;n++)this.m_points[n]=new p;this.m_localPlaneNormal=new i;this.m_localPoint=new i};e.prototype.Reset=function(){for(var n=0;n<u.b2_maxManifoldPoints;n++)(this.m_points[n]instanceof p?this.m_points[n]:null).Reset();this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_type=0;this.m_pointCount=0};e.prototype.Set=function(n){this.m_pointCount=n.m_pointCount;for(var t=0;t<u.b2_maxManifoldPoints;t++)(this.m_points[t]instanceof p?this.m_points[t]:null).Set(n.m_points[t]);this.m_localPlaneNormal.SetV(n.m_localPlaneNormal);this.m_localPoint.SetV(n.m_localPoint);this.m_type=n.m_type};e.prototype.Copy=function(){var n=new e;return n.Set(this),n};Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1;Box2D.Collision.b2Manifold.e_faceA=2;Box2D.Collision.b2Manifold.e_faceB=4});p.b2ManifoldPoint=function(){this.m_localPoint=new i;this.m_id=new l};p.prototype.b2ManifoldPoint=function(){this.Reset()};p.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_normalImpulse=0;this.m_tangentImpulse=0;this.m_id.key=0};p.prototype.Set=function(n){this.m_localPoint.SetV(n.m_localPoint);this.m_normalImpulse=n.m_normalImpulse;this.m_tangentImpulse=n.m_tangentImpulse;this.m_id.Set(n.m_id)};nt.b2Point=function(){this.p=new i};nt.prototype.Support=function(n,t,i){return t===undefined&&(t=0),i===undefined&&(i=0),this.p};nt.prototype.GetFirstVertex=function(){return this.p};tt.b2RayCastInput=function(){this.p1=new i;this.p2=new i};tt.prototype.b2RayCastInput=function(n,t,i){n===undefined&&(n=null);t===undefined&&(t=null);i===undefined&&(i=1);n&&this.p1.SetV(n);t&&this.p2.SetV(t);this.maxFraction=i};yt.b2RayCastOutput=function(){this.normal=new i};w.b2Segment=function(){this.p1=new i;this.p2=new i};w.prototype.TestSegment=function(n,t,i,r){var c,l;r===undefined&&(r=0);var o=i.p1,a=i.p2.x-o.x,v=i.p2.y-o.y,w=this.p2.x-this.p1.x,b=this.p2.y-this.p1.y,u=b,f=-w,h=100*Number.MIN_VALUE,e=-(a*u+v*f);if(e>h){var y=o.x-this.p1.x,p=o.y-this.p1.y,s=y*u+p*f;if(0<=s&&s<=r*e&&(c=-a*p+v*y,-h*e<=c&&c<=e*(1+h)))return s/=e,l=Math.sqrt(u*u+f*f),u/=l,f/=l,n[0]=s,t.Set(u,f),!0}return!1};w.prototype.Extend=function(n){this.ExtendForward(n);this.ExtendBackward(n)};w.prototype.ExtendForward=function(n){var t=this.p2.x-this.p1.x,i=this.p2.y-this.p1.y,r=Math.min(t>0?(n.upperBound.x-this.p1.x)/t:t<0?(n.lowerBound.x-this.p1.x)/t:Number.POSITIVE_INFINITY,i>0?(n.upperBound.y-this.p1.y)/i:i<0?(n.lowerBound.y-this.p1.y)/i:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+t*r;this.p2.y=this.p1.y+i*r};w.prototype.ExtendBackward=function(n){var t=-this.p2.x+this.p1.x,i=-this.p2.y+this.p1.y,r=Math.min(t>0?(n.upperBound.x-this.p2.x)/t:t<0?(n.lowerBound.x-this.p2.x)/t:Number.POSITIVE_INFINITY,i>0?(n.upperBound.y-this.p2.y)/i:i<0?(n.lowerBound.y-this.p2.y)/i:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+t*r;this.p1.y=this.p2.y+i*r};h.b2SeparationFunction=function(){this.m_localPoint=new i;this.m_axis=new i};h.prototype.Initialize=function(t,r,f,e,o){var et,ht;this.m_proxyA=r;this.m_proxyB=e;et=parseInt(t.count);u.b2Assert(0<et&&et<3);var y,a,g,p,v,nt,w=0,b=0,k=0,d=0,rt=0,ut=0,s,c,l=0,ct=0;if(et==1)this.m_type=h.e_points,y=this.m_proxyA.GetVertex(t.indexA[0]),p=this.m_proxyB.GetVertex(t.indexB[0]),c=y,s=f.R,w=f.position.x+(s.col1.x*c.x+s.col2.x*c.y),b=f.position.y+(s.col1.y*c.x+s.col2.y*c.y),c=p,s=o.R,k=o.position.x+(s.col1.x*c.x+s.col2.x*c.y),d=o.position.y+(s.col1.y*c.x+s.col2.y*c.y),this.m_axis.x=k-w,this.m_axis.y=d-b,this.m_axis.Normalize();else if(t.indexB[0]==t.indexB[1])this.m_type=h.e_faceA,a=this.m_proxyA.GetVertex(t.indexA[0]),g=this.m_proxyA.GetVertex(t.indexA[1]),p=this.m_proxyB.GetVertex(t.indexB[0]),this.m_localPoint.x=.5*(a.x+g.x),this.m_localPoint.y=.5*(a.y+g.y),this.m_axis=n.CrossVF(n.SubtractVV(g,a),1),this.m_axis.Normalize(),c=this.m_axis,s=f.R,rt=s.col1.x*c.x+s.col2.x*c.y,ut=s.col1.y*c.x+s.col2.y*c.y,c=this.m_localPoint,s=f.R,w=f.position.x+(s.col1.x*c.x+s.col2.x*c.y),b=f.position.y+(s.col1.y*c.x+s.col2.y*c.y),c=p,s=o.R,k=o.position.x+(s.col1.x*c.x+s.col2.x*c.y),d=o.position.y+(s.col1.y*c.x+s.col2.y*c.y),l=(k-w)*rt+(d-b)*ut,l<0&&this.m_axis.NegativeSelf();else if(t.indexA[0]==t.indexA[0])this.m_type=h.e_faceB,v=this.m_proxyB.GetVertex(t.indexB[0]),nt=this.m_proxyB.GetVertex(t.indexB[1]),y=this.m_proxyA.GetVertex(t.indexA[0]),this.m_localPoint.x=.5*(v.x+nt.x),this.m_localPoint.y=.5*(v.y+nt.y),this.m_axis=n.CrossVF(n.SubtractVV(nt,v),1),this.m_axis.Normalize(),c=this.m_axis,s=o.R,rt=s.col1.x*c.x+s.col2.x*c.y,ut=s.col1.y*c.x+s.col2.y*c.y,c=this.m_localPoint,s=o.R,k=o.position.x+(s.col1.x*c.x+s.col2.x*c.y),d=o.position.y+(s.col1.y*c.x+s.col2.y*c.y),c=y,s=f.R,w=f.position.x+(s.col1.x*c.x+s.col2.x*c.y),b=f.position.y+(s.col1.y*c.x+s.col2.y*c.y),l=(w-k)*rt+(b-d)*ut,l<0&&this.m_axis.NegativeSelf();else{a=this.m_proxyA.GetVertex(t.indexA[0]);g=this.m_proxyA.GetVertex(t.indexA[1]);v=this.m_proxyB.GetVertex(t.indexB[0]);nt=this.m_proxyB.GetVertex(t.indexB[1]);var pt=n.MulX(f,y),tt=n.MulMV(f.R,n.SubtractVV(g,a)),wt=n.MulX(o,p),it=n.MulMV(o.R,n.SubtractVV(nt,v)),lt=tt.x*tt.x+tt.y*tt.y,st=it.x*it.x+it.y*it.y,ot=n.SubtractVV(it,tt),at=tt.x*ot.x+tt.y*ot.y,vt=it.x*ot.x+it.y*ot.y,ft=tt.x*it.x+tt.y*it.y,yt=lt*st-ft*ft;l=0;yt!=0&&(l=n.Clamp((ft*vt-at*st)/yt,0,1));ht=(ft*l+vt)/st;ht<0&&(ht=0,l=n.Clamp((ft-at)/lt,0,1));y=new i;y.x=a.x+l*(g.x-a.x);y.y=a.y+l*(g.y-a.y);p=new i;p.x=v.x+l*(nt.x-v.x);p.y=v.y+l*(nt.y-v.y);l==0||l==1?(this.m_type=h.e_faceB,this.m_axis=n.CrossVF(n.SubtractVV(nt,v),1),this.m_axis.Normalize(),this.m_localPoint=p,c=this.m_axis,s=o.R,rt=s.col1.x*c.x+s.col2.x*c.y,ut=s.col1.y*c.x+s.col2.y*c.y,c=this.m_localPoint,s=o.R,k=o.position.x+(s.col1.x*c.x+s.col2.x*c.y),d=o.position.y+(s.col1.y*c.x+s.col2.y*c.y),c=y,s=f.R,w=f.position.x+(s.col1.x*c.x+s.col2.x*c.y),b=f.position.y+(s.col1.y*c.x+s.col2.y*c.y),ct=(w-k)*rt+(b-d)*ut,l<0&&this.m_axis.NegativeSelf()):(this.m_type=h.e_faceA,this.m_axis=n.CrossVF(n.SubtractVV(g,a),1),this.m_localPoint=y,c=this.m_axis,s=f.R,rt=s.col1.x*c.x+s.col2.x*c.y,ut=s.col1.y*c.x+s.col2.y*c.y,c=this.m_localPoint,s=f.R,w=f.position.x+(s.col1.x*c.x+s.col2.x*c.y),b=f.position.y+(s.col1.y*c.x+s.col2.y*c.y),c=p,s=o.R,k=o.position.x+(s.col1.x*c.x+s.col2.x*c.y),d=o.position.y+(s.col1.y*c.x+s.col2.y*c.y),ct=(k-w)*rt+(d-b)*ut,l<0&&this.m_axis.NegativeSelf())}};h.prototype.Evaluate=function(t,i){var o,s,c,l,r,f,e;switch(this.m_type){case h.e_points:return o=n.MulTMV(t.R,this.m_axis),s=n.MulTMV(i.R,this.m_axis.GetNegative()),c=this.m_proxyA.GetSupportVertex(o),l=this.m_proxyB.GetSupportVertex(s),r=n.MulX(t,c),f=n.MulX(i,l),(f.x-r.x)*this.m_axis.x+(f.y-r.y)*this.m_axis.y;case h.e_faceA:return e=n.MulMV(t.R,this.m_axis),r=n.MulX(t,this.m_localPoint),s=n.MulTMV(i.R,e.GetNegative()),l=this.m_proxyB.GetSupportVertex(s),f=n.MulX(i,l),(f.x-r.x)*e.x+(f.y-r.y)*e.y;case h.e_faceB:return e=n.MulMV(i.R,this.m_axis),f=n.MulX(i,this.m_localPoint),o=n.MulTMV(t.R,e.GetNegative()),c=this.m_proxyA.GetSupportVertex(o),r=n.MulX(t,c),(r.x-f.x)*e.x+(r.y-f.y)*e.y;default:return u.b2Assert(!1),0}};Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1;Box2D.Collision.b2SeparationFunction.e_faceA=2;Box2D.Collision.b2SeparationFunction.e_faceB=4});c.b2Simplex=function(){this.m_v1=new b;this.m_v2=new b;this.m_v3=new b;this.m_vertices=new Vector(3)};c.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};c.prototype.ReadCache=function(t,i,r,f,e){var h,c,a,s,o,v,l;for(u.b2Assert(0<=t.count&&t.count<=3),this.m_count=t.count,a=this.m_vertices,s=0;s<this.m_count;s++)o=a[s],o.indexA=t.indexA[s],o.indexB=t.indexB[s],h=i.GetVertex(o.indexA),c=f.GetVertex(o.indexB),o.wA=n.MulX(r,h),o.wB=n.MulX(e,c),o.w=n.SubtractVV(o.wB,o.wA),o.a=0;this.m_count>1&&(v=t.metric,l=this.GetMetric(),(l<.5*v||2*v<l||l<Number.MIN_VALUE)&&(this.m_count=0));this.m_count==0&&(o=a[0],o.indexA=0,o.indexB=0,h=i.GetVertex(0),c=f.GetVertex(0),o.wA=n.MulX(r,h),o.wB=n.MulX(e,c),o.w=n.SubtractVV(o.wB,o.wA),this.m_count=1)};c.prototype.WriteCache=function(n){var i,t;for(n.metric=this.GetMetric(),n.count=Box2D.parseUInt(this.m_count),i=this.m_vertices,t=0;t<this.m_count;t++)n.indexA[t]=Box2D.parseUInt(i[t].indexA),n.indexB[t]=Box2D.parseUInt(i[t].indexB)};c.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var t=n.SubtractVV(this.m_v2.w,this.m_v1.w),r=n.CrossVV(t,this.m_v1.w.GetNegative());return r>0?n.CrossFV(1,t):n.CrossVF(t,1);default:return u.b2Assert(!1),new i}};c.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return u.b2Assert(!1),new i;case 1:return this.m_v1.w;case 2:return new i(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return u.b2Assert(!1),new i}};c.prototype.GetWitnessPoints=function(n,t){switch(this.m_count){case 0:u.b2Assert(!1);break;case 1:n.SetV(this.m_v1.wA);t.SetV(this.m_v1.wB);break;case 2:n.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;n.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;t.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;t.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:t.x=n.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;t.y=n.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:u.b2Assert(!1)}};c.prototype.GetMetric=function(){switch(this.m_count){case 0:return u.b2Assert(!1),0;case 1:return 0;case 2:return n.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return n.CrossVV(n.SubtractVV(this.m_v2.w,this.m_v1.w),n.SubtractVV(this.m_v3.w,this.m_v1.w));default:return u.b2Assert(!1),0}};c.prototype.Solve2=function(){var r=this.m_v1.w,u=this.m_v2.w,t=n.SubtractVV(u,r),f=-(r.x*t.x+r.y*t.y),i,e;if(f<=0){this.m_v1.a=1;this.m_count=1;return}if(i=u.x*t.x+u.y*t.y,i<=0){this.m_v2.a=1;this.m_count=1;this.m_v1.Set(this.m_v2);return}e=1/(i+f);this.m_v1.a=i*e;this.m_v2.a=f*e;this.m_count=2};c.prototype.Solve3=function(){var t=this.m_v1.w,i=this.m_v2.w,r=this.m_v3.w,l=n.SubtractVV(i,t),nt=n.Dot(t,l),tt=n.Dot(i,l),u=tt,f=-nt,a=n.SubtractVV(r,t),it=n.Dot(t,a),rt=n.Dot(r,a),e=rt,o=-it,g=n.SubtractVV(r,i),ut=n.Dot(i,g),ft=n.Dot(r,g),s=ft,h=-ut,v=n.CrossVV(l,a),y=v*n.CrossVV(i,r),p=v*n.CrossVV(r,t),w=v*n.CrossVV(t,i),b,k,d,c;if(f<=0&&o<=0){this.m_v1.a=1;this.m_count=1;return}if(u>0&&f>0&&w<=0){b=1/(u+f);this.m_v1.a=u*b;this.m_v2.a=f*b;this.m_count=2;return}if(e>0&&o>0&&p<=0){k=1/(e+o);this.m_v1.a=e*k;this.m_v3.a=o*k;this.m_count=2;this.m_v2.Set(this.m_v3);return}if(u<=0&&h<=0){this.m_v2.a=1;this.m_count=1;this.m_v1.Set(this.m_v2);return}if(e<=0&&s<=0){this.m_v3.a=1;this.m_count=1;this.m_v1.Set(this.m_v3);return}if(s>0&&h>0&&y<=0){d=1/(s+h);this.m_v2.a=s*d;this.m_v3.a=h*d;this.m_count=2;this.m_v1.Set(this.m_v3);return}c=1/(y+p+w);this.m_v1.a=y*c;this.m_v2.a=p*c;this.m_v3.a=w*c;this.m_count=3};ct.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3);this.indexB=new Vector_a2j_Number(3)};b.b2SimplexVertex=function(){};b.prototype.Set=function(n){this.wA.SetV(n.wA);this.wB.SetV(n.wB);this.w.SetV(n.w);this.a=n.a;this.indexA=n.indexA;this.indexB=n.indexB};t.b2TimeOfImpact=function(){};t.TimeOfImpact=function(i){var o,k,l,f,v;++t.b2_toiCalls;var d=i.proxyA,g=i.proxyB,s=i.sweepA,y=i.sweepB;u.b2Assert(s.t0==y.t0);u.b2Assert(1-s.t0>Number.MIN_VALUE);var p=d.m_radius+g.m_radius,w=i.tolerance,r=0,h=0,e=0;for(t.s_cache.count=0,t.s_distanceInput.useRadii=!1;;){if(s.GetTransform(t.s_xfA,r),y.GetTransform(t.s_xfB,r),t.s_distanceInput.proxyA=d,t.s_distanceInput.proxyB=g,t.s_distanceInput.transformA=t.s_xfA,t.s_distanceInput.transformB=t.s_xfB,a.Distance(t.s_distanceOutput,t.s_cache,t.s_distanceInput),t.s_distanceOutput.distance<=0){r=1;break}if(t.s_fcn.Initialize(t.s_cache,d,t.s_xfA,g,t.s_xfB),o=t.s_fcn.Evaluate(t.s_xfA,t.s_xfB),o<=0){r=1;break}if(h==0&&(e=o>p?n.Max(p-w,.75*p):n.Max(o-w,.02*p)),o-e<.5*w){if(h==0){r=1;break}break}var nt=r,b=r,c=1,tt=o;if(s.GetTransform(t.s_xfA,c),y.GetTransform(t.s_xfB,c),k=t.s_fcn.Evaluate(t.s_xfA,t.s_xfB),k>=e){r=1;break}for(l=0;;){if(f=0,f=l&1?b+(e-tt)*(c-b)/(k-tt):.5*(b+c),s.GetTransform(t.s_xfA,f),y.GetTransform(t.s_xfB,f),v=t.s_fcn.Evaluate(t.s_xfA,t.s_xfB),n.Abs(v-e)<.025*w){nt=f;break}if(v>e?(b=f,tt=v):(c=f,k=v),++l,++t.b2_toiRootIters,l==50)break}if(t.b2_toiMaxRootIters=n.Max(t.b2_toiMaxRootIters,l),nt<(1+100*Number.MIN_VALUE)*r)break;if(r=nt,h++,++t.b2_toiIters,h==1e3)break}return t.b2_toiMaxIters=n.Max(t.b2_toiMaxIters,h),r};Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0;Box2D.Collision.b2TimeOfImpact.b2_toiIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;Box2D.Collision.b2TimeOfImpact.s_cache=new ct;Box2D.Collision.b2TimeOfImpact.s_distanceInput=new ot;Box2D.Collision.b2TimeOfImpact.s_xfA=new ft;Box2D.Collision.b2TimeOfImpact.s_xfB=new ft;Box2D.Collision.b2TimeOfImpact.s_fcn=new h;Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new st});pt.b2TOIInput=function(){this.proxyA=new y;this.proxyB=new y;this.sweepA=new ut;this.sweepB=new ut};it.b2WorldManifold=function(){this.m_normal=new i};it.prototype.b2WorldManifold=function(){this.m_points=new Vector(u.b2_maxManifoldPoints);for(var n=0;n<u.b2_maxManifoldPoints;n++)this.m_points[n]=new i};it.prototype.Initialize=function(n,t,i,r,u){var p,w,d;if(i===undefined&&(i=0),u===undefined&&(u=0),n.m_pointCount!=0){var s=0,f,o,h=0,c=0,v=0,y=0,l=0,a=0;switch(n.m_type){case e.e_circles:o=t.R;f=n.m_localPoint;p=t.position.x+o.col1.x*f.x+o.col2.x*f.y;w=t.position.y+o.col1.y*f.x+o.col2.y*f.y;o=r.R;f=n.m_points[0].m_localPoint;var g=r.position.x+o.col1.x*f.x+o.col2.x*f.y,nt=r.position.y+o.col1.y*f.x+o.col2.y*f.y,b=g-p,k=nt-w,tt=b*b+k*k;tt>Number.MIN_VALUE*Number.MIN_VALUE?(d=Math.sqrt(tt),this.m_normal.x=b/d,this.m_normal.y=k/d):(this.m_normal.x=1,this.m_normal.y=0);var it=p+i*this.m_normal.x,rt=w+i*this.m_normal.y,ut=g-u*this.m_normal.x,ft=nt-u*this.m_normal.y;this.m_points[0].x=.5*(it+ut);this.m_points[0].y=.5*(rt+ft);break;case e.e_faceA:for(o=t.R,f=n.m_localPlaneNormal,h=o.col1.x*f.x+o.col2.x*f.y,c=o.col1.y*f.x+o.col2.y*f.y,o=t.R,f=n.m_localPoint,v=t.position.x+o.col1.x*f.x+o.col2.x*f.y,y=t.position.y+o.col1.y*f.x+o.col2.y*f.y,this.m_normal.x=h,this.m_normal.y=c,s=0;s<n.m_pointCount;s++)o=r.R,f=n.m_points[s].m_localPoint,l=r.position.x+o.col1.x*f.x+o.col2.x*f.y,a=r.position.y+o.col1.y*f.x+o.col2.y*f.y,this.m_points[s].x=l+.5*(i-(l-v)*h-(a-y)*c-u)*h,this.m_points[s].y=a+.5*(i-(l-v)*h-(a-y)*c-u)*c;break;case e.e_faceB:for(o=r.R,f=n.m_localPlaneNormal,h=o.col1.x*f.x+o.col2.x*f.y,c=o.col1.y*f.x+o.col2.y*f.y,o=r.R,f=n.m_localPoint,v=r.position.x+o.col1.x*f.x+o.col2.x*f.y,y=r.position.y+o.col1.y*f.x+o.col2.y*f.y,this.m_normal.x=-h,this.m_normal.y=-c,s=0;s<n.m_pointCount;s++)o=t.R,f=n.m_points[s].m_localPoint,l=t.position.x+o.col1.x*f.x+o.col2.x*f.y,a=t.position.y+o.col1.y*f.x+o.col2.y*f.y,this.m_points[s].x=l+.5*(u-(l-v)*h-(a-y)*c-i)*h,this.m_points[s].y=a+.5*(u-(l-v)*h-(a-y)*c-i)*c}}};d.ClipVertex=function(){this.v=new i;this.id=new l};d.prototype.Set=function(n){this.v.SetV(n.v);this.id.Set(n.id)};v.Features=function(){};Object.defineProperty(v.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}});Object.defineProperty(v.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(n){n===undefined&&(n=0);this._referenceEdge=n;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}});Object.defineProperty(v.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}});Object.defineProperty(v.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(n){n===undefined&&(n=0);this._incidentEdge=n;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}});Object.defineProperty(v.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}});Object.defineProperty(v.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(n){n===undefined&&(n=0);this._incidentVertex=n;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}});Object.defineProperty(v.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}});Object.defineProperty(v.prototype,"flip",{enumerable:!1,configurable:!0,set:function(n){n===undefined&&(n=0);this._flip=n;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})}(),function(){var w=Box2D.Common.b2Color,b=Box2D.Common.b2internal,e=Box2D.Common.b2Settings,r=Box2D.Collision.Shapes.b2CircleShape,o=Box2D.Collision.Shapes.b2EdgeChainDef,t=Box2D.Collision.Shapes.b2EdgeShape,s=Box2D.Collision.Shapes.b2MassData,n=Box2D.Collision.Shapes.b2PolygonShape,f=Box2D.Collision.Shapes.b2Shape,c=Box2D.Common.Math.b2Mat22,k=Box2D.Common.Math.b2Mat33,u=Box2D.Common.Math.b2Math,d=Box2D.Common.Math.b2Sweep,l=Box2D.Common.Math.b2Transform,i=Box2D.Common.Math.b2Vec2,g=Box2D.Common.Math.b2Vec3,nt=Box2D.Dynamics.b2Body,tt=Box2D.Dynamics.b2BodyDef,it=Box2D.Dynamics.b2ContactFilter,rt=Box2D.Dynamics.b2ContactImpulse,ut=Box2D.Dynamics.b2ContactListener,ft=Box2D.Dynamics.b2ContactManager,et=Box2D.Dynamics.b2DebugDraw,ot=Box2D.Dynamics.b2DestructionListener,st=Box2D.Dynamics.b2FilterData,ht=Box2D.Dynamics.b2Fixture,ct=Box2D.Dynamics.b2FixtureDef,lt=Box2D.Dynamics.b2Island,at=Box2D.Dynamics.b2TimeStep,vt=Box2D.Dynamics.b2World,yt=Box2D.Collision.b2AABB,pt=Box2D.Collision.b2Bound,wt=Box2D.Collision.b2BoundValues,bt=Box2D.Collision.b2Collision,kt=Box2D.Collision.b2ContactID,dt=Box2D.Collision.b2ContactPoint,a=Box2D.Collision.b2Distance,v=Box2D.Collision.b2DistanceInput,y=Box2D.Collision.b2DistanceOutput,h=Box2D.Collision.b2DistanceProxy,gt=Box2D.Collision.b2DynamicTree,ni=Box2D.Collision.b2DynamicTreeBroadPhase,ti=Box2D.Collision.b2DynamicTreeNode,ii=Box2D.Collision.b2DynamicTreePair,ri=Box2D.Collision.b2Manifold,ui=Box2D.Collision.b2ManifoldPoint,fi=Box2D.Collision.b2Point,ei=Box2D.Collision.b2RayCastInput,oi=Box2D.Collision.b2RayCastOutput,si=Box2D.Collision.b2Segment,hi=Box2D.Collision.b2SeparationFunction,ci=Box2D.Collision.b2Simplex,p=Box2D.Collision.b2SimplexCache,li=Box2D.Collision.b2SimplexVertex,ai=Box2D.Collision.b2TimeOfImpact,vi=Box2D.Collision.b2TOIInput,yi=Box2D.Collision.b2WorldManifold,pi=Box2D.Collision.ClipVertex,wi=Box2D.Collision.Features,bi=Box2D.Collision.IBroadPhase;Box2D.inherit(r,Box2D.Collision.Shapes.b2Shape);r.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;r.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.m_p=new i};r.prototype.Copy=function(){var n=new r;return n.Set(this),n};r.prototype.Set=function(n){if(this.__super.Set.call(this,n),Box2D.is(n,r)){var t=n instanceof r?n:null;this.m_p.SetV(t.m_p)}};r.prototype.TestPoint=function(n,t){var i=n.R,r=n.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y),u=n.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);return r=t.x-r,u=t.y-u,r*r+u*u<=this.m_radius*this.m_radius};r.prototype.RayCast=function(n,t,i){var u=i.R,a=i.position.x+(u.col1.x*this.m_p.x+u.col2.x*this.m_p.y),v=i.position.y+(u.col1.y*this.m_p.x+u.col2.y*this.m_p.y),f=t.p1.x-a,e=t.p1.y-v,y=f*f+e*e-this.m_radius*this.m_radius,o=t.p2.x-t.p1.x,s=t.p2.y-t.p1.y,c=f*o+e*s,h=o*o+s*s,l=c*c-h*y,r;return l<0||h<Number.MIN_VALUE?!1:(r=-(c+Math.sqrt(l)),0<=r&&r<=t.maxFraction*h)?(r/=h,n.fraction=r,n.normal.x=f+r*o,n.normal.y=e+r*s,n.normal.Normalize(),!0):!1};r.prototype.ComputeAABB=function(n,t){var i=t.R,r=t.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y),u=t.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);n.lowerBound.Set(r-this.m_radius,u-this.m_radius);n.upperBound.Set(r+this.m_radius,u+this.m_radius)};r.prototype.ComputeMass=function(n,t){t===undefined&&(t=0);n.mass=t*e.b2_pi*this.m_radius*this.m_radius;n.center.SetV(this.m_p);n.I=n.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};r.prototype.ComputeSubmergedArea=function(n,t,i,r){var e,f;if(t===undefined&&(t=0),e=u.MulX(i,this.m_p),f=-(u.Dot(n,e)-t),f<-this.m_radius+Number.MIN_VALUE)return 0;if(f>this.m_radius)return r.SetV(e),Math.PI*this.m_radius*this.m_radius;var o=this.m_radius*this.m_radius,s=f*f,h=o*(Math.asin(f/this.m_radius)+Math.PI/2)+f*Math.sqrt(o-s),c=-2/3*Math.pow(o-s,1.5)/h;return r.x=e.x+n.x*c,r.y=e.y+n.y*c,h};r.prototype.GetLocalPosition=function(){return this.m_p};r.prototype.SetLocalPosition=function(n){this.m_p.SetV(n)};r.prototype.GetRadius=function(){return this.m_radius};r.prototype.SetRadius=function(n){n===undefined&&(n=0);this.m_radius=n};r.prototype.b2CircleShape=function(n){n===undefined&&(n=0);this.__super.b2Shape.call(this);this.m_type=f.e_circleShape;this.m_radius=n};o.b2EdgeChainDef=function(){};o.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=!0;this.vertices=[]};Box2D.inherit(t,Box2D.Collision.Shapes.b2Shape);t.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;t.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new i;this.m_v1=new i;this.m_v2=new i;this.m_coreV1=new i;this.m_coreV2=new i;this.m_normal=new i;this.m_direction=new i;this.m_cornerDir1=new i;this.m_cornerDir2=new i};t.prototype.TestPoint=function(){return!1};t.prototype.RayCast=function(n,t,i){var r,l=t.p2.x-t.p1.x,a=t.p2.y-t.p1.y,h,c;r=i.R;var v=i.position.x+(r.col1.x*this.m_v1.x+r.col2.x*this.m_v1.y),y=i.position.y+(r.col1.y*this.m_v1.x+r.col2.y*this.m_v1.y),u=i.position.y+(r.col1.y*this.m_v2.x+r.col2.y*this.m_v2.y)-y,f=-(i.position.x+(r.col1.x*this.m_v2.x+r.col2.x*this.m_v2.y)-v),s=100*Number.MIN_VALUE,e=-(l*u+a*f);if(e>s){var p=t.p1.x-v,w=t.p1.y-y,o=p*u+w*f;if(0<=o&&o<=t.maxFraction*e&&(h=-l*w+a*p,-s*e<=h&&h<=e*(1+s)))return o/=e,n.fraction=o,c=Math.sqrt(u*u+f*f),n.normal.x=u/c,n.normal.y=f/c,!0}return!1};t.prototype.ComputeAABB=function(n,t){var i=t.R,r=t.position.x+(i.col1.x*this.m_v1.x+i.col2.x*this.m_v1.y),u=t.position.y+(i.col1.y*this.m_v1.x+i.col2.y*this.m_v1.y),f=t.position.x+(i.col1.x*this.m_v2.x+i.col2.x*this.m_v2.y),e=t.position.y+(i.col1.y*this.m_v2.x+i.col2.y*this.m_v2.y);r<f?(n.lowerBound.x=r,n.upperBound.x=f):(n.lowerBound.x=f,n.upperBound.x=r);u<e?(n.lowerBound.y=u,n.upperBound.y=e):(n.lowerBound.y=e,n.upperBound.y=u)};t.prototype.ComputeMass=function(n,t){t===undefined&&(t=0);n.mass=0;n.center.SetV(this.m_v1);n.I=0};t.prototype.ComputeSubmergedArea=function(n,t,r,f){t===undefined&&(t=0);var c=new i(n.x*t,n.y*t),s=u.MulX(r,this.m_v1),h=u.MulX(r,this.m_v2),o=u.Dot(n,s)-t,e=u.Dot(n,h)-t;if(o>0){if(e>0)return 0;s.x=-e/(o-e)*s.x+o/(o-e)*h.x;s.y=-e/(o-e)*s.y+o/(o-e)*h.y}else e>0&&(h.x=-e/(o-e)*s.x+o/(o-e)*h.x,h.y=-e/(o-e)*s.y+o/(o-e)*h.y);return f.x=(c.x+s.x+h.x)/3,f.y=(c.y+s.y+h.y)/3,.5*((s.x-c.x)*(h.y-c.y)-(s.y-c.y)*(h.x-c.x))};t.prototype.GetLength=function(){return this.m_length};t.prototype.GetVertex1=function(){return this.m_v1};t.prototype.GetVertex2=function(){return this.m_v2};t.prototype.GetCoreVertex1=function(){return this.m_coreV1};t.prototype.GetCoreVertex2=function(){return this.m_coreV2};t.prototype.GetNormalVector=function(){return this.m_normal};t.prototype.GetDirectionVector=function(){return this.m_direction};t.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};t.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};t.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};t.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};t.prototype.GetFirstVertex=function(n){var t=n.R;return new i(n.position.x+(t.col1.x*this.m_coreV1.x+t.col2.x*this.m_coreV1.y),n.position.y+(t.col1.y*this.m_coreV1.x+t.col2.y*this.m_coreV1.y))};t.prototype.GetNextEdge=function(){return this.m_nextEdge};t.prototype.GetPrevEdge=function(){return this.m_prevEdge};t.prototype.Support=function(n,t,i){t===undefined&&(t=0);i===undefined&&(i=0);var r=n.R,u=n.position.x+(r.col1.x*this.m_coreV1.x+r.col2.x*this.m_coreV1.y),f=n.position.y+(r.col1.y*this.m_coreV1.x+r.col2.y*this.m_coreV1.y),e=n.position.x+(r.col1.x*this.m_coreV2.x+r.col2.x*this.m_coreV2.y),o=n.position.y+(r.col1.y*this.m_coreV2.x+r.col2.y*this.m_coreV2.y);return u*t+f*i>e*t+o*i?(this.s_supportVec.x=u,this.s_supportVec.y=f):(this.s_supportVec.x=e,this.s_supportVec.y=o),this.s_supportVec};t.prototype.b2EdgeShape=function(n,t){this.__super.b2Shape.call(this);this.m_type=f.e_edgeShape;this.m_prevEdge=null;this.m_nextEdge=null;this.m_v1=n;this.m_v2=t;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-e.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-e.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.Set(-e.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-e.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)};t.prototype.SetPrevEdge=function(n,t,i,r){this.m_prevEdge=n;this.m_coreV1=t;this.m_cornerDir1=i;this.m_cornerConvex1=r};t.prototype.SetNextEdge=function(n,t,i,r){this.m_nextEdge=n;this.m_coreV2=t;this.m_cornerDir2=i;this.m_cornerConvex2=r};s.b2MassData=function(){this.mass=0;this.center=new i(0,0);this.I=0};Box2D.inherit(n,Box2D.Collision.Shapes.b2Shape);n.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;n.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};n.prototype.Copy=function(){var t=new n;return t.Set(this),t};n.prototype.Set=function(t){var r,i;if(this.__super.Set.call(this,t),Box2D.is(t,n))for(r=t instanceof n?t:null,this.m_centroid.SetV(r.m_centroid),this.m_vertexCount=r.m_vertexCount,this.Reserve(this.m_vertexCount),i=0;i<this.m_vertexCount;i++)this.m_vertices[i].SetV(r.m_vertices[i]),this.m_normals[i].SetV(r.m_normals[i])};n.prototype.SetAsArray=function(n,t){t===undefined&&(t=0);for(var r=new Vector,i=0,u,i=0;i<n.length;++i)u=n[i],r.push(u);this.SetAsVector(r,t)};n.AsArray=function(t,i){i===undefined&&(i=0);var r=new n;return r.SetAsArray(t,i),r};n.prototype.SetAsVector=function(t,i){var r;for(i===undefined&&(i=0),i==0&&(i=t.length),e.b2Assert(2<=i),this.m_vertexCount=i,this.Reserve(i),r=0,r=0;r<this.m_vertexCount;r++)this.m_vertices[r].SetV(t[r]);for(r=0;r<this.m_vertexCount;++r){var o=parseInt(r),s=parseInt(r+1<this.m_vertexCount?r+1:0),f=u.SubtractVV(this.m_vertices[s],this.m_vertices[o]);e.b2Assert(f.LengthSquared()>Number.MIN_VALUE);this.m_normals[r].SetV(u.CrossVF(f,1));this.m_normals[r].Normalize()}this.m_centroid=n.ComputeCentroid(this.m_vertices,this.m_vertexCount)};n.AsVector=function(t,i){i===undefined&&(i=0);var r=new n;return r.SetAsVector(t,i),r};n.prototype.SetAsBox=function(n,t){n===undefined&&(n=0);t===undefined&&(t=0);this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-n,-t);this.m_vertices[1].Set(n,-t);this.m_vertices[2].Set(n,t);this.m_vertices[3].Set(-n,t);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero()};n.AsBox=function(t,i){t===undefined&&(t=0);i===undefined&&(i=0);var r=new n;return r.SetAsBox(t,i),r};n.prototype.SetAsOrientedBox=function(n,t,i,r){var e,f;for(n===undefined&&(n=0),t===undefined&&(t=0),i===undefined&&(i=null),r===undefined&&(r=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-n,-t),this.m_vertices[1].Set(n,-t),this.m_vertices[2].Set(n,t),this.m_vertices[3].Set(-n,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=i,e=new l,e.position=i,e.R.Set(r),f=0;f<this.m_vertexCount;++f)this.m_vertices[f]=u.MulX(e,this.m_vertices[f]),this.m_normals[f]=u.MulMV(e.R,this.m_normals[f])};n.AsOrientedBox=function(t,i,r,u){t===undefined&&(t=0);i===undefined&&(i=0);r===undefined&&(r=null);u===undefined&&(u=0);var f=new n;return f.SetAsOrientedBox(t,i,r,u),f};n.prototype.SetAsEdge=function(n,t){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(n);this.m_vertices[1].SetV(t);this.m_centroid.x=.5*(n.x+t.x);this.m_centroid.y=.5*(n.y+t.y);this.m_normals[0]=u.CrossVF(u.SubtractVV(t,n),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};n.AsEdge=function(t,i){var r=new n;return r.SetAsEdge(t,i),r};n.prototype.TestPoint=function(n,t){for(var o,i,r=n.R,u=t.x-n.position.x,f=t.y-n.position.y,s=u*r.col1.x+f*r.col1.y,h=u*r.col2.x+f*r.col2.y,e=0;e<this.m_vertexCount;++e)if(i=this.m_vertices[e],u=s-i.x,f=h-i.y,i=this.m_normals[e],o=i.x*u+i.y*f,o>0)return!1;return!0};n.prototype.RayCast=function(n,t,i){var c=0,l=t.maxFraction,f=0,e=0,r,u,a,v,s,h,o;f=t.p1.x-i.position.x;e=t.p1.y-i.position.y;r=i.R;a=f*r.col1.x+e*r.col1.y;v=f*r.col2.x+e*r.col2.y;f=t.p2.x-i.position.x;e=t.p2.y-i.position.y;r=i.R;var p=f*r.col1.x+e*r.col1.y,w=f*r.col2.x+e*r.col2.y,b=p-a,k=w-v,y=parseInt(-1);for(s=0;s<this.m_vertexCount;++s){if(u=this.m_vertices[s],f=u.x-a,e=u.y-v,u=this.m_normals[s],h=u.x*f+u.y*e,o=u.x*b+u.y*k,o==0){if(h<0)return!1}else o<0&&h<c*o?(c=h/o,y=s):o>0&&h<l*o&&(l=h/o);if(l<c-Number.MIN_VALUE)return!1}return y>=0?(n.fraction=c,r=i.R,u=this.m_normals[y],n.normal.x=r.col1.x*u.x+r.col2.x*u.y,n.normal.y=r.col1.y*u.x+r.col2.y*u.y,!0):!1};n.prototype.ComputeAABB=function(n,t){for(var e,o,r=t.R,i=this.m_vertices[0],u=t.position.x+(r.col1.x*i.x+r.col2.x*i.y),f=t.position.y+(r.col1.y*i.x+r.col2.y*i.y),s=u,h=f,c=1;c<this.m_vertexCount;++c)i=this.m_vertices[c],e=t.position.x+(r.col1.x*i.x+r.col2.x*i.y),o=t.position.y+(r.col1.y*i.x+r.col2.y*i.y),u=u<e?u:e,f=f<o?f:o,s=s>e?s:e,h=h>o?h:o;n.lowerBound.x=u-this.m_radius;n.lowerBound.y=f-this.m_radius;n.upperBound.x=s+this.m_radius;n.upperBound.y=h+this.m_radius};n.prototype.ComputeMass=function(n,t){var i;if(t===undefined&&(t=0),this.m_vertexCount==2){n.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x);n.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y);n.mass=0;n.I=0;return}var p=0,w=0,r=0,k=0,u=0,f=0,e=1/3;for(i=0;i<this.m_vertexCount;++i){var o=this.m_vertices[i],s=i+1<this.m_vertexCount?this.m_vertices[parseInt(i+1)]:this.m_vertices[0],d=o.x-u,g=o.y-f,nt=s.x-u,tt=s.y-f,it=d*tt-g*nt,b=.5*it;r+=b;p+=b*e*(u+o.x+s.x);w+=b*e*(f+o.y+s.y);var h=u,c=f,l=d,a=g,v=nt,y=tt,rt=e*(.25*(l*l+v*l+v*v)+(h*l+h*v))+.5*h*h,ut=e*(.25*(a*a+y*a+y*y)+(c*a+c*y))+.5*c*c;k+=it*(rt+ut)}n.mass=t*r;p*=1/r;w*=1/r;n.center.Set(p,w);n.I=t*k};n.prototype.ComputeSubmergedArea=function(n,t,r,f){var it,b,nt;t===undefined&&(t=0);for(var ut=u.MulTMV(r.R,n),ft=t-u.Dot(n,r.position),o=new Vector_a2j_Number,tt=0,h=parseInt(-1),c=parseInt(-1),w=!1,e=0,e=0;e<this.m_vertexCount;++e)o[e]=u.Dot(ut,this.m_vertices[e])-ft,it=o[e]<-Number.MIN_VALUE,e>0&&(it?w||(h=e-1,tt++):w&&(c=e-1,tt++)),w=it;switch(tt){case 0:return w?(b=new s,this.ComputeMass(b,1),f.SetV(u.MulX(r,b.center)),b.mass):0;case 1:h==-1?h=this.m_vertexCount-1:c=this.m_vertexCount-1}var v=parseInt((h+1)%this.m_vertexCount),y=parseInt((c+1)%this.m_vertexCount),k=(0-o[h])/(o[v]-o[h]),d=(0-o[c])/(o[y]-o[c]),l=new i(this.m_vertices[h].x*(1-k)+this.m_vertices[v].x*k,this.m_vertices[h].y*(1-k)+this.m_vertices[v].y*k),et=new i(this.m_vertices[c].x*(1-d)+this.m_vertices[y].x*d,this.m_vertices[c].y*(1-d)+this.m_vertices[y].y*d),rt=0,g=new i,p=this.m_vertices[v],a;for(e=v;e!=y;)e=(e+1)%this.m_vertexCount,a=e==y?et:this.m_vertices[e],nt=.5*((p.x-l.x)*(a.y-l.y)-(p.y-l.y)*(a.x-l.x)),rt+=nt,g.x+=nt*(l.x+p.x+a.x)/3,g.y+=nt*(l.y+p.y+a.y)/3,p=a;return g.Multiply(1/rt),f.SetV(u.MulX(r,g)),rt};n.prototype.GetVertexCount=function(){return this.m_vertexCount};n.prototype.GetVertices=function(){return this.m_vertices};n.prototype.GetNormals=function(){return this.m_normals};n.prototype.GetSupport=function(n){for(var i,r=0,u=this.m_vertices[0].x*n.x+this.m_vertices[0].y*n.y,t=1;t<this.m_vertexCount;++t)i=this.m_vertices[t].x*n.x+this.m_vertices[t].y*n.y,i>u&&(r=t,u=i);return r};n.prototype.GetSupportVertex=function(n){for(var i,r=0,u=this.m_vertices[0].x*n.x+this.m_vertices[0].y*n.y,t=1;t<this.m_vertexCount;++t)i=this.m_vertices[t].x*n.x+this.m_vertices[t].y*n.y,i>u&&(r=t,u=i);return this.m_vertices[r]};n.prototype.Validate=function(){return!1};n.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=f.e_polygonShape;this.m_centroid=new i;this.m_vertices=new Vector;this.m_normals=new Vector};n.prototype.Reserve=function(n){n===undefined&&(n=0);for(var t=parseInt(this.m_vertices.length);t<n;t++)this.m_vertices[t]=new i,this.m_normals[t]=new i};n.ComputeCentroid=function(n,t){var r;t===undefined&&(t=0);var u=new i,o=0,s=0,h=0,l=1/3;for(r=0;r<t;++r){var f=n[r],e=r+1<t?n[parseInt(r+1)]:n[0],a=f.x-s,v=f.y-h,y=e.x-s,p=e.y-h,w=a*p-v*y,c=.5*w;o+=c;u.x+=c*l*(s+f.x+e.x);u.y+=c*l*(h+f.y+e.y)}return u.x*=1/o,u.y*=1/o,u};n.ComputeOBB=function(n,t,i){var r,u,w,a,b;for(i===undefined&&(i=0),r=0,u=new Vector(i+1),r=0;r<i;++r)u[r]=t[r];for(u[i]=u[0],w=Number.MAX_VALUE,r=1;r<=i;++r){var f=u[parseInt(r-1)],e=u[r].x-f.x,o=u[r].y-f.y,k=Math.sqrt(e*e+o*o);e/=k;o/=k;var d=-o,g=e,s=Number.MAX_VALUE,h=Number.MAX_VALUE,c=-Number.MAX_VALUE,l=-Number.MAX_VALUE;for(a=0;a<i;++a){var nt=u[a].x-f.x,tt=u[a].y-f.y,v=e*nt+o*tt,y=d*nt+g*tt;v<s&&(s=v);y<h&&(h=y);v>c&&(c=v);y>l&&(l=y)}if(b=(c-s)*(l-h),b<.95*w){w=b;n.R.col1.x=e;n.R.col1.y=o;n.R.col2.x=d;n.R.col2.y=g;var it=.5*(s+c),rt=.5*(h+l),p=n.R;n.center.x=f.x+(p.col1.x*it+p.col2.x*rt);n.center.y=f.y+(p.col1.y*it+p.col2.y*rt);n.extents.x=.5*(c-s);n.extents.y=.5*(l-h)}}};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new c});f.b2Shape=function(){};f.prototype.Copy=function(){return null};f.prototype.Set=function(n){this.m_radius=n.m_radius};f.prototype.GetType=function(){return this.m_type};f.prototype.TestPoint=function(){return!1};f.prototype.RayCast=function(){return!1};f.prototype.ComputeAABB=function(){};f.prototype.ComputeMass=function(n,t){t===undefined&&(t=0)};f.prototype.ComputeSubmergedArea=function(n,t){return t===undefined&&(t=0),0};f.TestOverlap=function(n,t,i,r){var u=new v,f,e;return u.proxyA=new h,u.proxyA.Set(n),u.proxyB=new h,u.proxyB.Set(i),u.transformA=t,u.transformB=r,u.useRadii=!0,f=new p,f.count=0,e=new y,a.Distance(e,f,u),e.distance<10*Number.MIN_VALUE};f.prototype.b2Shape=function(){this.m_type=f.e_unknownShape;this.m_radius=e.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1);Box2D.Collision.Shapes.b2Shape.e_circleShape=0;Box2D.Collision.Shapes.b2Shape.e_polygonShape=1;Box2D.Collision.Shapes.b2Shape.e_edgeShape=2;Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3;Box2D.Collision.Shapes.b2Shape.e_hitCollide=1;Box2D.Collision.Shapes.b2Shape.e_missCollide=0;Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})}(),function(){var i=Box2D.Common.b2Color,r=Box2D.Common.b2internal,n=Box2D.Common.b2Settings,u=Box2D.Common.Math.b2Mat22,f=Box2D.Common.Math.b2Mat33,t=Box2D.Common.Math.b2Math,e=Box2D.Common.Math.b2Sweep,o=Box2D.Common.Math.b2Transform,s=Box2D.Common.Math.b2Vec2,h=Box2D.Common.Math.b2Vec3;i.b2Color=function(){this._r=0;this._g=0;this._b=0};i.prototype.b2Color=function(n,i,r){n===undefined&&(n=0);i===undefined&&(i=0);r===undefined&&(r=0);this._r=Box2D.parseUInt(255*t.Clamp(n,0,1));this._g=Box2D.parseUInt(255*t.Clamp(i,0,1));this._b=Box2D.parseUInt(255*t.Clamp(r,0,1))};i.prototype.Set=function(n,i,r){n===undefined&&(n=0);i===undefined&&(i=0);r===undefined&&(r=0);this._r=Box2D.parseUInt(255*t.Clamp(n,0,1));this._g=Box2D.parseUInt(255*t.Clamp(i,0,1));this._b=Box2D.parseUInt(255*t.Clamp(r,0,1))};Object.defineProperty(i.prototype,"r",{enumerable:!1,configurable:!0,set:function(n){n===undefined&&(n=0);this._r=Box2D.parseUInt(255*t.Clamp(n,0,1))}});Object.defineProperty(i.prototype,"g",{enumerable:!1,configurable:!0,set:function(n){n===undefined&&(n=0);this._g=Box2D.parseUInt(255*t.Clamp(n,0,1))}});Object.defineProperty(i.prototype,"b",{enumerable:!1,configurable:!0,set:function(n){n===undefined&&(n=0);this._b=Box2D.parseUInt(255*t.Clamp(n,0,1))}});Object.defineProperty(i.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}});n.b2Settings=function(){};n.b2MixFriction=function(n,t){return n===undefined&&(n=0),t===undefined&&(t=0),Math.sqrt(n*t)};n.b2MixRestitution=function(n,t){return n===undefined&&(n=0),t===undefined&&(t=0),n>t?n:t};n.b2Assert=function(n){if(!n)throw"Assertion Failed";};Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha";Box2D.Common.b2Settings.USHRT_MAX=65535;Box2D.Common.b2Settings.b2_pi=Math.PI;Box2D.Common.b2Settings.b2_maxManifoldPoints=2;Box2D.Common.b2Settings.b2_aabbExtension=.1;Box2D.Common.b2Settings.b2_aabbMultiplier=2;Box2D.Common.b2Settings.b2_polygonRadius=2*n.b2_linearSlop;Box2D.Common.b2Settings.b2_linearSlop=.005;Box2D.Common.b2Settings.b2_angularSlop=2/180*n.b2_pi;Box2D.Common.b2Settings.b2_toiSlop=8*n.b2_linearSlop;Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32;Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32;Box2D.Common.b2Settings.b2_velocityThreshold=1;Box2D.Common.b2Settings.b2_maxLinearCorrection=.2;Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*n.b2_pi;Box2D.Common.b2Settings.b2_maxTranslation=2;Box2D.Common.b2Settings.b2_maxTranslationSquared=n.b2_maxTranslation*n.b2_maxTranslation;Box2D.Common.b2Settings.b2_maxRotation=.5*n.b2_pi;Box2D.Common.b2Settings.b2_maxRotationSquared=n.b2_maxRotation*n.b2_maxRotation;Box2D.Common.b2Settings.b2_contactBaumgarte=.2;Box2D.Common.b2Settings.b2_timeToSleep=.5;Box2D.Common.b2Settings.b2_linearSleepTolerance=.01;Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*n.b2_pi})}(),function(){var o=Box2D.Collision.b2AABB,s=Box2D.Common.b2Color,h=Box2D.Common.b2internal,c=Box2D.Common.b2Settings,i=Box2D.Common.Math.b2Mat22,u=Box2D.Common.Math.b2Mat33,n=Box2D.Common.Math.b2Math,e=Box2D.Common.Math.b2Sweep,f=Box2D.Common.Math.b2Transform,t=Box2D.Common.Math.b2Vec2,r=Box2D.Common.Math.b2Vec3;i.b2Mat22=function(){this.col1=new t;this.col2=new t};i.prototype.b2Mat22=function(){this.SetIdentity()};i.FromAngle=function(n){n===undefined&&(n=0);var t=new i;return t.Set(n),t};i.FromVV=function(n,t){var r=new i;return r.SetVV(n,t),r};i.prototype.Set=function(n){n===undefined&&(n=0);var t=Math.cos(n),i=Math.sin(n);this.col1.x=t;this.col2.x=-i;this.col1.y=i;this.col2.y=t};i.prototype.SetVV=function(n,t){this.col1.SetV(n);this.col2.SetV(t)};i.prototype.Copy=function(){var n=new i;return n.SetM(this),n};i.prototype.SetM=function(n){this.col1.SetV(n.col1);this.col2.SetV(n.col2)};i.prototype.AddM=function(n){this.col1.x+=n.col1.x;this.col1.y+=n.col1.y;this.col2.x+=n.col2.x;this.col2.y+=n.col2.y};i.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};i.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};i.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};i.prototype.GetInverse=function(n){var i=this.col1.x,r=this.col2.x,u=this.col1.y,f=this.col2.y,t=i*f-r*u;return t!=0&&(t=1/t),n.col1.x=t*f,n.col2.x=-t*r,n.col1.y=-t*u,n.col2.y=t*i,n};i.prototype.Solve=function(n,t,i){t===undefined&&(t=0);i===undefined&&(i=0);var u=this.col1.x,f=this.col2.x,e=this.col1.y,o=this.col2.y,r=u*o-f*e;return r!=0&&(r=1/r),n.x=r*(o*t-f*i),n.y=r*(u*i-e*t),n};i.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};u.b2Mat33=function(){this.col1=new r;this.col2=new r;this.col3=new r};u.prototype.b2Mat33=function(n,t,i){n===undefined&&(n=null);t===undefined&&(t=null);i===undefined&&(i=null);n||t||i?(this.col1.SetV(n),this.col2.SetV(t),this.col3.SetV(i)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())};u.prototype.SetVVV=function(n,t,i){this.col1.SetV(n);this.col2.SetV(t);this.col3.SetV(i)};u.prototype.Copy=function(){return new u(this.col1,this.col2,this.col3)};u.prototype.SetM=function(n){this.col1.SetV(n.col1);this.col2.SetV(n.col2);this.col3.SetV(n.col3)};u.prototype.AddM=function(n){this.col1.x+=n.col1.x;this.col1.y+=n.col1.y;this.col1.z+=n.col1.z;this.col2.x+=n.col2.x;this.col2.y+=n.col2.y;this.col2.z+=n.col2.z;this.col3.x+=n.col3.x;this.col3.y+=n.col3.y;this.col3.z+=n.col3.z};u.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=1};u.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};u.prototype.Solve22=function(n,t,i){t===undefined&&(t=0);i===undefined&&(i=0);var u=this.col1.x,f=this.col2.x,e=this.col1.y,o=this.col2.y,r=u*o-f*e;return r!=0&&(r=1/r),n.x=r*(o*t-f*i),n.y=r*(u*i-e*t),n};u.prototype.Solve33=function(n,t,i,r){t===undefined&&(t=0);i===undefined&&(i=0);r===undefined&&(r=0);var l=this.col1.x,a=this.col1.y,v=this.col1.z,u=this.col2.x,f=this.col2.y,e=this.col2.z,o=this.col3.x,s=this.col3.y,h=this.col3.z,c=l*(f*h-e*s)+a*(e*o-u*h)+v*(u*s-f*o);return c!=0&&(c=1/c),n.x=c*(t*(f*h-e*s)+i*(e*o-u*h)+r*(u*s-f*o)),n.y=c*(l*(i*h-r*s)+a*(r*o-t*h)+v*(t*s-i*o)),n.z=c*(l*(f*r-e*i)+a*(e*t-u*r)+v*(u*i-f*t)),n};n.b2Math=function(){};n.IsValid=function(n){return n===undefined&&(n=0),isFinite(n)};n.Dot=function(n,t){return n.x*t.x+n.y*t.y};n.CrossVV=function(n,t){return n.x*t.y-n.y*t.x};n.CrossVF=function(n,i){i===undefined&&(i=0);return new t(i*n.y,-i*n.x)};n.CrossFV=function(n,i){n===undefined&&(n=0);return new t(-n*i.y,n*i.x)};n.MulMV=function(n,i){return new t(n.col1.x*i.x+n.col2.x*i.y,n.col1.y*i.x+n.col2.y*i.y)};n.MulTMV=function(i,r){return new t(n.Dot(r,i.col1),n.Dot(r,i.col2))};n.MulX=function(t,i){var r=n.MulMV(t.R,i);return r.x+=t.position.x,r.y+=t.position.y,r};n.MulXT=function(t,i){var r=n.SubtractVV(i,t.position),u=r.x*t.R.col1.x+r.y*t.R.col1.y;return r.y=r.x*t.R.col2.x+r.y*t.R.col2.y,r.x=u,r};n.AddVV=function(n,i){return new t(n.x+i.x,n.y+i.y)};n.SubtractVV=function(n,i){return new t(n.x-i.x,n.y-i.y)};n.Distance=function(n,t){var i=n.x-t.x,r=n.y-t.y;return Math.sqrt(i*i+r*r)};n.DistanceSquared=function(n,t){var i=n.x-t.x,r=n.y-t.y;return i*i+r*r};n.MulFV=function(n,i){n===undefined&&(n=0);return new t(n*i.x,n*i.y)};n.AddMM=function(t,r){return i.FromVV(n.AddVV(t.col1,r.col1),n.AddVV(t.col2,r.col2))};n.MulMM=function(t,r){return i.FromVV(n.MulMV(t,r.col1),n.MulMV(t,r.col2))};n.MulTMM=function(r,u){var f=new t(n.Dot(r.col1,u.col1),n.Dot(r.col2,u.col1)),e=new t(n.Dot(r.col1,u.col2),n.Dot(r.col2,u.col2));return i.FromVV(f,e)};n.Abs=function(n){return n===undefined&&(n=0),n>0?n:-n};n.AbsV=function(i){return new t(n.Abs(i.x),n.Abs(i.y))};n.AbsM=function(t){return i.FromVV(n.AbsV(t.col1),n.AbsV(t.col2))};n.Min=function(n,t){return n===undefined&&(n=0),t===undefined&&(t=0),n<t?n:t};n.MinV=function(i,r){return new t(n.Min(i.x,r.x),n.Min(i.y,r.y))};n.Max=function(n,t){return n===undefined&&(n=0),t===undefined&&(t=0),n>t?n:t};n.MaxV=function(i,r){return new t(n.Max(i.x,r.x),n.Max(i.y,r.y))};n.Clamp=function(n,t,i){return n===undefined&&(n=0),t===undefined&&(t=0),i===undefined&&(i=0),n<t?t:n>i?i:n};n.ClampV=function(t,i,r){return n.MaxV(i,n.MinV(t,r))};n.Swap=function(n,t){var i=n[0];n[0]=t[0];t[0]=i};n.Random=function(){return Math.random()*2-1};n.RandomRange=function(n,t){n===undefined&&(n=0);t===undefined&&(t=0);var i=Math.random();return(t-n)*i+n};n.NextPowerOfTwo=function(n){return n===undefined&&(n=0),n|=n>>1&2147483647,n|=n>>2&1073741823,n|=n>>4&268435455,n|=n>>8&16777215,n|=n>>16&65535,n+1};n.IsPowerOfTwo=function(n){n===undefined&&(n=0);return n>0&&(n&n-1)==0};Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new t(0,0);Box2D.Common.Math.b2Math.b2Mat22_identity=i.FromVV(new t(1,0),new t(0,1));Box2D.Common.Math.b2Math.b2Transform_identity=new f(n.b2Vec2_zero,n.b2Mat22_identity)});e.b2Sweep=function(){this.localCenter=new t;this.c0=new t;this.c=new t};e.prototype.Set=function(n){this.localCenter.SetV(n.localCenter);this.c0.SetV(n.c0);this.c.SetV(n.c);this.a0=n.a0;this.a=n.a;this.t0=n.t0};e.prototype.Copy=function(){var n=new e;return n.localCenter.SetV(this.localCenter),n.c0.SetV(this.c0),n.c.SetV(this.c),n.a0=this.a0,n.a=this.a,n.t0=this.t0,n};e.prototype.GetTransform=function(n,t){var r,i;t===undefined&&(t=0);n.position.x=(1-t)*this.c0.x+t*this.c.x;n.position.y=(1-t)*this.c0.y+t*this.c.y;r=(1-t)*this.a0+t*this.a;n.R.Set(r);i=n.R;n.position.x-=i.col1.x*this.localCenter.x+i.col2.x*this.localCenter.y;n.position.y-=i.col1.y*this.localCenter.x+i.col2.y*this.localCenter.y};e.prototype.Advance=function(n){if(n===undefined&&(n=0),this.t0<n&&1-this.t0>Number.MIN_VALUE){var t=(n-this.t0)/(1-this.t0);this.c0.x=(1-t)*this.c0.x+t*this.c.x;this.c0.y=(1-t)*this.c0.y+t*this.c.y;this.a0=(1-t)*this.a0+t*this.a;this.t0=n}};f.b2Transform=function(){this.position=new t;this.R=new i};f.prototype.b2Transform=function(n,t){n===undefined&&(n=null);t===undefined&&(t=null);n&&(this.position.SetV(n),this.R.SetM(t))};f.prototype.Initialize=function(n,t){this.position.SetV(n);this.R.SetM(t)};f.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};f.prototype.Set=function(n){this.position.SetV(n.position);this.R.SetM(n.R)};f.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};t.b2Vec2=function(){};t.prototype.b2Vec2=function(n,t){n===undefined&&(n=0);t===undefined&&(t=0);this.x=n;this.y=t};t.prototype.SetZero=function(){this.x=0;this.y=0};t.prototype.Set=function(n,t){n===undefined&&(n=0);t===undefined&&(t=0);this.x=n;this.y=t};t.prototype.SetV=function(n){this.x=n.x;this.y=n.y};t.prototype.GetNegative=function(){return new t(-this.x,-this.y)};t.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};t.Make=function(n,i){return n===undefined&&(n=0),i===undefined&&(i=0),new t(n,i)};t.prototype.Copy=function(){return new t(this.x,this.y)};t.prototype.Add=function(n){this.x+=n.x;this.y+=n.y};t.prototype.Subtract=function(n){this.x-=n.x;this.y-=n.y};t.prototype.Multiply=function(n){n===undefined&&(n=0);this.x*=n;this.y*=n};t.prototype.MulM=function(n){var t=this.x;this.x=n.col1.x*t+n.col2.x*this.y;this.y=n.col1.y*t+n.col2.y*this.y};t.prototype.MulTM=function(t){var i=n.Dot(this,t.col1);this.y=n.Dot(this,t.col2);this.x=i};t.prototype.CrossVF=function(n){n===undefined&&(n=0);var t=this.x;this.x=n*this.y;this.y=-n*t};t.prototype.CrossFV=function(n){n===undefined&&(n=0);var t=this.x;this.x=-n*this.y;this.y=n*t};t.prototype.MinV=function(n){this.x=this.x<n.x?this.x:n.x;this.y=this.y<n.y?this.y:n.y};t.prototype.MaxV=function(n){this.x=this.x>n.x?this.x:n.x;this.y=this.y>n.y?this.y:n.y};t.prototype.Abs=function(){this.x<0&&(this.x=-this.x);this.y<0&&(this.y=-this.y)};t.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};t.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};t.prototype.Normalize=function(){var n=Math.sqrt(this.x*this.x+this.y*this.y),t;return n<Number.MIN_VALUE?0:(t=1/n,this.x*=t,this.y*=t,n)};t.prototype.IsValid=function(){return n.IsValid(this.x)&&n.IsValid(this.y)};r.b2Vec3=function(){};r.prototype.b2Vec3=function(n,t,i){n===undefined&&(n=0);t===undefined&&(t=0);i===undefined&&(i=0);this.x=n;this.y=t;this.z=i};r.prototype.SetZero=function(){this.x=this.y=this.z=0};r.prototype.Set=function(n,t,i){n===undefined&&(n=0);t===undefined&&(t=0);i===undefined&&(i=0);this.x=n;this.y=t;this.z=i};r.prototype.SetV=function(n){this.x=n.x;this.y=n.y;this.z=n.z};r.prototype.GetNegative=function(){return new r(-this.x,-this.y,-this.z)};r.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z};r.prototype.Copy=function(){return new r(this.x,this.y,this.z)};r.prototype.Add=function(n){this.x+=n.x;this.y+=n.y;this.z+=n.z};r.prototype.Subtract=function(n){this.x-=n.x;this.y-=n.y;this.z-=n.z};r.prototype.Multiply=function(n){n===undefined&&(n=0);this.x*=n;this.y*=n;this.z*=n}}(),function(){var yt=Box2D.Dynamics.Controllers.b2ControllerEdge,pt=Box2D.Common.Math.b2Mat22,wt=Box2D.Common.Math.b2Mat33,f=Box2D.Common.Math.b2Math,d=Box2D.Common.Math.b2Sweep,p=Box2D.Common.Math.b2Transform,e=Box2D.Common.Math.b2Vec2,bt=Box2D.Common.Math.b2Vec3,tt=Box2D.Common.b2Color,kt=Box2D.Common.b2internal,r=Box2D.Common.b2Settings,h=Box2D.Collision.b2AABB,dt=Box2D.Collision.b2Bound,gt=Box2D.Collision.b2BoundValues,ni=Box2D.Collision.b2Collision,ti=Box2D.Collision.b2ContactID,rt=Box2D.Collision.b2ContactPoint,ii=Box2D.Collision.b2Distance,ri=Box2D.Collision.b2DistanceInput,ui=Box2D.Collision.b2DistanceOutput,fi=Box2D.Collision.b2DistanceProxy,ei=Box2D.Collision.b2DynamicTree,ut=Box2D.Collision.b2DynamicTreeBroadPhase,oi=Box2D.Collision.b2DynamicTreeNode,si=Box2D.Collision.b2DynamicTreePair,hi=Box2D.Collision.b2Manifold,ci=Box2D.Collision.b2ManifoldPoint,li=Box2D.Collision.b2Point,ft=Box2D.Collision.b2RayCastInput,et=Box2D.Collision.b2RayCastOutput,ai=Box2D.Collision.b2Segment,vi=Box2D.Collision.b2SeparationFunction,yi=Box2D.Collision.b2Simplex,pi=Box2D.Collision.b2SimplexCache,wi=Box2D.Collision.b2SimplexVertex,bi=Box2D.Collision.b2TimeOfImpact,ki=Box2D.Collision.b2TOIInput,di=Box2D.Collision.b2WorldManifold,gi=Box2D.Collision.ClipVertex,nr=Box2D.Collision.Features,tr=Box2D.Collision.IBroadPhase,ot=Box2D.Collision.Shapes.b2CircleShape,ir=Box2D.Collision.Shapes.b2EdgeChainDef,st=Box2D.Collision.Shapes.b2EdgeShape,ht=Box2D.Collision.Shapes.b2MassData,ct=Box2D.Collision.Shapes.b2PolygonShape,w=Box2D.Collision.Shapes.b2Shape,n=Box2D.Dynamics.b2Body,b=Box2D.Dynamics.b2BodyDef,a=Box2D.Dynamics.b2ContactFilter,it=Box2D.Dynamics.b2ContactImpulse,c=Box2D.Dynamics.b2ContactListener,l=Box2D.Dynamics.b2ContactManager,u=Box2D.Dynamics.b2DebugDraw,g=Box2D.Dynamics.b2DestructionListener,v=Box2D.Dynamics.b2FilterData,i=Box2D.Dynamics.b2Fixture,nt=Box2D.Dynamics.b2FixtureDef,s=Box2D.Dynamics.b2Island,k=Box2D.Dynamics.b2TimeStep,t=Box2D.Dynamics.b2World,rr=Box2D.Dynamics.Contacts.b2CircleContact,o=Box2D.Dynamics.Contacts.b2Contact,ur=Box2D.Dynamics.Contacts.b2ContactConstraint,fr=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,er=Box2D.Dynamics.Contacts.b2ContactEdge,lt=Box2D.Dynamics.Contacts.b2ContactFactory,or=Box2D.Dynamics.Contacts.b2ContactRegister,sr=Box2D.Dynamics.Contacts.b2ContactResult,at=Box2D.Dynamics.Contacts.b2ContactSolver,hr=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,cr=Box2D.Dynamics.Contacts.b2NullContact,lr=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,ar=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,vr=Box2D.Dynamics.Contacts.b2PolygonContact,yr=Box2D.Dynamics.Contacts.b2PositionSolverManifold,pr=Box2D.Dynamics.Controllers.b2Controller,wr=Box2D.Dynamics.Joints.b2DistanceJoint,br=Box2D.Dynamics.Joints.b2DistanceJointDef,kr=Box2D.Dynamics.Joints.b2FrictionJoint,dr=Box2D.Dynamics.Joints.b2FrictionJointDef,gr=Box2D.Dynamics.Joints.b2GearJoint,nu=Box2D.Dynamics.Joints.b2GearJointDef,tu=Box2D.Dynamics.Joints.b2Jacobian,y=Box2D.Dynamics.Joints.b2Joint,iu=Box2D.Dynamics.Joints.b2JointDef,ru=Box2D.Dynamics.Joints.b2JointEdge,uu=Box2D.Dynamics.Joints.b2LineJoint,fu=Box2D.Dynamics.Joints.b2LineJointDef,eu=Box2D.Dynamics.Joints.b2MouseJoint,ou=Box2D.Dynamics.Joints.b2MouseJointDef,su=Box2D.Dynamics.Joints.b2PrismaticJoint,hu=Box2D.Dynamics.Joints.b2PrismaticJointDef,vt=Box2D.Dynamics.Joints.b2PulleyJoint,cu=Box2D.Dynamics.Joints.b2PulleyJointDef,lu=Box2D.Dynamics.Joints.b2RevoluteJoint,au=Box2D.Dynamics.Joints.b2RevoluteJointDef,vu=Box2D.Dynamics.Joints.b2WeldJoint,yu=Box2D.Dynamics.Joints.b2WeldJointDef;n.b2Body=function(){this.m_xf=new p;this.m_sweep=new d;this.m_linearVelocity=new e;this.m_force=new e};n.prototype.connectEdges=function(n,t,i){var e,o;i===undefined&&(i=0);var s=Math.atan2(t.GetDirectionVector().y,t.GetDirectionVector().x),h=Math.tan((s-i)*.5),u=f.MulFV(h,t.GetDirectionVector());return u=f.SubtractVV(u,t.GetNormalVector()),u=f.MulFV(r.b2_toiSlop,u),u=f.AddVV(u,t.GetVertex1()),e=f.AddVV(n.GetDirectionVector(),t.GetDirectionVector()),e.Normalize(),o=f.Dot(n.GetDirectionVector(),t.GetNormalVector())>0,n.SetNextEdge(t,u,e,o),t.SetPrevEdge(n,u,e,o),s};n.prototype.CreateFixture=function(r){var u,f;return this.m_world.IsLocked()==!0?null:(u=new i,u.Create(this,this.m_xf,r),this.m_flags&n.e_activeFlag&&(f=this.m_world.m_contactManager.m_broadPhase,u.CreateProxy(f,this.m_xf)),u.m_next=this.m_fixtureList,this.m_fixtureList=u,++this.m_fixtureCount,u.m_body=this,u.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=t.e_newFixture,u)};n.prototype.CreateFixture2=function(n,t){t===undefined&&(t=0);var i=new nt;return i.shape=n,i.density=t,this.CreateFixture(i)};n.prototype.DestroyFixture=function(t){var r,u,e,o,s;if(this.m_world.IsLocked()!=!0){for(var i=this.m_fixtureList,f=null,h=!1;i!=null;){if(i==t){f?f.m_next=t.m_next:this.m_fixtureList=t.m_next;h=!0;break}f=i;i=i.m_next}for(r=this.m_contactList;r;)u=r.contact,r=r.next,e=u.GetFixtureA(),o=u.GetFixtureB(),(t==e||t==o)&&this.m_world.m_contactManager.Destroy(u);this.m_flags&n.e_activeFlag&&(s=this.m_world.m_contactManager.m_broadPhase,t.DestroyProxy(s));t.Destroy();t.m_body=null;t.m_next=null;--this.m_fixtureCount;this.ResetMassData()}};n.prototype.SetPositionAndAngle=function(n,t){var i,r,u,f;if(t===undefined&&(t=0),this.m_world.IsLocked()!=!0){for(this.m_xf.R.Set(t),this.m_xf.position.SetV(n),r=this.m_xf.R,u=this.m_sweep.localCenter,this.m_sweep.c.x=r.col1.x*u.x+r.col2.x*u.y,this.m_sweep.c.y=r.col1.y*u.x+r.col2.y*u.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=t,f=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.Synchronize(f,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}};n.prototype.SetTransform=function(n){this.SetPositionAndAngle(n.position,n.GetAngle())};n.prototype.GetTransform=function(){return this.m_xf};n.prototype.GetPosition=function(){return this.m_xf.position};n.prototype.SetPosition=function(n){this.SetPositionAndAngle(n,this.GetAngle())};n.prototype.GetAngle=function(){return this.m_sweep.a};n.prototype.SetAngle=function(n){n===undefined&&(n=0);this.SetPositionAndAngle(this.GetPosition(),n)};n.prototype.GetWorldCenter=function(){return this.m_sweep.c};n.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};n.prototype.SetLinearVelocity=function(t){this.m_type!=n.b2_staticBody&&this.m_linearVelocity.SetV(t)};n.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};n.prototype.SetAngularVelocity=function(t){(t===undefined&&(t=0),this.m_type!=n.b2_staticBody)&&(this.m_angularVelocity=t)};n.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};n.prototype.GetDefinition=function(){var t=new b;return t.type=this.GetType(),t.allowSleep=(this.m_flags&n.e_allowSleepFlag)==n.e_allowSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=(this.m_flags&n.e_fixedRotationFlag)==n.e_fixedRotationFlag,t.bullet=(this.m_flags&n.e_bulletFlag)==n.e_bulletFlag,t.awake=(this.m_flags&n.e_awakeFlag)==n.e_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.SetV(this.GetLinearVelocity()),t.position=this.GetPosition(),t.userData=this.GetUserData(),t};n.prototype.ApplyForce=function(t,i){this.m_type==n.b2_dynamicBody&&(this.IsAwake()==!1&&this.SetAwake(!0),this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(i.x-this.m_sweep.c.x)*t.y-(i.y-this.m_sweep.c.y)*t.x)};n.prototype.ApplyTorque=function(t){(t===undefined&&(t=0),this.m_type==n.b2_dynamicBody)&&(this.IsAwake()==!1&&this.SetAwake(!0),this.m_torque+=t)};n.prototype.ApplyImpulse=function(t,i){this.m_type==n.b2_dynamicBody&&(this.IsAwake()==!1&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((i.x-this.m_sweep.c.x)*t.y-(i.y-this.m_sweep.c.y)*t.x))};n.prototype.Split=function(n){for(var e,s=this.GetLinearVelocity().Copy(),u=this.GetAngularVelocity(),h=this.GetWorldCenter(),r=this,t=this.m_world.CreateBody(this.GetDefinition()),o,i=r.m_fixtureList;i;)n(i)?(e=i.m_next,o?o.m_next=e:r.m_fixtureList=e,r.m_fixtureCount--,i.m_next=t.m_fixtureList,t.m_fixtureList=i,t.m_fixtureCount++,i.m_body=t,i=e):(o=i,i=i.m_next);r.ResetMassData();t.ResetMassData();var c=r.GetWorldCenter(),l=t.GetWorldCenter(),a=f.AddVV(s,f.CrossFV(u,f.SubtractVV(c,h))),v=f.AddVV(s,f.CrossFV(u,f.SubtractVV(l,h)));return r.SetLinearVelocity(a),t.SetLinearVelocity(v),r.SetAngularVelocity(u),t.SetAngularVelocity(u),r.SynchronizeFixtures(),t.SynchronizeFixtures(),t};n.prototype.Merge=function(n){for(var u,t=n.m_fixtureList;t;)u=t.m_next,n.m_fixtureCount--,t.m_next=this.m_fixtureList,this.m_fixtureList=t,this.m_fixtureCount++,t.m_body=r,t=u;i.m_fixtureCount=0;var i=this,r=n,f=i.GetWorldCenter(),e=r.GetWorldCenter(),o=i.GetLinearVelocity().Copy(),s=r.GetLinearVelocity().Copy(),h=i.GetAngularVelocity(),c=r.GetAngularVelocity();i.ResetMassData();this.SynchronizeFixtures()};n.prototype.GetMass=function(){return this.m_mass};n.prototype.GetInertia=function(){return this.m_I};n.prototype.GetMassData=function(n){n.mass=this.m_mass;n.I=this.m_I;n.center.SetV(this.m_sweep.localCenter)};n.prototype.SetMassData=function(t){if((r.b2Assert(this.m_world.IsLocked()==!1),this.m_world.IsLocked()!=!0)&&this.m_type==n.b2_dynamicBody){this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_mass=t.mass;this.m_mass<=0&&(this.m_mass=1);this.m_invMass=1/this.m_mass;t.I>0&&(this.m_flags&n.e_fixedRotationFlag)==0&&(this.m_I=t.I-this.m_mass*(t.center.x*t.center.x+t.center.y*t.center.y),this.m_invI=1/this.m_I);var i=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t.center);this.m_sweep.c0.SetV(f.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-i.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-i.x)}};n.prototype.ResetMassData=function(){var t,u,i,o;if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type!=n.b2_staticBody&&this.m_type!=n.b2_kinematicBody){for(t=e.Make(0,0),u=this.m_fixtureList;u;u=u.m_next)u.m_density!=0&&(i=u.GetMassData(),this.m_mass+=i.mass,t.x+=i.center.x*i.mass,t.y+=i.center.y*i.mass,this.m_I+=i.I);this.m_mass>0?(this.m_invMass=1/this.m_mass,t.x*=this.m_invMass,t.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1);this.m_I>0&&(this.m_flags&n.e_fixedRotationFlag)==0?(this.m_I-=this.m_mass*(t.x*t.x+t.y*t.y),this.m_I*=this.m_inertiaScale,r.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);o=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t);this.m_sweep.c0.SetV(f.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-o.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-o.x)}};n.prototype.GetWorldPoint=function(n){var t=this.m_xf.R,i=new e(t.col1.x*n.x+t.col2.x*n.y,t.col1.y*n.x+t.col2.y*n.y);return i.x+=this.m_xf.position.x,i.y+=this.m_xf.position.y,i};n.prototype.GetWorldVector=function(n){return f.MulMV(this.m_xf.R,n)};n.prototype.GetLocalPoint=function(n){return f.MulXT(this.m_xf,n)};n.prototype.GetLocalVector=function(n){return f.MulTMV(this.m_xf.R,n)};n.prototype.GetLinearVelocityFromWorldPoint=function(n){return new e(this.m_linearVelocity.x-this.m_angularVelocity*(n.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(n.x-this.m_sweep.c.x))};n.prototype.GetLinearVelocityFromLocalPoint=function(n){var t=this.m_xf.R,i=new e(t.col1.x*n.x+t.col2.x*n.y,t.col1.y*n.x+t.col2.y*n.y);return i.x+=this.m_xf.position.x,i.y+=this.m_xf.position.y,new e(this.m_linearVelocity.x-this.m_angularVelocity*(i.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(i.x-this.m_sweep.c.x))};n.prototype.GetLinearDamping=function(){return this.m_linearDamping};n.prototype.SetLinearDamping=function(n){n===undefined&&(n=0);this.m_linearDamping=n};n.prototype.GetAngularDamping=function(){return this.m_angularDamping};n.prototype.SetAngularDamping=function(n){n===undefined&&(n=0);this.m_angularDamping=n};n.prototype.SetType=function(t){if(t===undefined&&(t=0),this.m_type!=t){this.m_type=t;this.ResetMassData();this.m_type==n.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0);this.SetAwake(!0);this.m_force.SetZero();this.m_torque=0;for(var i=this.m_contactList;i;i=i.next)i.contact.FlagForFiltering()}};n.prototype.GetType=function(){return this.m_type};n.prototype.SetBullet=function(t){t?this.m_flags|=n.e_bulletFlag:this.m_flags&=~n.e_bulletFlag};n.prototype.IsBullet=function(){return(this.m_flags&n.e_bulletFlag)==n.e_bulletFlag};n.prototype.SetSleepingAllowed=function(t){t?this.m_flags|=n.e_allowSleepFlag:(this.m_flags&=~n.e_allowSleepFlag,this.SetAwake(!0))};n.prototype.SetAwake=function(t){t?(this.m_flags|=n.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~n.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)};n.prototype.IsAwake=function(){return(this.m_flags&n.e_awakeFlag)==n.e_awakeFlag};n.prototype.SetFixedRotation=function(t){t?this.m_flags|=n.e_fixedRotationFlag:this.m_flags&=~n.e_fixedRotationFlag;this.ResetMassData()};n.prototype.IsFixedRotation=function(){return(this.m_flags&n.e_fixedRotationFlag)==n.e_fixedRotationFlag};n.prototype.SetActive=function(t){var u,i,r,f;if(t!=this.IsActive())if(t)for(this.m_flags|=n.e_activeFlag,u=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.CreateProxy(u,this.m_xf);else{for(this.m_flags&=~n.e_activeFlag,u=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.DestroyProxy(u);for(r=this.m_contactList;r;)f=r,r=r.next,this.m_world.m_contactManager.Destroy(f.contact);this.m_contactList=null}};n.prototype.IsActive=function(){return(this.m_flags&n.e_activeFlag)==n.e_activeFlag};n.prototype.IsSleepingAllowed=function(){return(this.m_flags&n.e_allowSleepFlag)==n.e_allowSleepFlag};n.prototype.GetFixtureList=function(){return this.m_fixtureList};n.prototype.GetJointList=function(){return this.m_jointList};n.prototype.GetControllerList=function(){return this.m_controllerList};n.prototype.GetContactList=function(){return this.m_contactList};n.prototype.GetNext=function(){return this.m_next};n.prototype.GetUserData=function(){return this.m_userData};n.prototype.SetUserData=function(n){this.m_userData=n};n.prototype.GetWorld=function(){return this.m_world};n.prototype.b2Body=function(t,i){this.m_flags=0;t.bullet&&(this.m_flags|=n.e_bulletFlag);t.fixedRotation&&(this.m_flags|=n.e_fixedRotationFlag);t.allowSleep&&(this.m_flags|=n.e_allowSleepFlag);t.awake&&(this.m_flags|=n.e_awakeFlag);t.active&&(this.m_flags|=n.e_activeFlag);this.m_world=i;this.m_xf.position.SetV(t.position);this.m_xf.R.Set(t.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=t.angle;var r=this.m_xf.R,u=this.m_sweep.localCenter;this.m_sweep.c.x=r.col1.x*u.x+r.col2.x*u.y;this.m_sweep.c.y=r.col1.y*u.x+r.col2.y*u.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_jointList=null;this.m_controllerList=null;this.m_contactList=null;this.m_controllerCount=0;this.m_prev=null;this.m_next=null;this.m_linearVelocity.SetV(t.linearVelocity);this.m_angularVelocity=t.angularVelocity;this.m_linearDamping=t.linearDamping;this.m_angularDamping=t.angularDamping;this.m_force.Set(0,0);this.m_torque=0;this.m_sleepTime=0;this.m_type=t.type;this.m_type==n.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0);this.m_I=0;this.m_invI=0;this.m_inertiaScale=t.inertiaScale;this.m_userData=t.userData;this.m_fixtureList=null;this.m_fixtureCount=0};n.prototype.SynchronizeFixtures=function(){var t=n.s_xf1,i,r,u,f;for(t.R.Set(this.m_sweep.a0),i=t.R,r=this.m_sweep.localCenter,t.position.x=this.m_sweep.c0.x-(i.col1.x*r.x+i.col2.x*r.y),t.position.y=this.m_sweep.c0.y-(i.col1.y*r.x+i.col2.y*r.y),f=this.m_world.m_contactManager.m_broadPhase,u=this.m_fixtureList;u;u=u.m_next)u.Synchronize(f,t,this.m_xf)};n.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var n=this.m_xf.R,t=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(n.col1.x*t.x+n.col2.x*t.y);this.m_xf.position.y=this.m_sweep.c.y-(n.col1.y*t.x+n.col2.y*t.y)};n.prototype.ShouldCollide=function(t){if(this.m_type!=n.b2_dynamicBody&&t.m_type!=n.b2_dynamicBody)return!1;for(var i=this.m_jointList;i;i=i.next)if(i.other==t&&i.joint.m_collideConnected==!1)return!1;return!0};n.prototype.Advance=function(n){n===undefined&&(n=0);this.m_sweep.Advance(n);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new p;Box2D.Dynamics.b2Body.e_islandFlag=1;Box2D.Dynamics.b2Body.e_awakeFlag=2;Box2D.Dynamics.b2Body.e_allowSleepFlag=4;Box2D.Dynamics.b2Body.e_bulletFlag=8;Box2D.Dynamics.b2Body.e_fixedRotationFlag=16;Box2D.Dynamics.b2Body.e_activeFlag=32;Box2D.Dynamics.b2Body.b2_staticBody=0;Box2D.Dynamics.b2Body.b2_kinematicBody=1;Box2D.Dynamics.b2Body.b2_dynamicBody=2});b.b2BodyDef=function(){this.position=new e;this.linearVelocity=new e};b.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,0);this.angle=0;this.linearVelocity.Set(0,0);this.angularVelocity=0;this.linearDamping=0;this.angularDamping=0;this.allowSleep=!0;this.awake=!0;this.fixedRotation=!1;this.bullet=!1;this.type=n.b2_staticBody;this.active=!0;this.inertiaScale=1};a.b2ContactFilter=function(){};a.prototype.ShouldCollide=function(n,t){var i=n.GetFilterData(),r=t.GetFilterData();return i.groupIndex==r.groupIndex&&i.groupIndex!=0?i.groupIndex>0:(i.maskBits&r.categoryBits)!=0&&(i.categoryBits&r.maskBits)!=0};a.prototype.RayCollide=function(n,t){return n?this.ShouldCollide(n instanceof i?n:null,t):!0};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new a});it.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(r.b2_maxManifoldPoints);this.tangentImpulses=new Vector_a2j_Number(r.b2_maxManifoldPoints)};c.b2ContactListener=function(){};c.prototype.BeginContact=function(){};c.prototype.EndContact=function(){};c.prototype.PreSolve=function(){};c.prototype.PostSolve=function(){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new c});l.b2ContactManager=function(){};l.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=a.b2_defaultFilter;this.m_contactListener=c.b2_defaultListener;this.m_contactFactory=new lt(this.m_allocator);this.m_broadPhase=new ut};l.prototype.AddPair=function(n,t){var e=n instanceof i?n:null,o=t instanceof i?t:null,u=e.GetBody(),f=o.GetBody(),s,h,c,r;if(u!=f){for(s=f.GetContactList();s;){if(s.other==u){if(h=s.contact.GetFixtureA(),c=s.contact.GetFixtureB(),h==e&&c==o)return;if(h==o&&c==e)return}s=s.next}if(f.ShouldCollide(u)!=!1&&this.m_contactFilter.ShouldCollide(e,o)!=!1){r=this.m_contactFactory.Create(e,o);e=r.GetFixtureA();o=r.GetFixtureB();u=e.m_body;f=o.m_body;r.m_prev=null;r.m_next=this.m_world.m_contactList;this.m_world.m_contactList!=null&&(this.m_world.m_contactList.m_prev=r);this.m_world.m_contactList=r;r.m_nodeA.contact=r;r.m_nodeA.other=f;r.m_nodeA.prev=null;r.m_nodeA.next=u.m_contactList;u.m_contactList!=null&&(u.m_contactList.prev=r.m_nodeA);u.m_contactList=r.m_nodeA;r.m_nodeB.contact=r;r.m_nodeB.other=u;r.m_nodeB.prev=null;r.m_nodeB.next=f.m_contactList;f.m_contactList!=null&&(f.m_contactList.prev=r.m_nodeB);f.m_contactList=r.m_nodeB;++this.m_world.m_contactCount;return}}};l.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))};l.prototype.Destroy=function(n){var r=n.GetFixtureA(),u=n.GetFixtureB(),t=r.GetBody(),i=u.GetBody();n.IsTouching()&&this.m_contactListener.EndContact(n);n.m_prev&&(n.m_prev.m_next=n.m_next);n.m_next&&(n.m_next.m_prev=n.m_prev);n==this.m_world.m_contactList&&(this.m_world.m_contactList=n.m_next);n.m_nodeA.prev&&(n.m_nodeA.prev.next=n.m_nodeA.next);n.m_nodeA.next&&(n.m_nodeA.next.prev=n.m_nodeA.prev);n.m_nodeA==t.m_contactList&&(t.m_contactList=n.m_nodeA.next);n.m_nodeB.prev&&(n.m_nodeB.prev.next=n.m_nodeB.next);n.m_nodeB.next&&(n.m_nodeB.next.prev=n.m_nodeB.prev);n.m_nodeB==i.m_contactList&&(i.m_contactList=n.m_nodeB.next);this.m_contactFactory.Destroy(n);--this.m_contactCount};l.prototype.Collide=function(){for(var n=this.m_world.m_contactList,t;n;){var i=n.GetFixtureA(),r=n.GetFixtureB(),u=i.GetBody(),f=r.GetBody();if(u.IsAwake()==!1&&f.IsAwake()==!1){n=n.GetNext();continue}if(n.m_flags&o.e_filterFlag){if(f.ShouldCollide(u)==!1){t=n;n=t.GetNext();this.Destroy(t);continue}if(this.m_contactFilter.ShouldCollide(i,r)==!1){t=n;n=t.GetNext();this.Destroy(t);continue}n.m_flags&=~o.e_filterFlag}var e=i.m_proxy,s=r.m_proxy,h=this.m_broadPhase.TestOverlap(e,s);if(h==!1){t=n;n=t.GetNext();this.Destroy(t);continue}n.Update(this.m_contactListener);n=n.GetNext()}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new rt});u.b2DebugDraw=function(){};u.prototype.b2DebugDraw=function(){};u.prototype.SetFlags=function(n){n===undefined&&(n=0)};u.prototype.GetFlags=function(){};u.prototype.AppendFlags=function(n){n===undefined&&(n=0)};u.prototype.ClearFlags=function(n){n===undefined&&(n=0)};u.prototype.SetSprite=function(){};u.prototype.GetSprite=function(){};u.prototype.SetDrawScale=function(n){n===undefined&&(n=0)};u.prototype.GetDrawScale=function(){};u.prototype.SetLineThickness=function(n){n===undefined&&(n=0)};u.prototype.GetLineThickness=function(){};u.prototype.SetAlpha=function(n){n===undefined&&(n=0)};u.prototype.GetAlpha=function(){};u.prototype.SetFillAlpha=function(n){n===undefined&&(n=0)};u.prototype.GetFillAlpha=function(){};u.prototype.SetXFormScale=function(n){n===undefined&&(n=0)};u.prototype.GetXFormScale=function(){};u.prototype.DrawPolygon=function(n,t){t===undefined&&(t=0)};u.prototype.DrawSolidPolygon=function(n,t){t===undefined&&(t=0)};u.prototype.DrawCircle=function(n,t){t===undefined&&(t=0)};u.prototype.DrawSolidCircle=function(n,t){t===undefined&&(t=0)};u.prototype.DrawSegment=function(){};u.prototype.DrawTransform=function(){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1;Box2D.Dynamics.b2DebugDraw.e_jointBit=2;Box2D.Dynamics.b2DebugDraw.e_aabbBit=4;Box2D.Dynamics.b2DebugDraw.e_pairBit=8;Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16;Box2D.Dynamics.b2DebugDraw.e_controllerBit=32});g.b2DestructionListener=function(){};g.prototype.SayGoodbyeJoint=function(){};g.prototype.SayGoodbyeFixture=function(){};v.b2FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};v.prototype.Copy=function(){var n=new v;return n.categoryBits=this.categoryBits,n.maskBits=this.maskBits,n.groupIndex=this.groupIndex,n};i.b2Fixture=function(){this.m_filter=new v};i.prototype.GetType=function(){return this.m_shape.GetType()};i.prototype.GetShape=function(){return this.m_shape};i.prototype.SetSensor=function(n){var t;if(this.m_isSensor!=n&&(this.m_isSensor=n,this.m_body!=null))for(t=this.m_body.GetContactList();t;){var i=t.contact,r=i.GetFixtureA(),u=i.GetFixtureB();(r==this||u==this)&&i.SetSensor(r.IsSensor()||u.IsSensor());t=t.next}};i.prototype.IsSensor=function(){return this.m_isSensor};i.prototype.SetFilterData=function(n){var t;if(this.m_filter=n.Copy(),!this.m_body)for(t=this.m_body.GetContactList();t;){var i=t.contact,r=i.GetFixtureA(),u=i.GetFixtureB();(r==this||u==this)&&i.FlagForFiltering();t=t.next}};i.prototype.GetFilterData=function(){return this.m_filter.Copy()};i.prototype.GetBody=function(){return this.m_body};i.prototype.GetNext=function(){return this.m_next};i.prototype.GetUserData=function(){return this.m_userData};i.prototype.SetUserData=function(n){this.m_userData=n};i.prototype.TestPoint=function(n){return this.m_shape.TestPoint(this.m_body.GetTransform(),n)};i.prototype.RayCast=function(n,t){return this.m_shape.RayCast(n,t,this.m_body.GetTransform())};i.prototype.GetMassData=function(n){return n===undefined&&(n=null),n==null&&(n=new ht),this.m_shape.ComputeMass(n,this.m_density),n};i.prototype.SetDensity=function(n){n===undefined&&(n=0);this.m_density=n};i.prototype.GetDensity=function(){return this.m_density};i.prototype.GetFriction=function(){return this.m_friction};i.prototype.SetFriction=function(n){n===undefined&&(n=0);this.m_friction=n};i.prototype.GetRestitution=function(){return this.m_restitution};i.prototype.SetRestitution=function(n){n===undefined&&(n=0);this.m_restitution=n};i.prototype.GetAABB=function(){return this.m_aabb};i.prototype.b2Fixture=function(){this.m_aabb=new h;this.m_userData=null;this.m_body=null;this.m_next=null;this.m_shape=null;this.m_density=0;this.m_friction=0;this.m_restitution=0};i.prototype.Create=function(n,t,i){this.m_userData=i.userData;this.m_friction=i.friction;this.m_restitution=i.restitution;this.m_body=n;this.m_next=null;this.m_filter=i.filter.Copy();this.m_isSensor=i.isSensor;this.m_shape=i.shape.Copy();this.m_density=i.density};i.prototype.Destroy=function(){this.m_shape=null};i.prototype.CreateProxy=function(n,t){this.m_shape.ComputeAABB(this.m_aabb,t);this.m_proxy=n.CreateProxy(this.m_aabb,this)};i.prototype.DestroyProxy=function(n){this.m_proxy!=null&&(n.DestroyProxy(this.m_proxy),this.m_proxy=null)};i.prototype.Synchronize=function(n,t,i){var r,u,e;this.m_proxy&&(r=new h,u=new h,this.m_shape.ComputeAABB(r,t),this.m_shape.ComputeAABB(u,i),this.m_aabb.Combine(r,u),e=f.SubtractVV(i.position,t.position),n.MoveProxy(this.m_proxy,this.m_aabb,e))};nt.b2FixtureDef=function(){this.filter=new v};nt.prototype.b2FixtureDef=function(){this.shape=null;this.userData=null;this.friction=.2;this.restitution=0;this.density=0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.isSensor=!1};s.b2Island=function(){};s.prototype.b2Island=function(){this.m_bodies=new Vector;this.m_contacts=new Vector;this.m_joints=new Vector};s.prototype.Initialize=function(n,t,i,r,u,f){n===undefined&&(n=0);t===undefined&&(t=0);i===undefined&&(i=0);var e=0;for(this.m_bodyCapacity=n,this.m_contactCapacity=t,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=r,this.m_listener=u,this.m_contactSolver=f,e=this.m_bodies.length;e<n;e++)this.m_bodies[e]=null;for(e=this.m_contacts.length;e<t;e++)this.m_contacts[e]=null;for(e=this.m_joints.length;e<i;e++)this.m_joints[e]=null};s.prototype.Clear=function(){this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0};s.prototype.Solve=function(t,i,u){for(var o=0,s=0,e,h,c,v,y,p,w,a,b,o=0;o<this.m_bodyCount;++o)(e=this.m_bodies[o],e.GetType()==n.b2_dynamicBody)&&(e.m_linearVelocity.x+=t.dt*(i.x+e.m_invMass*e.m_force.x),e.m_linearVelocity.y+=t.dt*(i.y+e.m_invMass*e.m_force.y),e.m_angularVelocity+=t.dt*e.m_invI*e.m_torque,e.m_linearVelocity.Multiply(f.Clamp(1-t.dt*e.m_linearDamping,0,1)),e.m_angularVelocity*=f.Clamp(1-t.dt*e.m_angularDamping,0,1));for(this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator),c=this.m_contactSolver,c.InitVelocityConstraints(t),o=0;o<this.m_jointCount;++o)h=this.m_joints[o],h.InitVelocityConstraints(t);for(o=0;o<t.velocityIterations;++o){for(s=0;s<this.m_jointCount;++s)h=this.m_joints[s],h.SolveVelocityConstraints(t);c.SolveVelocityConstraints()}for(o=0;o<this.m_jointCount;++o)h=this.m_joints[o],h.FinalizeVelocityConstraints();for(c.FinalizeVelocityConstraints(),o=0;o<this.m_bodyCount;++o)(e=this.m_bodies[o],e.GetType()!=n.b2_staticBody)&&(v=t.dt*e.m_linearVelocity.x,y=t.dt*e.m_linearVelocity.y,v*v+y*y>r.b2_maxTranslationSquared&&(e.m_linearVelocity.Normalize(),e.m_linearVelocity.x*=r.b2_maxTranslation*t.inv_dt,e.m_linearVelocity.y*=r.b2_maxTranslation*t.inv_dt),p=t.dt*e.m_angularVelocity,p*p>r.b2_maxRotationSquared&&(e.m_angularVelocity=e.m_angularVelocity<0?-r.b2_maxRotation*t.inv_dt:r.b2_maxRotation*t.inv_dt),e.m_sweep.c0.SetV(e.m_sweep.c),e.m_sweep.a0=e.m_sweep.a,e.m_sweep.c.x+=t.dt*e.m_linearVelocity.x,e.m_sweep.c.y+=t.dt*e.m_linearVelocity.y,e.m_sweep.a+=t.dt*e.m_angularVelocity,e.SynchronizeTransform());for(o=0;o<t.positionIterations;++o){for(w=c.SolvePositionConstraints(r.b2_contactBaumgarte),a=!0,s=0;s<this.m_jointCount;++s)h=this.m_joints[s],b=h.SolvePositionConstraints(r.b2_contactBaumgarte),a=a&&b;if(w&&a)break}if(this.Report(c.m_constraints),u){var l=Number.MAX_VALUE,k=r.b2_linearSleepTolerance*r.b2_linearSleepTolerance,d=r.b2_angularSleepTolerance*r.b2_angularSleepTolerance;for(o=0;o<this.m_bodyCount;++o)(e=this.m_bodies[o],e.GetType()!=n.b2_staticBody)&&((e.m_flags&n.e_allowSleepFlag)==0&&(e.m_sleepTime=0,l=0),(e.m_flags&n.e_allowSleepFlag)==0||e.m_angularVelocity*e.m_angularVelocity>d||f.Dot(e.m_linearVelocity,e.m_linearVelocity)>k?(e.m_sleepTime=0,l=0):(e.m_sleepTime+=t.dt,l=f.Min(l,e.m_sleepTime)));if(l>=r.b2_timeToSleep)for(o=0;o<this.m_bodyCount;++o)e=this.m_bodies[o],e.SetAwake(!1)}};s.prototype.SolveTOI=function(t){var u=0,f=0,e,i,s,h,c,l,a,o,v;for(this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator),e=this.m_contactSolver,u=0;u<this.m_jointCount;++u)this.m_joints[u].InitVelocityConstraints(t);for(u=0;u<t.velocityIterations;++u)for(e.SolveVelocityConstraints(),f=0;f<this.m_jointCount;++f)this.m_joints[f].SolveVelocityConstraints(t);for(u=0;u<this.m_bodyCount;++u)(i=this.m_bodies[u],i.GetType()!=n.b2_staticBody)&&(s=t.dt*i.m_linearVelocity.x,h=t.dt*i.m_linearVelocity.y,s*s+h*h>r.b2_maxTranslationSquared&&(i.m_linearVelocity.Normalize(),i.m_linearVelocity.x*=r.b2_maxTranslation*t.inv_dt,i.m_linearVelocity.y*=r.b2_maxTranslation*t.inv_dt),c=t.dt*i.m_angularVelocity,c*c>r.b2_maxRotationSquared&&(i.m_angularVelocity=i.m_angularVelocity<0?-r.b2_maxRotation*t.inv_dt:r.b2_maxRotation*t.inv_dt),i.m_sweep.c0.SetV(i.m_sweep.c),i.m_sweep.a0=i.m_sweep.a,i.m_sweep.c.x+=t.dt*i.m_linearVelocity.x,i.m_sweep.c.y+=t.dt*i.m_linearVelocity.y,i.m_sweep.a+=t.dt*i.m_angularVelocity,i.SynchronizeTransform());for(l=.75,u=0;u<t.positionIterations;++u){for(a=e.SolvePositionConstraints(l),o=!0,f=0;f<this.m_jointCount;++f)v=this.m_joints[f].SolvePositionConstraints(r.b2_contactBaumgarte),o=o&&v;if(a&&o)break}this.Report(e.m_constraints)};s.prototype.Report=function(n){var i,u,r,t;if(this.m_listener!=null)for(i=0;i<this.m_contactCount;++i){for(u=this.m_contacts[i],r=n[i],t=0;t<r.pointCount;++t)s.s_impulse.normalImpulses[t]=r.points[t].normalImpulse,s.s_impulse.tangentImpulses[t]=r.points[t].tangentImpulse;this.m_listener.PostSolve(u,s.s_impulse)}};s.prototype.AddBody=function(n){n.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=n};s.prototype.AddContact=function(n){this.m_contacts[this.m_contactCount++]=n};s.prototype.AddJoint=function(n){this.m_joints[this.m_jointCount++]=n};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new it});k.b2TimeStep=function(){};k.prototype.Set=function(n){this.dt=n.dt;this.inv_dt=n.inv_dt;this.positionIterations=n.positionIterations;this.velocityIterations=n.velocityIterations;this.warmStarting=n.warmStarting};t.b2World=function(){this.s_stack=new Vector;this.m_contactManager=new l;this.m_contactSolver=new at;this.m_island=new s};t.prototype.b2World=function(n,i){this.m_destructionListener=null;this.m_debugDraw=null;this.m_bodyList=null;this.m_contactList=null;this.m_jointList=null;this.m_controllerList=null;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_controllerCount=0;t.m_warmStarting=!0;t.m_continuousPhysics=!0;this.m_allowSleep=i;this.m_gravity=n;this.m_inv_dt0=0;this.m_contactManager.m_world=this;var r=new b;this.m_groundBody=this.CreateBody(r)};t.prototype.SetDestructionListener=function(n){this.m_destructionListener=n};t.prototype.SetContactFilter=function(n){this.m_contactManager.m_contactFilter=n};t.prototype.SetContactListener=function(n){this.m_contactManager.m_contactListener=n};t.prototype.SetDebugDraw=function(n){this.m_debugDraw=n};t.prototype.SetBroadPhase=function(n){var r=this.m_contactManager.m_broadPhase,i,t;for(this.m_contactManager.m_broadPhase=n,i=this.m_bodyList;i;i=i.m_next)for(t=i.m_fixtureList;t;t=t.m_next)t.m_proxy=n.CreateProxy(r.GetFatAABB(t.m_proxy),t)};t.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};t.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};t.prototype.CreateBody=function(t){if(this.IsLocked()==!0)return null;var i=new n(t,this);return i.m_prev=null,i.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=i),this.m_bodyList=i,++this.m_bodyCount,i};t.prototype.DestroyBody=function(n){var t,e,i,o,r,s,u,f;if(this.IsLocked()!=!0){for(t=n.m_jointList;t;)e=t,t=t.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(e.joint),this.DestroyJoint(e.joint);for(i=n.m_controllerList;i;)o=i,i=i.nextController,o.controller.RemoveBody(n);for(r=n.m_contactList;r;)s=r,r=r.next,this.m_contactManager.Destroy(s.contact);for(n.m_contactList=null,u=n.m_fixtureList;u;)f=u,u=u.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(f),f.DestroyProxy(this.m_contactManager.m_broadPhase),f.Destroy();n.m_fixtureList=null;n.m_fixtureCount=0;n.m_prev&&(n.m_prev.m_next=n.m_next);n.m_next&&(n.m_next.m_prev=n.m_prev);n==this.m_bodyList&&(this.m_bodyList=n.m_next);--this.m_bodyCount}};t.prototype.CreateJoint=function(n){var t=y.Create(n,null),r,u,i;if(t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB,r=n.bodyA,u=n.bodyB,n.collideConnected==!1)for(i=u.GetContactList();i;)i.other==r&&i.contact.FlagForFiltering(),i=i.next;return t};t.prototype.DestroyJoint=function(n){var u=n.m_collideConnected,i,r,t;if(n.m_prev&&(n.m_prev.m_next=n.m_next),n.m_next&&(n.m_next.m_prev=n.m_prev),n==this.m_jointList&&(this.m_jointList=n.m_next),i=n.m_bodyA,r=n.m_bodyB,i.SetAwake(!0),r.SetAwake(!0),n.m_edgeA.prev&&(n.m_edgeA.prev.next=n.m_edgeA.next),n.m_edgeA.next&&(n.m_edgeA.next.prev=n.m_edgeA.prev),n.m_edgeA==i.m_jointList&&(i.m_jointList=n.m_edgeA.next),n.m_edgeA.prev=null,n.m_edgeA.next=null,n.m_edgeB.prev&&(n.m_edgeB.prev.next=n.m_edgeB.next),n.m_edgeB.next&&(n.m_edgeB.next.prev=n.m_edgeB.prev),n.m_edgeB==r.m_jointList&&(r.m_jointList=n.m_edgeB.next),n.m_edgeB.prev=null,n.m_edgeB.next=null,y.Destroy(n,null),--this.m_jointCount,u==!1)for(t=r.GetContactList();t;)t.other==i&&t.contact.FlagForFiltering(),t=t.next};t.prototype.AddController=function(n){return n.m_next=this.m_controllerList,n.m_prev=null,this.m_controllerList=n,n.m_world=this,this.m_controllerCount++,n};t.prototype.RemoveController=function(n){n.m_prev&&(n.m_prev.m_next=n.m_next);n.m_next&&(n.m_next.m_prev=n.m_prev);this.m_controllerList==n&&(this.m_controllerList=n.m_next);this.m_controllerCount--};t.prototype.CreateController=function(n){if(n.m_world!=this)throw new Error("Controller can only be a member of one world");return n.m_next=this.m_controllerList,n.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=n),this.m_controllerList=n,++this.m_controllerCount,n.m_world=this,n};t.prototype.DestroyController=function(n){n.Clear();n.m_next&&(n.m_next.m_prev=n.m_prev);n.m_prev&&(n.m_prev.m_next=n.m_next);n==this.m_controllerList&&(this.m_controllerList=n.m_next);--this.m_controllerCount};t.prototype.SetWarmStarting=function(n){t.m_warmStarting=n};t.prototype.SetContinuousPhysics=function(n){t.m_continuousPhysics=n};t.prototype.GetBodyCount=function(){return this.m_bodyCount};t.prototype.GetJointCount=function(){return this.m_jointCount};t.prototype.GetContactCount=function(){return this.m_contactCount};t.prototype.SetGravity=function(n){this.m_gravity=n};t.prototype.GetGravity=function(){return this.m_gravity};t.prototype.GetGroundBody=function(){return this.m_groundBody};t.prototype.Step=function(n,i,r){n===undefined&&(n=0);i===undefined&&(i=0);r===undefined&&(r=0);this.m_flags&t.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~t.e_newFixture);this.m_flags|=t.e_locked;var u=t.s_timestep2;u.dt=n;u.velocityIterations=i;u.positionIterations=r;u.inv_dt=n>0?1/n:0;u.dtRatio=this.m_inv_dt0*n;u.warmStarting=t.m_warmStarting;this.m_contactManager.Collide();u.dt>0&&this.Solve(u);t.m_continuousPhysics&&u.dt>0&&this.SolveTOI(u);u.dt>0&&(this.m_inv_dt0=u.inv_dt);this.m_flags&=~t.e_locked};t.prototype.ClearForces=function(){for(var n=this.m_bodyList;n;n=n.m_next)n.m_force.SetZero(),n.m_torque=0};t.prototype.DrawDebugData=function(){var p,v,s;if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();var c=this.m_debugDraw.GetFlags(),i,f,l,y,w,nt=new e,it=new e,rt=new e,o,ut=new h,ft=new h,a=[new e,new e,new e,new e],r=new tt(0,0,0);if(c&u.e_shapeBit)for(i=this.m_bodyList;i;i=i.m_next)for(o=i.m_xf,f=i.GetFixtureList();f;f=f.m_next)l=f.GetShape(),i.IsActive()==!1?(r.Set(.5,.5,.3),this.DrawShape(l,o,r)):i.GetType()==n.b2_staticBody?(r.Set(.5,.9,.5),this.DrawShape(l,o,r)):i.GetType()==n.b2_kinematicBody?(r.Set(.5,.5,.9),this.DrawShape(l,o,r)):i.IsAwake()==!1?(r.Set(.6,.6,.6),this.DrawShape(l,o,r)):(r.Set(.9,.7,.7),this.DrawShape(l,o,r));if(c&u.e_jointBit)for(y=this.m_jointList;y;y=y.m_next)this.DrawJoint(y);if(c&u.e_controllerBit)for(p=this.m_controllerList;p;p=p.m_next)p.Draw(this.m_debugDraw);if(c&u.e_pairBit)for(r.Set(.3,.9,.9),v=this.m_contactManager.m_contactList;v;v=v.GetNext()){var b=v.GetFixtureA(),k=v.GetFixtureB(),d=b.GetAABB().GetCenter(),g=k.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(d,g,r)}if(c&u.e_aabbBit)for(w=this.m_contactManager.m_broadPhase,a=[new e,new e,new e,new e],i=this.m_bodyList;i;i=i.GetNext())if(i.IsActive()!=!1)for(f=i.GetFixtureList();f;f=f.GetNext())s=w.GetFatAABB(f.m_proxy),a[0].Set(s.lowerBound.x,s.lowerBound.y),a[1].Set(s.upperBound.x,s.lowerBound.y),a[2].Set(s.upperBound.x,s.upperBound.y),a[3].Set(s.lowerBound.x,s.upperBound.y),this.m_debugDraw.DrawPolygon(a,4,r);if(c&u.e_centerOfMassBit)for(i=this.m_bodyList;i;i=i.m_next)o=t.s_xf,o.R=i.m_xf.R,o.position=i.GetWorldCenter(),this.m_debugDraw.DrawTransform(o)}};t.prototype.QueryAABB=function(n,t){function u(t){return n(i.GetUserData(t))}var r=this,i=r.m_contactManager.m_broadPhase;i.Query(u,t)};t.prototype.QueryShape=function(n,t,r){function o(f){var e=u.GetUserData(f)instanceof i?u.GetUserData(f):null;return w.TestOverlap(t,r,e.GetShape(),e.GetBody().GetTransform())?n(e):!0}var e=this,u,f;r===undefined&&(r=null);r==null&&(r=new p,r.SetIdentity());u=e.m_contactManager.m_broadPhase;f=new h;t.ComputeAABB(f,r);u.Query(o,f)};t.prototype.QueryPoint=function(n,t){function o(r){var f=u.GetUserData(r)instanceof i?u.GetUserData(r):null;return f.TestPoint(t)?n(f):!0}var e=this,u=e.m_contactManager.m_broadPhase,f=new h;f.lowerBound.Set(t.x-r.b2_linearSlop,t.y-r.b2_linearSlop);f.upperBound.Set(t.x+r.b2_linearSlop,t.y+r.b2_linearSlop);u.Query(o,f)};t.prototype.RayCast=function(n,t,r){function s(o,s){var c=f.GetUserData(s),l=c instanceof i?c:null,v=l.RayCast(u,o),h,a;return v?(h=u.fraction,a=new e((1-h)*t.x+h*r.x,(1-h)*t.y+h*r.y),n(l,a,u.normal,h)):o.maxFraction}var o=this,f=o.m_contactManager.m_broadPhase,u=new et,h=new ft(t,r);f.RayCast(s,h)};t.prototype.RayCastOne=function(n,t){function u(n,t,r,u){return u===undefined&&(u=0),i=n,u}var r=this,i;return r.RayCast(u,n,t),i};t.prototype.RayCastAll=function(n,t){function u(n,t,r,u){return u===undefined&&(u=0),i[i.length]=n,1}var r=this,i=new Vector;return r.RayCast(u,n,t),i};t.prototype.GetBodyList=function(){return this.m_bodyList};t.prototype.GetJointList=function(){return this.m_jointList};t.prototype.GetContactList=function(){return this.m_contactList};t.prototype.IsLocked=function(){return(this.m_flags&t.e_locked)>0};t.prototype.Solve=function(t){for(var f,a,v,p,h,u,l,e,r,c,s,i,y=this.m_controllerList;y;y=y.m_next)y.Step(t);for(f=this.m_island,f.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),i=this.m_bodyList;i;i=i.m_next)i.m_flags&=~n.e_islandFlag;for(a=this.m_contactList;a;a=a.m_next)a.m_flags&=~o.e_islandFlag;for(v=this.m_jointList;v;v=v.m_next)v.m_islandFlag=!1;for(p=parseInt(this.m_bodyCount),h=this.s_stack,u=this.m_bodyList;u;u=u.m_next)if(!(u.m_flags&n.e_islandFlag)&&u.IsAwake()!=!1&&u.IsActive()!=!1&&u.GetType()!=n.b2_staticBody){for(f.Clear(),l=0,h[l++]=u,u.m_flags|=n.e_islandFlag;l>0;)if(i=h[--l],f.AddBody(i),i.IsAwake()==!1&&i.SetAwake(!0),i.GetType()!=n.b2_staticBody){for(r=i.m_contactList;r;r=r.next)r.contact.m_flags&o.e_islandFlag||r.contact.IsSensor()!=!0&&r.contact.IsEnabled()!=!1&&r.contact.IsTouching()!=!1&&((f.AddContact(r.contact),r.contact.m_flags|=o.e_islandFlag,e=r.other,e.m_flags&n.e_islandFlag)||(h[l++]=e,e.m_flags|=n.e_islandFlag));for(c=i.m_jointList;c;c=c.next)c.joint.m_islandFlag!=!0&&(e=c.other,e.IsActive()!=!1)&&((f.AddJoint(c.joint),c.joint.m_islandFlag=!0,e.m_flags&n.e_islandFlag)||(h[l++]=e,e.m_flags|=n.e_islandFlag))}for(f.Solve(t,this.m_gravity,this.m_allowSleep),s=0;s<f.m_bodyCount;++s)i=f.m_bodies[s],i.GetType()==n.b2_staticBody&&(i.m_flags&=~n.e_islandFlag)}for(s=0;s<h.length;++s){if(!h[s])break;h[s]=null}for(i=this.m_bodyList;i;i=i.m_next)i.IsAwake()!=!1&&i.IsActive()!=!1&&i.GetType()!=n.b2_staticBody&&i.SynchronizeFixtures();this.m_contactManager.FindNewContacts()};t.prototype.SolveTOI=function(i){var f,rt,ut,c,a,e,d,s=this.m_island,nt,u,y,p,h,g,tt,it,b,l,k,w,v;for(s.Initialize(this.m_bodyCount,r.b2_maxTOIContactsPerIsland,r.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver),nt=t.s_queue,f=this.m_bodyList;f;f=f.m_next)f.m_flags&=~n.e_islandFlag,f.m_sweep.t0=0;for(u=this.m_contactList;u;u=u.m_next)u.m_flags&=~(o.e_toiFlag|o.e_islandFlag);for(d=this.m_jointList;d;d=d.m_next)d.m_islandFlag=!1;for(;;){for(y=null,p=1,u=this.m_contactList;u;u=u.m_next)if(u.IsSensor()!=!0&&u.IsEnabled()!=!1&&u.IsContinuous()!=!1){if(h=1,u.m_flags&o.e_toiFlag)h=u.m_toi;else{if(rt=u.m_fixtureA,ut=u.m_fixtureB,c=rt.m_body,a=ut.m_body,(c.GetType()!=n.b2_dynamicBody||c.IsAwake()==!1)&&(a.GetType()!=n.b2_dynamicBody||a.IsAwake()==!1))continue;g=c.m_sweep.t0;c.m_sweep.t0<a.m_sweep.t0?(g=a.m_sweep.t0,c.m_sweep.Advance(g)):a.m_sweep.t0<c.m_sweep.t0&&(g=c.m_sweep.t0,a.m_sweep.Advance(g));h=u.ComputeTOI(c.m_sweep,a.m_sweep);r.b2Assert(0<=h&&h<=1);h>0&&h<1&&(h=(1-h)*g+h,h>1&&(h=1));u.m_toi=h;u.m_flags|=o.e_toiFlag}Number.MIN_VALUE<h&&h<p&&(y=u,p=h)}if(y==null||1-100*Number.MIN_VALUE<p)break;if(rt=y.m_fixtureA,ut=y.m_fixtureB,c=rt.m_body,a=ut.m_body,t.s_backupA.Set(c.m_sweep),t.s_backupB.Set(a.m_sweep),c.Advance(p),a.Advance(p),y.Update(this.m_contactManager.m_contactListener),y.m_flags&=~o.e_toiFlag,y.IsSensor()==!0||y.IsEnabled()==!1){c.m_sweep.Set(t.s_backupA);a.m_sweep.Set(t.s_backupB);c.SynchronizeTransform();a.SynchronizeTransform();continue}if(y.IsTouching()!=!1){for(tt=c,tt.GetType()!=n.b2_dynamicBody&&(tt=a),s.Clear(),it=0,b=0,nt[it+b++]=tt,tt.m_flags|=n.e_islandFlag;b>0;)if(f=nt[it++],--b,s.AddBody(f),f.IsAwake()==!1&&f.SetAwake(!0),f.GetType()==n.b2_dynamicBody){for(e=f.m_contactList;e;e=e.next){if(s.m_contactCount==s.m_contactCapacity)break;e.contact.m_flags&o.e_islandFlag||e.contact.IsSensor()!=!0&&e.contact.IsEnabled()!=!1&&e.contact.IsTouching()!=!1&&((s.AddContact(e.contact),e.contact.m_flags|=o.e_islandFlag,l=e.other,l.m_flags&n.e_islandFlag)||(l.GetType()!=n.b2_staticBody&&(l.Advance(p),l.SetAwake(!0)),nt[it+b]=l,++b,l.m_flags|=n.e_islandFlag))}for(k=f.m_jointList;k;k=k.next)s.m_jointCount!=s.m_jointCapacity&&k.joint.m_islandFlag!=!0&&(l=k.other,l.IsActive()!=!1)&&((s.AddJoint(k.joint),k.joint.m_islandFlag=!0,l.m_flags&n.e_islandFlag)||(l.GetType()!=n.b2_staticBody&&(l.Advance(p),l.SetAwake(!0)),nt[it+b]=l,++b,l.m_flags|=n.e_islandFlag))}for(w=t.s_timestep,w.warmStarting=!1,w.dt=(1-p)*i.dt,w.inv_dt=1/w.dt,w.dtRatio=0,w.velocityIterations=i.velocityIterations,w.positionIterations=i.positionIterations,s.SolveTOI(w),v=0,v=0;v<s.m_bodyCount;++v)if((f=s.m_bodies[v],f.m_flags&=~n.e_islandFlag,f.IsAwake()!=!1)&&f.GetType()==n.b2_dynamicBody)for(f.SynchronizeFixtures(),e=f.m_contactList;e;e=e.next)e.contact.m_flags&=~o.e_toiFlag;for(v=0;v<s.m_contactCount;++v)u=s.m_contacts[v],u.m_flags&=~(o.e_toiFlag|o.e_islandFlag);for(v=0;v<s.m_jointCount;++v)d=s.m_joints[v],d.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}};t.prototype.DrawJoint=function(n){var f=n.GetBodyA(),e=n.GetBodyB(),c=f.m_xf,l=e.m_xf,a=c.position,v=l.position,r=n.GetAnchorA(),u=n.GetAnchorB(),i=t.s_jointColor;switch(n.m_type){case y.e_distanceJoint:this.m_debugDraw.DrawSegment(r,u,i);break;case y.e_pulleyJoint:var o=n instanceof vt?n:null,s=o.GetGroundAnchorA(),h=o.GetGroundAnchorB();this.m_debugDraw.DrawSegment(s,r,i);this.m_debugDraw.DrawSegment(h,u,i);this.m_debugDraw.DrawSegment(s,h,i);break;case y.e_mouseJoint:this.m_debugDraw.DrawSegment(r,u,i);break;default:f!=this.m_groundBody&&this.m_debugDraw.DrawSegment(a,r,i);this.m_debugDraw.DrawSegment(r,u,i);e!=this.m_groundBody&&this.m_debugDraw.DrawSegment(v,u,i)}};t.prototype.DrawShape=function(n,t,i){var e;switch(n.m_type){case w.e_circleShape:var o=n instanceof ot?n:null,c=f.MulX(t,o.m_p),l=o.m_radius,a=t.R.col1;this.m_debugDraw.DrawSolidCircle(c,l,a,i);break;case w.e_polygonShape:for(var r=0,s=n instanceof ct?n:null,u=parseInt(s.GetVertexCount()),v=s.GetVertices(),h=new Vector(u),r=0;r<u;++r)h[r]=f.MulX(t,v[r]);this.m_debugDraw.DrawSolidPolygon(h,u,i);break;case w.e_edgeShape:e=n instanceof st?n:null;this.m_debugDraw.DrawSegment(f.MulX(t,e.GetVertex1()),f.MulX(t,e.GetVertex2()),i)}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new k;Box2D.Dynamics.b2World.s_xf=new p;Box2D.Dynamics.b2World.s_backupA=new d;Box2D.Dynamics.b2World.s_backupB=new d;Box2D.Dynamics.b2World.s_timestep=new k;Box2D.Dynamics.b2World.s_queue=new Vector;Box2D.Dynamics.b2World.s_jointColor=new tt(.5,.8,.8);Box2D.Dynamics.b2World.e_newFixture=1;Box2D.Dynamics.b2World.e_locked=2})}(),function(){var v=Box2D.Collision.Shapes.b2CircleShape,ct=Box2D.Collision.Shapes.b2EdgeChainDef,g=Box2D.Collision.Shapes.b2EdgeShape,lt=Box2D.Collision.Shapes.b2MassData,y=Box2D.Collision.Shapes.b2PolygonShape,t=Box2D.Collision.Shapes.b2Shape,o=Box2D.Dynamics.Contacts.b2CircleContact,n=Box2D.Dynamics.Contacts.b2Contact,b=Box2D.Dynamics.Contacts.b2ContactConstraint,nt=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,k=Box2D.Dynamics.Contacts.b2ContactEdge,c=Box2D.Dynamics.Contacts.b2ContactFactory,tt=Box2D.Dynamics.Contacts.b2ContactRegister,ut=Box2D.Dynamics.Contacts.b2ContactResult,i=Box2D.Dynamics.Contacts.b2ContactSolver,f=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,l=Box2D.Dynamics.Contacts.b2NullContact,s=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,e=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,h=Box2D.Dynamics.Contacts.b2PolygonContact,p=Box2D.Dynamics.Contacts.b2PositionSolverManifold,w=Box2D.Dynamics.b2Body,at=Box2D.Dynamics.b2BodyDef,vt=Box2D.Dynamics.b2ContactFilter,yt=Box2D.Dynamics.b2ContactImpulse,pt=Box2D.Dynamics.b2ContactListener,wt=Box2D.Dynamics.b2ContactManager,bt=Box2D.Dynamics.b2DebugDraw,kt=Box2D.Dynamics.b2DestructionListener,dt=Box2D.Dynamics.b2FilterData,gt=Box2D.Dynamics.b2Fixture,ni=Box2D.Dynamics.b2FixtureDef,ti=Box2D.Dynamics.b2Island,ft=Box2D.Dynamics.b2TimeStep,ii=Box2D.Dynamics.b2World,ri=Box2D.Common.b2Color,ui=Box2D.Common.b2internal,r=Box2D.Common.b2Settings,it=Box2D.Common.Math.b2Mat22,fi=Box2D.Common.Math.b2Mat33,rt=Box2D.Common.Math.b2Math,ei=Box2D.Common.Math.b2Sweep,oi=Box2D.Common.Math.b2Transform,u=Box2D.Common.Math.b2Vec2,si=Box2D.Common.Math.b2Vec3,hi=Box2D.Collision.b2AABB,ci=Box2D.Collision.b2Bound,li=Box2D.Collision.b2BoundValues,d=Box2D.Collision.b2Collision,et=Box2D.Collision.b2ContactID,ai=Box2D.Collision.b2ContactPoint,vi=Box2D.Collision.b2Distance,yi=Box2D.Collision.b2DistanceInput,pi=Box2D.Collision.b2DistanceOutput,wi=Box2D.Collision.b2DistanceProxy,bi=Box2D.Collision.b2DynamicTree,ki=Box2D.Collision.b2DynamicTreeBroadPhase,di=Box2D.Collision.b2DynamicTreeNode,gi=Box2D.Collision.b2DynamicTreePair,a=Box2D.Collision.b2Manifold,nr=Box2D.Collision.b2ManifoldPoint,tr=Box2D.Collision.b2Point,ir=Box2D.Collision.b2RayCastInput,rr=Box2D.Collision.b2RayCastOutput,ur=Box2D.Collision.b2Segment,fr=Box2D.Collision.b2SeparationFunction,er=Box2D.Collision.b2Simplex,or=Box2D.Collision.b2SimplexCache,sr=Box2D.Collision.b2SimplexVertex,ot=Box2D.Collision.b2TimeOfImpact,st=Box2D.Collision.b2TOIInput,ht=Box2D.Collision.b2WorldManifold,hr=Box2D.Collision.ClipVertex,cr=Box2D.Collision.Features,lr=Box2D.Collision.IBroadPhase;Box2D.inherit(o,Box2D.Dynamics.Contacts.b2Contact);o.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;o.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};o.Create=function(){return new o};o.Destroy=function(){};o.prototype.Reset=function(n,t){this.__super.Reset.call(this,n,t)};o.prototype.Evaluate=function(){var n=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();d.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof v?this.m_fixtureA.GetShape():null,n.m_xf,this.m_fixtureB.GetShape()instanceof v?this.m_fixtureB.GetShape():null,t.m_xf)};n.b2Contact=function(){this.m_nodeA=new k;this.m_nodeB=new k;this.m_manifold=new a;this.m_oldManifold=new a};n.prototype.GetManifold=function(){return this.m_manifold};n.prototype.GetWorldManifold=function(n){var t=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),r=this.m_fixtureA.GetShape(),u=this.m_fixtureB.GetShape();n.Initialize(this.m_manifold,t.GetTransform(),r.m_radius,i.GetTransform(),u.m_radius)};n.prototype.IsTouching=function(){return(this.m_flags&n.e_touchingFlag)==n.e_touchingFlag};n.prototype.IsContinuous=function(){return(this.m_flags&n.e_continuousFlag)==n.e_continuousFlag};n.prototype.SetSensor=function(t){t?this.m_flags|=n.e_sensorFlag:this.m_flags&=~n.e_sensorFlag};n.prototype.IsSensor=function(){return(this.m_flags&n.e_sensorFlag)==n.e_sensorFlag};n.prototype.SetEnabled=function(t){t?this.m_flags|=n.e_enabledFlag:this.m_flags&=~n.e_enabledFlag};n.prototype.IsEnabled=function(){return(this.m_flags&n.e_enabledFlag)==n.e_enabledFlag};n.prototype.GetNext=function(){return this.m_next};n.prototype.GetFixtureA=function(){return this.m_fixtureA};n.prototype.GetFixtureB=function(){return this.m_fixtureB};n.prototype.FlagForFiltering=function(){this.m_flags|=n.e_filterFlag};n.prototype.b2Contact=function(){};n.prototype.Reset=function(t,i){if(t===undefined&&(t=null),i===undefined&&(i=null),this.m_flags=n.e_enabledFlag,!t||!i){this.m_fixtureA=null;this.m_fixtureB=null;return}(t.IsSensor()||i.IsSensor())&&(this.m_flags|=n.e_sensorFlag);var r=t.GetBody(),u=i.GetBody();(r.GetType()!=w.b2_dynamicBody||r.IsBullet()||u.GetType()!=w.b2_dynamicBody||u.IsBullet())&&(this.m_flags|=n.e_continuousFlag);this.m_fixtureA=t;this.m_fixtureB=i;this.m_manifold.m_pointCount=0;this.m_prev=null;this.m_next=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null};n.prototype.Update=function(i){var l=i.PreCheck(this,this.m_oldManifold),a,o,u,y,s,h;if(!l||!l.bypassCollision){a=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=a;this.m_flags|=n.e_enabledFlag;var r=!1,c=(this.m_flags&n.e_touchingFlag)==n.e_touchingFlag,f=this.m_fixtureA.m_body,e=this.m_fixtureB.m_body,v=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&n.e_sensorFlag){if(v){var p=this.m_fixtureA.GetShape(),b=this.m_fixtureB.GetShape(),k=f.GetTransform(),d=e.GetTransform();r=t.TestOverlap(p,k,b,d)}this.m_manifold.m_pointCount=0}else{if(f.GetType()!=w.b2_dynamicBody||f.IsBullet()||e.GetType()!=w.b2_dynamicBody||e.IsBullet()?this.m_flags|=n.e_continuousFlag:this.m_flags&=~n.e_continuousFlag,v){for(this.Evaluate(),r=this.m_manifold.m_pointCount>0,o=0;o<this.m_manifold.m_pointCount;++o)for(u=this.m_manifold.m_points[o],u.m_normalImpulse=0,u.m_tangentImpulse=0,y=u.m_id,s=0;s<this.m_oldManifold.m_pointCount;++s)if(h=this.m_oldManifold.m_points[s],h.m_id.key==y.key){u.m_normalImpulse=h.m_normalImpulse;u.m_tangentImpulse=h.m_tangentImpulse;break}}else this.m_manifold.m_pointCount=0;r!=c&&(f.SetAwake(!0),e.SetAwake(!0))}r?this.m_flags|=n.e_touchingFlag:this.m_flags&=~n.e_touchingFlag;c==!1&&r==!0&&i.BeginContact(this);c==!0&&r==!1&&i.EndContact(this)}};n.prototype.Evaluate=function(){};n.prototype.ComputeTOI=function(t,i){return n.s_input.proxyA.Set(this.m_fixtureA.GetShape()),n.s_input.proxyB.Set(this.m_fixtureB.GetShape()),n.s_input.sweepA=t,n.s_input.sweepB=i,n.s_input.tolerance=r.b2_linearSlop,ot.TimeOfImpact(n.s_input)};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1;Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2;Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4;Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8;Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16;Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32;Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64;Box2D.Dynamics.Contacts.b2Contact.s_input=new st});b.b2ContactConstraint=function(){this.localPlaneNormal=new u;this.localPoint=new u;this.normal=new u;this.normalMass=new it;this.K=new it};b.prototype.b2ContactConstraint=function(){this.points=new Vector(r.b2_maxManifoldPoints);for(var n=0;n<r.b2_maxManifoldPoints;n++)this.points[n]=new nt};nt.b2ContactConstraintPoint=function(){this.localPoint=new u;this.rA=new u;this.rB=new u};k.b2ContactEdge=function(){};c.b2ContactFactory=function(){};c.prototype.b2ContactFactory=function(n){this.m_allocator=n;this.InitializeRegisters()};c.prototype.AddType=function(n,t,i,r){i===undefined&&(i=0);r===undefined&&(r=0);this.m_registers[i][r].createFcn=n;this.m_registers[i][r].destroyFcn=t;this.m_registers[i][r].primary=!0;i!=r&&(this.m_registers[r][i].createFcn=n,this.m_registers[r][i].destroyFcn=t,this.m_registers[r][i].primary=!1)};c.prototype.InitializeRegisters=function(){var n,i;for(this.m_registers=new Vector(t.e_shapeTypeCount),n=0;n<t.e_shapeTypeCount;n++)for(this.m_registers[n]=new Vector(t.e_shapeTypeCount),i=0;i<t.e_shapeTypeCount;i++)this.m_registers[n][i]=new tt;this.AddType(o.Create,o.Destroy,t.e_circleShape,t.e_circleShape);this.AddType(s.Create,s.Destroy,t.e_polygonShape,t.e_circleShape);this.AddType(h.Create,h.Destroy,t.e_polygonShape,t.e_polygonShape);this.AddType(f.Create,f.Destroy,t.e_edgeShape,t.e_circleShape);this.AddType(e.Create,e.Destroy,t.e_polygonShape,t.e_edgeShape)};c.prototype.Create=function(n,t){var f=parseInt(n.GetType()),e=parseInt(t.GetType()),r=this.m_registers[f][e],i,u;return r.pool?(i=r.pool,r.pool=i.m_next,r.poolCount--,i.Reset(n,t),i):(u=r.createFcn,u!=null?r.primary?(i=u(this.m_allocator),i.Reset(n,t),i):(i=u(this.m_allocator),i.Reset(t,n),i):null)};c.prototype.Destroy=function(n){var i;n.m_manifold.m_pointCount>0&&(n.m_fixtureA.m_body.SetAwake(!0),n.m_fixtureB.m_body.SetAwake(!0));var r=parseInt(n.m_fixtureA.GetType()),u=parseInt(n.m_fixtureB.GetType()),t=this.m_registers[r][u];!0&&(t.poolCount++,n.m_next=t.pool,t.pool=n);i=t.destroyFcn;i(n,this.m_allocator)};tt.b2ContactRegister=function(){};ut.b2ContactResult=function(){this.position=new u;this.normal=new u;this.id=new et};i.b2ContactSolver=function(){this.m_step=new ft;this.m_constraints=new Vector};i.prototype.b2ContactSolver=function(){};i.prototype.Initialize=function(n,t,u,f){var p,y,l,d,h,ri,ht,ei;for(u===undefined&&(u=0),this.m_step.Set(n),this.m_allocator=f,y=0,this.m_constraintCount=u;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new b;for(y=0;y<u;++y){p=t[y];var w=p.m_fixtureA,k=p.m_fixtureB,hi=w.m_shape,ci=k.m_shape,gt=hi.m_radius,ni=ci.m_radius,o=w.m_body,s=k.m_body,c=p.GetManifold(),li=r.b2MixFriction(w.GetFriction(),k.GetFriction()),ai=r.b2MixRestitution(w.GetRestitution(),k.GetRestitution()),vi=o.m_linearVelocity.x,yi=o.m_linearVelocity.y,pi=s.m_linearVelocity.x,wi=s.m_linearVelocity.y,ti=o.m_angularVelocity,ii=s.m_angularVelocity;r.b2Assert(c.m_pointCount>0);i.s_worldManifold.Initialize(c,o.m_xf,gt,s.m_xf,ni);var a=i.s_worldManifold.m_normal.x,v=i.s_worldManifold.m_normal.y,e=this.m_constraints[y];for(e.bodyA=o,e.bodyB=s,e.manifold=c,e.normal.x=a,e.normal.y=v,e.pointCount=c.m_pointCount,e.friction=li,e.restitution=ai,e.localPlaneNormal.x=c.m_localPlaneNormal.x,e.localPlaneNormal.y=c.m_localPlaneNormal.y,e.localPoint.x=c.m_localPoint.x,e.localPoint.y=c.m_localPoint.y,e.radius=gt+ni,e.type=c.m_type,l=0;l<e.pointCount;++l){d=c.m_points[l];h=e.points[l];h.normalImpulse=d.m_normalImpulse;h.tangentImpulse=d.m_tangentImpulse;h.localPoint.SetV(d.m_localPoint);var ft=h.rA.x=i.s_worldManifold.m_points[l].x-o.m_sweep.c.x,et=h.rA.y=i.s_worldManifold.m_points[l].y-o.m_sweep.c.y,ot=h.rB.x=i.s_worldManifold.m_points[l].x-s.m_sweep.c.x,st=h.rB.y=i.s_worldManifold.m_points[l].y-s.m_sweep.c.y,g=ft*v-et*a,nt=ot*v-st*a;g*=g;nt*=nt;ri=o.m_invMass+s.m_invMass+o.m_invI*g+s.m_invI*nt;h.normalMass=1/ri;ht=o.m_mass*o.m_invMass+s.m_mass*s.m_invMass;ht+=o.m_mass*o.m_invI*g+s.m_mass*s.m_invI*nt;h.equalizedMass=1/ht;var ui=v,fi=-a,ct=ft*fi-et*ui,lt=ot*fi-st*ui;ct*=ct;lt*=lt;ei=o.m_invMass+s.m_invMass+o.m_invI*ct+s.m_invI*lt;h.tangentMass=1/ei;h.velocityBias=0;var bi=pi+-ii*st-vi- -ti*et,ki=wi+ii*ot-yi-ti*ft,oi=e.normal.x*bi+e.normal.y*ki;oi<-r.b2_velocityThreshold&&(h.velocityBias+=-e.restitution*oi)}if(e.pointCount==2){var tt=e.points[0],it=e.points[1],at=o.m_invMass,vt=o.m_invI,yt=s.m_invMass,pt=s.m_invI,wt=tt.rA.x*v-tt.rA.y*a,bt=tt.rB.x*v-tt.rB.y*a,kt=it.rA.x*v-it.rA.y*a,dt=it.rB.x*v-it.rB.y*a,rt=at+yt+vt*wt*wt+pt*bt*bt,si=at+yt+vt*kt*kt+pt*dt*dt,ut=at+yt+vt*wt*kt+pt*bt*dt;rt*rt<100*(rt*si-ut*ut)?(e.K.col1.Set(rt,ut),e.K.col2.Set(ut,si),e.K.GetInverse(e.normalMass)):e.pointCount=1}}};i.prototype.InitVelocityConstraints=function(n){for(var t,e,o,c,h=0;h<this.m_constraintCount;++h){var i=this.m_constraints[h],u=i.bodyA,f=i.bodyB,l=u.m_invMass,p=u.m_invI,a=f.m_invMass,w=f.m_invI,v=i.normal.x,y=i.normal.y,b=y,k=-v,r=0,s=0;if(n.warmStarting)for(s=i.pointCount,r=0;r<s;++r)t=i.points[r],t.normalImpulse*=n.dtRatio,t.tangentImpulse*=n.dtRatio,e=t.normalImpulse*v+t.tangentImpulse*b,o=t.normalImpulse*y+t.tangentImpulse*k,u.m_angularVelocity-=p*(t.rA.x*o-t.rA.y*e),u.m_linearVelocity.x-=l*e,u.m_linearVelocity.y-=l*o,f.m_angularVelocity+=w*(t.rB.x*o-t.rB.y*e),f.m_linearVelocity.x+=a*e,f.m_linearVelocity.y+=a*o;else for(s=i.pointCount,r=0;r<s;++r)c=i.points[r],c.normalImpulse=0,c.tangentImpulse=0}};i.prototype.SolveVelocityConstraints=function(){for(var ui,hi,a,v,pt=0,n,wt=0,bt=0,gt=0,ni=0,g=0,kt=0,ut=0,nt=0,tt=0,w=0,b=0,r=0,u=0,f=0,e=0,it,dt=0;dt<this.m_constraintCount;++dt){var h=this.m_constraints[dt],vt=h.bodyA,yt=h.bodyB,c=vt.m_angularVelocity,l=yt.m_angularVelocity,o=vt.m_linearVelocity,s=yt.m_linearVelocity,k=vt.m_invMass,ft=vt.m_invI,d=yt.m_invMass,et=yt.m_invI,y=h.normal.x,p=h.normal.y,ti=p,ii=-y,ri=h.friction;for(pt=0;pt<h.pointCount;pt++)n=h.points[pt],wt=s.x-l*n.rB.y-o.x+c*n.rA.y,bt=s.y+l*n.rB.x-o.y-c*n.rA.x,ni=wt*ti+bt*ii,g=n.tangentMass*-ni,kt=ri*n.normalImpulse,ut=rt.Clamp(n.tangentImpulse+g,-kt,kt),g=ut-n.tangentImpulse,nt=g*ti,tt=g*ii,o.x-=k*nt,o.y-=k*tt,c-=ft*(n.rA.x*tt-n.rA.y*nt),s.x+=d*nt,s.y+=d*tt,l+=et*(n.rB.x*tt-n.rB.y*nt),n.tangentImpulse=ut;if(ui=parseInt(h.pointCount),h.pointCount==1)n=h.points[0],wt=s.x+-l*n.rB.y-o.x- -c*n.rA.y,bt=s.y+l*n.rB.x-o.y-c*n.rA.x,gt=wt*y+bt*p,g=-n.normalMass*(gt-n.velocityBias),ut=n.normalImpulse+g,ut=ut>0?ut:0,g=ut-n.normalImpulse,nt=g*y,tt=g*p,o.x-=k*nt,o.y-=k*tt,c-=ft*(n.rA.x*tt-n.rA.y*nt),s.x+=d*nt,s.y+=d*tt,l+=et*(n.rB.x*tt-n.rB.y*nt),n.normalImpulse=ut;else{var t=h.points[0],i=h.points[1],ot=t.normalImpulse,st=i.normalImpulse,fi=s.x-l*t.rB.y-o.x+c*t.rA.y,ei=s.y+l*t.rB.x-o.y-c*t.rA.x,oi=s.x-l*i.rB.y-o.x+c*i.rA.y,si=s.y+l*i.rB.x-o.y-c*i.rA.x,ht=fi*y+ei*p,ct=oi*y+si*p,lt=ht-t.velocityBias,at=ct-i.velocityBias;for(it=h.K,lt-=it.col1.x*ot+it.col2.x*st,at-=it.col1.y*ot+it.col2.y*st,hi=.001;;){if(it=h.normalMass,a=-(it.col1.x*lt+it.col2.x*at),v=-(it.col1.y*lt+it.col2.y*at),a>=0&&v>=0){w=a-ot;b=v-st;r=w*y;u=w*p;f=b*y;e=b*p;o.x-=k*(r+f);o.y-=k*(u+e);c-=ft*(t.rA.x*u-t.rA.y*r+i.rA.x*e-i.rA.y*f);s.x+=d*(r+f);s.y+=d*(u+e);l+=et*(t.rB.x*u-t.rB.y*r+i.rB.x*e-i.rB.y*f);t.normalImpulse=a;i.normalImpulse=v;break}if(a=-t.normalMass*lt,v=0,ht=0,ct=h.K.col1.y*a+at,a>=0&&ct>=0){w=a-ot;b=v-st;r=w*y;u=w*p;f=b*y;e=b*p;o.x-=k*(r+f);o.y-=k*(u+e);c-=ft*(t.rA.x*u-t.rA.y*r+i.rA.x*e-i.rA.y*f);s.x+=d*(r+f);s.y+=d*(u+e);l+=et*(t.rB.x*u-t.rB.y*r+i.rB.x*e-i.rB.y*f);t.normalImpulse=a;i.normalImpulse=v;break}if(a=0,v=-i.normalMass*at,ht=h.K.col2.x*v+lt,ct=0,v>=0&&ht>=0){w=a-ot;b=v-st;r=w*y;u=w*p;f=b*y;e=b*p;o.x-=k*(r+f);o.y-=k*(u+e);c-=ft*(t.rA.x*u-t.rA.y*r+i.rA.x*e-i.rA.y*f);s.x+=d*(r+f);s.y+=d*(u+e);l+=et*(t.rB.x*u-t.rB.y*r+i.rB.x*e-i.rB.y*f);t.normalImpulse=a;i.normalImpulse=v;break}if(a=0,v=0,ht=lt,ct=at,ht>=0&&ct>=0){w=a-ot;b=v-st;r=w*y;u=w*p;f=b*y;e=b*p;o.x-=k*(r+f);o.y-=k*(u+e);c-=ft*(t.rA.x*u-t.rA.y*r+i.rA.x*e-i.rA.y*f);s.x+=d*(r+f);s.y+=d*(u+e);l+=et*(t.rB.x*u-t.rB.y*r+i.rB.x*e-i.rB.y*f);t.normalImpulse=a;i.normalImpulse=v;break}break}}vt.m_angularVelocity=c;yt.m_angularVelocity=l}};i.prototype.FinalizeVelocityConstraints=function(){for(var i,f,n,r,u,t=0;t<this.m_constraintCount;++t)for(i=this.m_constraints[t],f=i.manifold,n=0;n<i.pointCount;++n)r=f.m_points[n],u=i.points[n],r.m_normalImpulse=u.normalImpulse,r.m_tangentImpulse=u.tangentImpulse};i.prototype.SolvePositionConstraints=function(n){var e,s,a,f;for(n===undefined&&(n=0),e=0,s=0;s<this.m_constraintCount;s++){var o=this.m_constraints[s],t=o.bodyA,u=o.bodyB,y=t.m_mass*t.m_invMass,b=t.m_mass*t.m_invI,p=u.m_mass*u.m_invMass,k=u.m_mass*u.m_invI;for(i.s_psm.Initialize(o),a=i.s_psm.m_normal,f=0;f<o.pointCount;f++){var d=o.points[f],h=i.s_psm.m_points[f],v=i.s_psm.m_separations[f],g=h.x-t.m_sweep.c.x,nt=h.y-t.m_sweep.c.y,tt=h.x-u.m_sweep.c.x,it=h.y-u.m_sweep.c.y;e=e<v?e:v;var ut=rt.Clamp(n*(v+r.b2_linearSlop),-r.b2_maxLinearCorrection,0),w=-d.equalizedMass*ut,c=w*a.x,l=w*a.y;t.m_sweep.c.x-=y*c;t.m_sweep.c.y-=y*l;t.m_sweep.a-=b*(g*l-nt*c);t.SynchronizeTransform();u.m_sweep.c.x+=p*c;u.m_sweep.c.y+=p*l;u.m_sweep.a+=k*(tt*l-it*c);u.SynchronizeTransform()}}return e>-1.5*r.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new ht;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new p});Box2D.inherit(f,Box2D.Dynamics.Contacts.b2Contact);f.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;f.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};f.Create=function(){return new f};f.Destroy=function(){};f.prototype.Reset=function(n,t){this.__super.Reset.call(this,n,t)};f.prototype.Evaluate=function(){var n=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof g?this.m_fixtureA.GetShape():null,n.m_xf,this.m_fixtureB.GetShape()instanceof v?this.m_fixtureB.GetShape():null,t.m_xf)};f.prototype.b2CollideEdgeAndCircle=function(){};Box2D.inherit(l,Box2D.Dynamics.Contacts.b2Contact);l.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;l.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};l.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};l.prototype.Evaluate=function(){};Box2D.inherit(s,Box2D.Dynamics.Contacts.b2Contact);s.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;s.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};s.Create=function(){return new s};s.Destroy=function(){};s.prototype.Reset=function(n,i){this.__super.Reset.call(this,n,i);r.b2Assert(n.GetType()==t.e_polygonShape);r.b2Assert(i.GetType()==t.e_circleShape)};s.prototype.Evaluate=function(){var n=this.m_fixtureA.m_body,t=this.m_fixtureB.m_body;d.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof y?this.m_fixtureA.GetShape():null,n.m_xf,this.m_fixtureB.GetShape()instanceof v?this.m_fixtureB.GetShape():null,t.m_xf)};Box2D.inherit(e,Box2D.Dynamics.Contacts.b2Contact);e.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;e.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};e.Create=function(){return new e};e.Destroy=function(){};e.prototype.Reset=function(n,i){this.__super.Reset.call(this,n,i);r.b2Assert(n.GetType()==t.e_polygonShape);r.b2Assert(i.GetType()==t.e_edgeShape)};e.prototype.Evaluate=function(){var n=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof y?this.m_fixtureA.GetShape():null,n.m_xf,this.m_fixtureB.GetShape()instanceof g?this.m_fixtureB.GetShape():null,t.m_xf)};e.prototype.b2CollidePolyAndEdge=function(){};Box2D.inherit(h,Box2D.Dynamics.Contacts.b2Contact);h.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;h.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};h.Create=function(){return new h};h.Destroy=function(){};h.prototype.Reset=function(n,t){this.__super.Reset.call(this,n,t)};h.prototype.Evaluate=function(){var n=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();d.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof y?this.m_fixtureA.GetShape():null,n.m_xf,this.m_fixtureB.GetShape()instanceof y?this.m_fixtureB.GetShape():null,t.m_xf)};p.b2PositionSolverManifold=function(){};p.prototype.b2PositionSolverManifold=function(){this.m_normal=new u;this.m_separations=new Vector_a2j_Number(r.b2_maxManifoldPoints);this.m_points=new Vector(r.b2_maxManifoldPoints);for(var n=0;n<r.b2_maxManifoldPoints;n++)this.m_points[n]=new u};p.prototype.Initialize=function(n){var l,v,y;r.b2Assert(n.pointCount>0);var u=0,f=0,e=0,t,i,o=0,s=0;switch(n.type){case a.e_circles:t=n.bodyA.m_xf.R;i=n.localPoint;l=n.bodyA.m_xf.position.x+(t.col1.x*i.x+t.col2.x*i.y);v=n.bodyA.m_xf.position.y+(t.col1.y*i.x+t.col2.y*i.y);t=n.bodyB.m_xf.R;i=n.points[0].localPoint;var p=n.bodyB.m_xf.position.x+(t.col1.x*i.x+t.col2.x*i.y),w=n.bodyB.m_xf.position.y+(t.col1.y*i.x+t.col2.y*i.y),h=p-l,c=w-v,b=h*h+c*c;b>Number.MIN_VALUE*Number.MIN_VALUE?(y=Math.sqrt(b),this.m_normal.x=h/y,this.m_normal.y=c/y):(this.m_normal.x=1,this.m_normal.y=0);this.m_points[0].x=.5*(l+p);this.m_points[0].y=.5*(v+w);this.m_separations[0]=h*this.m_normal.x+c*this.m_normal.y-n.radius;break;case a.e_faceA:for(t=n.bodyA.m_xf.R,i=n.localPlaneNormal,this.m_normal.x=t.col1.x*i.x+t.col2.x*i.y,this.m_normal.y=t.col1.y*i.x+t.col2.y*i.y,t=n.bodyA.m_xf.R,i=n.localPoint,o=n.bodyA.m_xf.position.x+(t.col1.x*i.x+t.col2.x*i.y),s=n.bodyA.m_xf.position.y+(t.col1.y*i.x+t.col2.y*i.y),t=n.bodyB.m_xf.R,u=0;u<n.pointCount;++u)i=n.points[u].localPoint,f=n.bodyB.m_xf.position.x+(t.col1.x*i.x+t.col2.x*i.y),e=n.bodyB.m_xf.position.y+(t.col1.y*i.x+t.col2.y*i.y),this.m_separations[u]=(f-o)*this.m_normal.x+(e-s)*this.m_normal.y-n.radius,this.m_points[u].x=f,this.m_points[u].y=e;break;case a.e_faceB:for(t=n.bodyB.m_xf.R,i=n.localPlaneNormal,this.m_normal.x=t.col1.x*i.x+t.col2.x*i.y,this.m_normal.y=t.col1.y*i.x+t.col2.y*i.y,t=n.bodyB.m_xf.R,i=n.localPoint,o=n.bodyB.m_xf.position.x+(t.col1.x*i.x+t.col2.x*i.y),s=n.bodyB.m_xf.position.y+(t.col1.y*i.x+t.col2.y*i.y),t=n.bodyA.m_xf.R,u=0;u<n.pointCount;++u)i=n.points[u].localPoint,f=n.bodyA.m_xf.position.x+(t.col1.x*i.x+t.col2.x*i.y),e=n.bodyA.m_xf.position.y+(t.col1.y*i.x+t.col2.y*i.y),this.m_separations[u]=(f-o)*this.m_normal.x+(e-s)*this.m_normal.y-n.radius,this.m_points[u].Set(f,e);this.m_normal.x*=-1;this.m_normal.y*=-1}};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new u;Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new u})}(),function(){var l=Box2D.Dynamics.b2Body,a=Box2D.Dynamics.b2BodyDef,v=Box2D.Dynamics.b2ContactFilter,y=Box2D.Dynamics.b2ContactImpulse,p=Box2D.Dynamics.b2ContactListener,w=Box2D.Dynamics.b2ContactManager,b=Box2D.Dynamics.b2DebugDraw,k=Box2D.Dynamics.b2DestructionListener,d=Box2D.Dynamics.b2FilterData,g=Box2D.Dynamics.b2Fixture,nt=Box2D.Dynamics.b2FixtureDef,tt=Box2D.Dynamics.b2Island,it=Box2D.Dynamics.b2TimeStep,rt=Box2D.Dynamics.b2World,s=Box2D.Common.Math.b2Mat22,ut=Box2D.Common.Math.b2Mat33,h=Box2D.Common.Math.b2Math,ft=Box2D.Common.Math.b2Sweep,et=Box2D.Common.Math.b2Transform,n=Box2D.Common.Math.b2Vec2,ot=Box2D.Common.Math.b2Vec3,c=Box2D.Common.b2Color,st=Box2D.Common.b2internal,ht=Box2D.Common.b2Settings,ct=Box2D.Collision.Shapes.b2CircleShape,lt=Box2D.Collision.Shapes.b2EdgeChainDef,at=Box2D.Collision.Shapes.b2EdgeShape,vt=Box2D.Collision.Shapes.b2MassData,yt=Box2D.Collision.Shapes.b2PolygonShape,pt=Box2D.Collision.Shapes.b2Shape,i=Box2D.Dynamics.Controllers.b2BuoyancyController,u=Box2D.Dynamics.Controllers.b2ConstantAccelController,f=Box2D.Dynamics.Controllers.b2ConstantForceController,t=Box2D.Dynamics.Controllers.b2Controller,o=Box2D.Dynamics.Controllers.b2ControllerEdge,e=Box2D.Dynamics.Controllers.b2GravityController,r=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(i,Box2D.Dynamics.Controllers.b2Controller);i.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;i.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new n(0,-1);this.offset=0;this.density=0;this.velocity=new n(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=!1;this.useWorldGravity=!0;this.gravity=null};i.prototype.Step=function(){var e,t,s,f,r,h,a,c;if(this.m_bodyList)for(this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy()),e=this.m_bodyList;e;e=e.nextBody)if(t=e.body,t.IsAwake()!=!1){var u=new n,o=new n,i=0,l=0;for(s=t.GetFixtureList();s;s=s.GetNext())f=new n,r=s.GetShape().ComputeSubmergedArea(this.normal,this.offset,t.GetTransform(),f),i+=r,u.x+=r*f.x,u.y+=r*f.y,h=0,h=this.useDensity?1:1,l+=r*h,o.x+=r*f.x*h,o.y+=r*f.y*h;(u.x/=i,u.y/=i,o.x/=l,o.y/=l,i<Number.MIN_VALUE)||(a=this.gravity.GetNegative(),a.Multiply(this.density*i),t.ApplyForce(a,o),c=t.GetLinearVelocityFromWorldPoint(u),c.Subtract(this.velocity),c.Multiply(-this.linearDrag*i),t.ApplyForce(c,u),t.ApplyTorque(-t.GetInertia()/t.GetMass()*i*t.GetAngularVelocity()*this.angularDrag))}};i.prototype.Draw=function(t){var i=1e3,r=new n,u=new n,f;r.x=this.normal.x*this.offset+this.normal.y*i;r.y=this.normal.y*this.offset-this.normal.x*i;u.x=this.normal.x*this.offset-this.normal.y*i;u.y=this.normal.y*this.offset+this.normal.x*i;f=new c(0,0,1);t.DrawSegment(r,u,f)};Box2D.inherit(u,Box2D.Dynamics.Controllers.b2Controller);u.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;u.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new n(0,0)};u.prototype.Step=function(t){for(var i,u=new n(this.A.x*t.dt,this.A.y*t.dt),r=this.m_bodyList;r;r=r.nextBody)(i=r.body,i.IsAwake())&&i.SetLinearVelocity(new n(i.GetLinearVelocity().x+u.x,i.GetLinearVelocity().y+u.y))};Box2D.inherit(f,Box2D.Dynamics.Controllers.b2Controller);f.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;f.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new n(0,0)};f.prototype.Step=function(){for(var t,n=this.m_bodyList;n;n=n.nextBody)(t=n.body,t.IsAwake())&&t.ApplyForce(this.F,t.GetWorldCenter())};t.b2Controller=function(){};t.prototype.Step=function(){};t.prototype.Draw=function(){};t.prototype.AddBody=function(n){var t=new o;t.controller=this;t.body=n;t.nextBody=this.m_bodyList;t.prevBody=null;this.m_bodyList=t;t.nextBody&&(t.nextBody.prevBody=t);this.m_bodyCount++;t.nextController=n.m_controllerList;t.prevController=null;n.m_controllerList=t;t.nextController&&(t.nextController.prevController=t);n.m_controllerCount++};t.prototype.RemoveBody=function(n){for(var t=n.m_controllerList;t&&t.controller!=this;)t=t.nextController;t.prevBody&&(t.prevBody.nextBody=t.nextBody);t.nextBody&&(t.nextBody.prevBody=t.prevBody);t.nextController&&(t.nextController.prevController=t.prevController);t.prevController&&(t.prevController.nextController=t.nextController);this.m_bodyList==t&&(this.m_bodyList=t.nextBody);n.m_controllerList==t&&(n.m_controllerList=t.nextController);n.m_controllerCount--;this.m_bodyCount--};t.prototype.Clear=function(){while(this.m_bodyList)this.RemoveBody(this.m_bodyList.body)};t.prototype.GetNext=function(){return this.m_next};t.prototype.GetWorld=function(){return this.m_world};t.prototype.GetBodyList=function(){return this.m_bodyList};o.b2ControllerEdge=function(){};Box2D.inherit(e,Box2D.Dynamics.Controllers.b2Controller);e.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;e.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=!0};e.prototype.Step=function(){var t=null,i=null,e=null,l=0,r=null,u=null,o=null,s=0,h=0,c=0,f=null;if(this.invSqr)for(t=this.m_bodyList;t;t=t.nextBody)for(i=t.body,e=i.GetWorldCenter(),l=i.GetMass(),r=this.m_bodyList;r!=t;r=r.nextBody)(u=r.body,o=u.GetWorldCenter(),s=o.x-e.x,h=o.y-e.y,c=s*s+h*h,c<Number.MIN_VALUE)||(f=new n(s,h),f.Multiply(this.G/c/Math.sqrt(c)*l*u.GetMass()),i.IsAwake()&&i.ApplyForce(f,e),f.Multiply(-1),u.IsAwake()&&u.ApplyForce(f,o));else for(t=this.m_bodyList;t;t=t.nextBody)for(i=t.body,e=i.GetWorldCenter(),l=i.GetMass(),r=this.m_bodyList;r!=t;r=r.nextBody)(u=r.body,o=u.GetWorldCenter(),s=o.x-e.x,h=o.y-e.y,c=s*s+h*h,c<Number.MIN_VALUE)||(f=new n(s,h),f.Multiply(this.G/c*l*u.GetMass()),i.IsAwake()&&i.ApplyForce(f,e),f.Multiply(-1),u.IsAwake()&&u.ApplyForce(f,o))};Box2D.inherit(r,Box2D.Dynamics.Controllers.b2Controller);r.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;r.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new s;this.maxTimestep=0};r.prototype.SetAxisAligned=function(n,t){n===undefined&&(n=0);t===undefined&&(t=0);this.T.col1.x=-n;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-t;this.maxTimestep=n>0||t>0?1/Math.max(n,t):0};r.prototype.Step=function(t){var r=t.dt,u,i,f;if(!(r<=Number.MIN_VALUE))for(r>this.maxTimestep&&this.maxTimestep>0&&(r=this.maxTimestep),u=this.m_bodyList;u;u=u.nextBody)(i=u.body,i.IsAwake())&&(f=i.GetWorldVector(h.MulMV(this.T,i.GetLocalVector(i.GetLinearVelocity()))),i.SetLinearVelocity(new n(i.GetLinearVelocity().x+f.x*r,i.GetLinearVelocity().y+f.y*r)))}}(),function(){var ot=Box2D.Common.b2Color,st=Box2D.Common.b2internal,r=Box2D.Common.b2Settings,l=Box2D.Common.Math.b2Mat22,ut=Box2D.Common.Math.b2Mat33,i=Box2D.Common.Math.b2Math,ht=Box2D.Common.Math.b2Sweep,ct=Box2D.Common.Math.b2Transform,t=Box2D.Common.Math.b2Vec2,y=Box2D.Common.Math.b2Vec3,h=Box2D.Dynamics.Joints.b2DistanceJoint,p=Box2D.Dynamics.Joints.b2DistanceJointDef,c=Box2D.Dynamics.Joints.b2FrictionJoint,w=Box2D.Dynamics.Joints.b2FrictionJointDef,a=Box2D.Dynamics.Joints.b2GearJoint,tt=Box2D.Dynamics.Joints.b2GearJointDef,it=Box2D.Dynamics.Joints.b2Jacobian,n=Box2D.Dynamics.Joints.b2Joint,et=Box2D.Dynamics.Joints.b2JointDef,ft=Box2D.Dynamics.Joints.b2JointEdge,e=Box2D.Dynamics.Joints.b2LineJoint,b=Box2D.Dynamics.Joints.b2LineJointDef,s=Box2D.Dynamics.Joints.b2MouseJoint,rt=Box2D.Dynamics.Joints.b2MouseJointDef,f=Box2D.Dynamics.Joints.b2PrismaticJoint,k=Box2D.Dynamics.Joints.b2PrismaticJointDef,o=Box2D.Dynamics.Joints.b2PulleyJoint,d=Box2D.Dynamics.Joints.b2PulleyJointDef,u=Box2D.Dynamics.Joints.b2RevoluteJoint,g=Box2D.Dynamics.Joints.b2RevoluteJointDef,v=Box2D.Dynamics.Joints.b2WeldJoint,nt=Box2D.Dynamics.Joints.b2WeldJointDef,lt=Box2D.Dynamics.b2Body,at=Box2D.Dynamics.b2BodyDef,vt=Box2D.Dynamics.b2ContactFilter,yt=Box2D.Dynamics.b2ContactImpulse,pt=Box2D.Dynamics.b2ContactListener,wt=Box2D.Dynamics.b2ContactManager,bt=Box2D.Dynamics.b2DebugDraw,kt=Box2D.Dynamics.b2DestructionListener,dt=Box2D.Dynamics.b2FilterData,gt=Box2D.Dynamics.b2Fixture,ni=Box2D.Dynamics.b2FixtureDef,ti=Box2D.Dynamics.b2Island,ii=Box2D.Dynamics.b2TimeStep,ri=Box2D.Dynamics.b2World;Box2D.inherit(h,Box2D.Dynamics.Joints.b2Joint);h.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;h.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new t;this.m_localAnchor2=new t;this.m_u=new t};h.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};h.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};h.prototype.GetReactionForce=function(n){return n===undefined&&(n=0),new t(n*this.m_impulse*this.m_u.x,n*this.m_impulse*this.m_u.y)};h.prototype.GetReactionTorque=function(n){return n===undefined&&(n=0),0};h.prototype.GetLength=function(){return this.m_length};h.prototype.SetLength=function(n){n===undefined&&(n=0);this.m_length=n};h.prototype.GetFrequency=function(){return this.m_frequencyHz};h.prototype.SetFrequency=function(n){n===undefined&&(n=0);this.m_frequencyHz=n};h.prototype.GetDampingRatio=function(){return this.m_dampingRatio};h.prototype.SetDampingRatio=function(n){n===undefined&&(n=0);this.m_dampingRatio=n};h.prototype.b2DistanceJoint=function(n){this.__super.b2Joint.call(this,n);this.m_localAnchor1.SetV(n.localAnchorA);this.m_localAnchor2.SetV(n.localAnchorB);this.m_length=n.length;this.m_frequencyHz=n.frequencyHz;this.m_dampingRatio=n.dampingRatio;this.m_impulse=0;this.m_gamma=0;this.m_bias=0};h.prototype.InitVelocityConstraints=function(n){var u,l=0,t=this.m_bodyA,i=this.m_bodyB,f,e,o,s,a,h,c;u=t.m_xf.R;f=this.m_localAnchor1.x-t.m_sweep.localCenter.x;e=this.m_localAnchor1.y-t.m_sweep.localCenter.y;l=u.col1.x*f+u.col2.x*e;e=u.col1.y*f+u.col2.y*e;f=l;u=i.m_xf.R;o=this.m_localAnchor2.x-i.m_sweep.localCenter.x;s=this.m_localAnchor2.y-i.m_sweep.localCenter.y;l=u.col1.x*o+u.col2.x*s;s=u.col1.y*o+u.col2.y*s;o=l;this.m_u.x=i.m_sweep.c.x+o-t.m_sweep.c.x-f;this.m_u.y=i.m_sweep.c.y+s-t.m_sweep.c.y-e;a=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);a>r.b2_linearSlop?this.m_u.Multiply(1/a):this.m_u.SetZero();var p=f*this.m_u.y-e*this.m_u.x,w=o*this.m_u.y-s*this.m_u.x,v=t.m_invMass+t.m_invI*p*p+i.m_invMass+i.m_invI*w*w;if(this.m_mass=v!=0?1/v:0,this.m_frequencyHz>0){var k=a-this.m_length,y=2*Math.PI*this.m_frequencyHz,d=2*this.m_mass*this.m_dampingRatio*y,b=this.m_mass*y*y;this.m_gamma=n.dt*(d+n.dt*b);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_bias=k*n.dt*b*this.m_gamma;this.m_mass=v+this.m_gamma;this.m_mass=this.m_mass!=0?1/this.m_mass:0}n.warmStarting?(this.m_impulse*=n.dtRatio,h=this.m_impulse*this.m_u.x,c=this.m_impulse*this.m_u.y,t.m_linearVelocity.x-=t.m_invMass*h,t.m_linearVelocity.y-=t.m_invMass*c,t.m_angularVelocity-=t.m_invI*(f*c-e*h),i.m_linearVelocity.x+=i.m_invMass*h,i.m_linearVelocity.y+=i.m_invMass*c,i.m_angularVelocity+=i.m_invI*(o*c-s*h)):this.m_impulse=0};h.prototype.SolveVelocityConstraints=function(){var i,n=this.m_bodyA,t=this.m_bodyB,r,u,o,s;i=n.m_xf.R;var f=this.m_localAnchor1.x-n.m_sweep.localCenter.x,e=this.m_localAnchor1.y-n.m_sweep.localCenter.y,h=i.col1.x*f+i.col2.x*e;e=i.col1.y*f+i.col2.y*e;f=h;i=t.m_xf.R;r=this.m_localAnchor2.x-t.m_sweep.localCenter.x;u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;h=i.col1.x*r+i.col2.x*u;u=i.col1.y*r+i.col2.y*u;r=h;var l=n.m_linearVelocity.x+-n.m_angularVelocity*e,a=n.m_linearVelocity.y+n.m_angularVelocity*f,v=t.m_linearVelocity.x+-t.m_angularVelocity*u,y=t.m_linearVelocity.y+t.m_angularVelocity*r,p=this.m_u.x*(v-l)+this.m_u.y*(y-a),c=-this.m_mass*(p+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=c;o=c*this.m_u.x;s=c*this.m_u.y;n.m_linearVelocity.x-=n.m_invMass*o;n.m_linearVelocity.y-=n.m_invMass*s;n.m_angularVelocity-=n.m_invI*(f*s-e*o);t.m_linearVelocity.x+=t.m_invMass*o;t.m_linearVelocity.y+=t.m_invMass*s;t.m_angularVelocity+=t.m_invI*(r*s-u*o)};h.prototype.SolvePositionConstraints=function(n){var f,t,u,e,o,c,b,l,a;if(n===undefined&&(n=0),this.m_frequencyHz>0)return!0;t=this.m_bodyA;u=this.m_bodyB;f=t.m_xf.R;var s=this.m_localAnchor1.x-t.m_sweep.localCenter.x,h=this.m_localAnchor1.y-t.m_sweep.localCenter.y,p=f.col1.x*s+f.col2.x*h;h=f.col1.y*s+f.col2.y*h;s=p;f=u.m_xf.R;e=this.m_localAnchor2.x-u.m_sweep.localCenter.x;o=this.m_localAnchor2.y-u.m_sweep.localCenter.y;p=f.col1.x*e+f.col2.x*o;o=f.col1.y*e+f.col2.y*o;e=p;var v=u.m_sweep.c.x+e-t.m_sweep.c.x-s,y=u.m_sweep.c.y+o-t.m_sweep.c.y-h,w=Math.sqrt(v*v+y*y);return v/=w,y/=w,c=w-this.m_length,c=i.Clamp(c,-r.b2_maxLinearCorrection,r.b2_maxLinearCorrection),b=-this.m_mass*c,this.m_u.Set(v,y),l=b*this.m_u.x,a=b*this.m_u.y,t.m_sweep.c.x-=t.m_invMass*l,t.m_sweep.c.y-=t.m_invMass*a,t.m_sweep.a-=t.m_invI*(s*a-h*l),u.m_sweep.c.x+=u.m_invMass*l,u.m_sweep.c.y+=u.m_invMass*a,u.m_sweep.a+=u.m_invI*(e*a-o*l),t.SynchronizeTransform(),u.SynchronizeTransform(),i.Abs(c)<r.b2_linearSlop};Box2D.inherit(p,Box2D.Dynamics.Joints.b2JointDef);p.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;p.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new t;this.localAnchorB=new t};p.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=n.e_distanceJoint;this.length=1;this.frequencyHz=0;this.dampingRatio=0};p.prototype.Initialize=function(n,t,i,r,u,f){this.bodyA=n;this.bodyB=t;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(r));var e=r.x-i.x,o=r.y-i.y;this.length=Math.sqrt(e*e+o*o);this.frequencyHz=u;this.dampingRatio=f};Box2D.inherit(c,Box2D.Dynamics.Joints.b2Joint);c.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;c.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new t;this.m_localAnchorB=new t;this.m_linearMass=new l;this.m_linearImpulse=new t};c.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};c.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};c.prototype.GetReactionForce=function(n){return n===undefined&&(n=0),new t(n*this.m_linearImpulse.x,n*this.m_linearImpulse.y)};c.prototype.GetReactionTorque=function(n){return n===undefined&&(n=0),n*this.m_angularImpulse};c.prototype.SetMaxForce=function(n){n===undefined&&(n=0);this.m_maxForce=n};c.prototype.GetMaxForce=function(){return this.m_maxForce};c.prototype.SetMaxTorque=function(n){n===undefined&&(n=0);this.m_maxTorque=n};c.prototype.GetMaxTorque=function(){return this.m_maxTorque};c.prototype.b2FrictionJoint=function(n){this.__super.b2Joint.call(this,n);this.m_localAnchorA.SetV(n.localAnchorA);this.m_localAnchorB.SetV(n.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=n.maxForce;this.m_maxTorque=n.maxTorque};c.prototype.InitVelocityConstraints=function(n){var i,v=0,s=this.m_bodyA,h=this.m_bodyB,r,u,f,e,o;i=s.m_xf.R;r=this.m_localAnchorA.x-s.m_sweep.localCenter.x;u=this.m_localAnchorA.y-s.m_sweep.localCenter.y;v=i.col1.x*r+i.col2.x*u;u=i.col1.y*r+i.col2.y*u;r=v;i=h.m_xf.R;f=this.m_localAnchorB.x-h.m_sweep.localCenter.x;e=this.m_localAnchorB.y-h.m_sweep.localCenter.y;v=i.col1.x*f+i.col2.x*e;e=i.col1.y*f+i.col2.y*e;f=v;var y=s.m_invMass,p=h.m_invMass,c=s.m_invI,a=h.m_invI,t=new l;t.col1.x=y+p;t.col2.x=0;t.col1.y=0;t.col2.y=y+p;t.col1.x+=c*u*u;t.col2.x+=-c*r*u;t.col1.y+=-c*r*u;t.col2.y+=c*r*r;t.col1.x+=a*e*e;t.col2.x+=-a*f*e;t.col1.y+=-a*f*e;t.col2.y+=a*f*f;t.GetInverse(this.m_linearMass);this.m_angularMass=c+a;this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass);n.warmStarting?(this.m_linearImpulse.x*=n.dtRatio,this.m_linearImpulse.y*=n.dtRatio,this.m_angularImpulse*=n.dtRatio,o=this.m_linearImpulse,s.m_linearVelocity.x-=y*o.x,s.m_linearVelocity.y-=y*o.y,s.m_angularVelocity-=c*(r*o.y-u*o.x+this.m_angularImpulse),h.m_linearVelocity.x+=p*o.x,h.m_linearVelocity.y+=p*o.y,h.m_angularVelocity+=a*(f*o.y-e*o.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)};c.prototype.SolveVelocityConstraints=function(n){var r,y=0,f=this.m_bodyA,e=this.m_bodyB,p=f.m_linearVelocity,s=f.m_angularVelocity,w=e.m_linearVelocity,h=e.m_angularVelocity,k=f.m_invMass,d=e.m_invMass,g=f.m_invI,nt=e.m_invI,c,l,a,v;r=f.m_xf.R;c=this.m_localAnchorA.x-f.m_sweep.localCenter.x;l=this.m_localAnchorA.y-f.m_sweep.localCenter.y;y=r.col1.x*c+r.col2.x*l;l=r.col1.y*c+r.col2.y*l;c=y;r=e.m_xf.R;a=this.m_localAnchorB.x-e.m_sweep.localCenter.x;v=this.m_localAnchorB.y-e.m_sweep.localCenter.y;y=r.col1.x*a+r.col2.x*v;v=r.col1.y*a+r.col2.y*v;a=y;var o=0,tt=h-s,b=-this.m_angularMass*tt,it=this.m_angularImpulse;o=n.dt*this.m_maxTorque;this.m_angularImpulse=i.Clamp(this.m_angularImpulse+b,-o,o);b=this.m_angularImpulse-it;s-=g*b;h+=nt*b;var rt=w.x-h*v-p.x+s*l,ut=w.y+h*a-p.y-s*c,u=i.MulMV(this.m_linearMass,new t(-rt,-ut)),ft=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(u);o=n.dt*this.m_maxForce;this.m_linearImpulse.LengthSquared()>o*o&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(o));u=i.SubtractVV(this.m_linearImpulse,ft);p.x-=k*u.x;p.y-=k*u.y;s-=g*(c*u.y-l*u.x);w.x+=d*u.x;w.y+=d*u.y;h+=nt*(a*u.y-v*u.x);f.m_angularVelocity=s;e.m_angularVelocity=h};c.prototype.SolvePositionConstraints=function(n){return n===undefined&&(n=0),!0};Box2D.inherit(w,Box2D.Dynamics.Joints.b2JointDef);w.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;w.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new t;this.localAnchorB=new t};w.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=n.e_frictionJoint;this.maxForce=0;this.maxTorque=0};w.prototype.Initialize=function(n,t,i){this.bodyA=n;this.bodyB=t;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i))};Box2D.inherit(a,Box2D.Dynamics.Joints.b2Joint);a.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;a.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new t;this.m_groundAnchor2=new t;this.m_localAnchor1=new t;this.m_localAnchor2=new t;this.m_J=new it};a.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};a.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};a.prototype.GetReactionForce=function(n){return n===undefined&&(n=0),new t(n*this.m_impulse*this.m_J.linearB.x,n*this.m_impulse*this.m_J.linearB.y)};a.prototype.GetReactionTorque=function(n){var u,f;n===undefined&&(n=0);var t=this.m_bodyB.m_xf.R,i=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,r=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,e=t.col1.x*i+t.col2.x*r;return r=t.col1.y*i+t.col2.y*r,i=e,u=this.m_impulse*this.m_J.linearB.x,f=this.m_impulse*this.m_J.linearB.y,n*(this.m_impulse*this.m_J.angularB-i*f+r*u)};a.prototype.GetRatio=function(){return this.m_ratio};a.prototype.SetRatio=function(n){n===undefined&&(n=0);this.m_ratio=n};a.prototype.b2GearJoint=function(t){var e,o,i,r;this.__super.b2Joint.call(this,t);e=parseInt(t.joint1.m_type);o=parseInt(t.joint2.m_type);this.m_revolute1=null;this.m_prismatic1=null;this.m_revolute2=null;this.m_prismatic2=null;i=0;r=0;this.m_ground1=t.joint1.GetBodyA();this.m_bodyA=t.joint1.GetBodyB();e==n.e_revoluteJoint?(this.m_revolute1=t.joint1 instanceof u?t.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),i=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=t.joint1 instanceof f?t.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),i=this.m_prismatic1.GetJointTranslation());this.m_ground2=t.joint2.GetBodyA();this.m_bodyB=t.joint2.GetBodyB();o==n.e_revoluteJoint?(this.m_revolute2=t.joint2 instanceof u?t.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),r=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=t.joint2 instanceof f?t.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),r=this.m_prismatic2.GetJointTranslation());this.m_ratio=t.ratio;this.m_constant=i+this.m_ratio*r;this.m_impulse=0};a.prototype.InitVelocityConstraints=function(n){var a=this.m_ground1,v=this.m_ground2,i=this.m_bodyA,r=this.m_bodyB,s=0,h=0,u=0,f=0,t,e,o=0,l=0,c=0;this.m_J.SetZero();this.m_revolute1?(this.m_J.angularA=-1,c+=i.m_invI):(t=a.m_xf.R,e=this.m_prismatic1.m_localXAxis1,s=t.col1.x*e.x+t.col2.x*e.y,h=t.col1.y*e.x+t.col2.y*e.y,t=i.m_xf.R,u=this.m_localAnchor1.x-i.m_sweep.localCenter.x,f=this.m_localAnchor1.y-i.m_sweep.localCenter.y,l=t.col1.x*u+t.col2.x*f,f=t.col1.y*u+t.col2.y*f,u=l,o=u*h-f*s,this.m_J.linearA.Set(-s,-h),this.m_J.angularA=-o,c+=i.m_invMass+i.m_invI*o*o);this.m_revolute2?(this.m_J.angularB=-this.m_ratio,c+=this.m_ratio*this.m_ratio*r.m_invI):(t=v.m_xf.R,e=this.m_prismatic2.m_localXAxis1,s=t.col1.x*e.x+t.col2.x*e.y,h=t.col1.y*e.x+t.col2.y*e.y,t=r.m_xf.R,u=this.m_localAnchor2.x-r.m_sweep.localCenter.x,f=this.m_localAnchor2.y-r.m_sweep.localCenter.y,l=t.col1.x*u+t.col2.x*f,f=t.col1.y*u+t.col2.y*f,u=l,o=u*h-f*s,this.m_J.linearB.Set(-this.m_ratio*s,-this.m_ratio*h),this.m_J.angularB=-this.m_ratio*o,c+=this.m_ratio*this.m_ratio*(r.m_invMass+r.m_invI*o*o));this.m_mass=c>0?1/c:0;n.warmStarting?(i.m_linearVelocity.x+=i.m_invMass*this.m_impulse*this.m_J.linearA.x,i.m_linearVelocity.y+=i.m_invMass*this.m_impulse*this.m_J.linearA.y,i.m_angularVelocity+=i.m_invI*this.m_impulse*this.m_J.angularA,r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearB.x,r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearB.y,r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0};a.prototype.SolveVelocityConstraints=function(){var n=this.m_bodyA,t=this.m_bodyB,r=this.m_J.Compute(n.m_linearVelocity,n.m_angularVelocity,t.m_linearVelocity,t.m_angularVelocity),i=-this.m_mass*r;this.m_impulse+=i;n.m_linearVelocity.x+=n.m_invMass*i*this.m_J.linearA.x;n.m_linearVelocity.y+=n.m_invMass*i*this.m_J.linearA.y;n.m_angularVelocity+=n.m_invI*i*this.m_J.angularA;t.m_linearVelocity.x+=t.m_invMass*i*this.m_J.linearB.x;t.m_linearVelocity.y+=t.m_invMass*i*this.m_J.linearB.y;t.m_angularVelocity+=t.m_invI*i*this.m_J.angularB};a.prototype.SolvePositionConstraints=function(n){var o,u;n===undefined&&(n=0);var t=this.m_bodyA,i=this.m_bodyB,f=0,e=0;return f=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),e=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),o=this.m_constant-(f+this.m_ratio*e),u=-this.m_mass*o,t.m_sweep.c.x+=t.m_invMass*u*this.m_J.linearA.x,t.m_sweep.c.y+=t.m_invMass*u*this.m_J.linearA.y,t.m_sweep.a+=t.m_invI*u*this.m_J.angularA,i.m_sweep.c.x+=i.m_invMass*u*this.m_J.linearB.x,i.m_sweep.c.y+=i.m_invMass*u*this.m_J.linearB.y,i.m_sweep.a+=i.m_invI*u*this.m_J.angularB,t.SynchronizeTransform(),i.SynchronizeTransform(),0<r.b2_linearSlop};Box2D.inherit(tt,Box2D.Dynamics.Joints.b2JointDef);tt.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;tt.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)};tt.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=n.e_gearJoint;this.joint1=null;this.joint2=null;this.ratio=1};it.b2Jacobian=function(){this.linearA=new t;this.linearB=new t};it.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};it.prototype.Set=function(n,t,i,r){t===undefined&&(t=0);r===undefined&&(r=0);this.linearA.SetV(n);this.angularA=t;this.linearB.SetV(i);this.angularB=r};it.prototype.Compute=function(n,t,i,r){return t===undefined&&(t=0),r===undefined&&(r=0),this.linearA.x*n.x+this.linearA.y*n.y+this.angularA*t+(this.linearB.x*i.x+this.linearB.y*i.y)+this.angularB*r};n.b2Joint=function(){this.m_edgeA=new ft;this.m_edgeB=new ft;this.m_localCenterA=new t;this.m_localCenterB=new t};n.prototype.GetType=function(){return this.m_type};n.prototype.GetAnchorA=function(){return null};n.prototype.GetAnchorB=function(){return null};n.prototype.GetReactionForce=function(n){return n===undefined&&(n=0),null};n.prototype.GetReactionTorque=function(n){return n===undefined&&(n=0),0};n.prototype.GetBodyA=function(){return this.m_bodyA};n.prototype.GetBodyB=function(){return this.m_bodyB};n.prototype.GetNext=function(){return this.m_next};n.prototype.GetUserData=function(){return this.m_userData};n.prototype.SetUserData=function(n){this.m_userData=n};n.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};n.Create=function(t){var i=null;switch(t.type){case n.e_distanceJoint:i=new h(t instanceof p?t:null);break;case n.e_mouseJoint:i=new s(t instanceof rt?t:null);break;case n.e_prismaticJoint:i=new f(t instanceof k?t:null);break;case n.e_revoluteJoint:i=new u(t instanceof g?t:null);break;case n.e_pulleyJoint:i=new o(t instanceof d?t:null);break;case n.e_gearJoint:i=new a(t instanceof tt?t:null);break;case n.e_lineJoint:i=new e(t instanceof b?t:null);break;case n.e_weldJoint:i=new v(t instanceof nt?t:null);break;case n.e_frictionJoint:i=new c(t instanceof w?t:null)}return i};n.Destroy=function(){};n.prototype.b2Joint=function(n){r.b2Assert(n.bodyA!=n.bodyB);this.m_type=n.type;this.m_prev=null;this.m_next=null;this.m_bodyA=n.bodyA;this.m_bodyB=n.bodyB;this.m_collideConnected=n.collideConnected;this.m_islandFlag=!1;this.m_userData=n.userData};n.prototype.InitVelocityConstraints=function(){};n.prototype.SolveVelocityConstraints=function(){};n.prototype.FinalizeVelocityConstraints=function(){};n.prototype.SolvePositionConstraints=function(n){return n===undefined&&(n=0),!1};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0;Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1;Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2;Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3;Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4;Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5;Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6;Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7;Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8;Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9;Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0;Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1;Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2;Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3});et.b2JointDef=function(){};et.prototype.b2JointDef=function(){this.type=n.e_unknownJoint;this.userData=null;this.bodyA=null;this.bodyB=null;this.collideConnected=!1};ft.b2JointEdge=function(){};Box2D.inherit(e,Box2D.Dynamics.Joints.b2Joint);e.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;e.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new t;this.m_localAnchor2=new t;this.m_localXAxis1=new t;this.m_localYAxis1=new t;this.m_axis=new t;this.m_perp=new t;this.m_K=new l;this.m_impulse=new t};e.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};e.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};e.prototype.GetReactionForce=function(n){return n===undefined&&(n=0),new t(n*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),n*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};e.prototype.GetReactionTorque=function(n){return n===undefined&&(n=0),n*this.m_impulse.y};e.prototype.GetJointTranslation=function(){var n=this.m_bodyA,u=this.m_bodyB,t=n.GetWorldPoint(this.m_localAnchor1),i=u.GetWorldPoint(this.m_localAnchor2),f=i.x-t.x,e=i.y-t.y,r=n.GetWorldVector(this.m_localXAxis1);return r.x*f+r.y*e};e.prototype.GetJointSpeed=function(){var t=this.m_bodyA,i=this.m_bodyB,n,r,u;n=t.m_xf.R;var f=this.m_localAnchor1.x-t.m_sweep.localCenter.x,e=this.m_localAnchor1.y-t.m_sweep.localCenter.y,h=n.col1.x*f+n.col2.x*e;e=n.col1.y*f+n.col2.y*e;f=h;n=i.m_xf.R;r=this.m_localAnchor2.x-i.m_sweep.localCenter.x;u=this.m_localAnchor2.y-i.m_sweep.localCenter.y;h=n.col1.x*r+n.col2.x*u;u=n.col1.y*r+n.col2.y*u;r=h;var v=t.m_sweep.c.x+f,y=t.m_sweep.c.y+e,p=i.m_sweep.c.x+r,w=i.m_sweep.c.y+u,b=p-v,k=w-y,o=t.GetWorldVector(this.m_localXAxis1),c=t.m_linearVelocity,l=i.m_linearVelocity,s=t.m_angularVelocity,a=i.m_angularVelocity;return b*-s*o.y+k*s*o.x+(o.x*(l.x+-a*u-c.x- -s*e)+o.y*(l.y+a*r-c.y-s*f))};e.prototype.IsLimitEnabled=function(){return this.m_enableLimit};e.prototype.EnableLimit=function(n){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=n};e.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};e.prototype.GetUpperLimit=function(){return this.m_upperTranslation};e.prototype.SetLimits=function(n,t){n===undefined&&(n=0);t===undefined&&(t=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=n;this.m_upperTranslation=t};e.prototype.IsMotorEnabled=function(){return this.m_enableMotor};e.prototype.EnableMotor=function(n){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=n};e.prototype.SetMotorSpeed=function(n){n===undefined&&(n=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=n};e.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};e.prototype.SetMaxMotorForce=function(n){n===undefined&&(n=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=n};e.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};e.prototype.GetMotorForce=function(){return this.m_motorImpulse};e.prototype.b2LineJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_localXAxis1.SetV(t.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorMass=0;this.m_motorImpulse=0;this.m_lowerTranslation=t.lowerTranslation;this.m_upperTranslation=t.upperTranslation;this.m_maxMotorForce=t.maxMotorForce;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=n.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};e.prototype.InitVelocityConstraints=function(t){var u=this.m_bodyA,f=this.m_bodyB,e,l=0,y,tt,o,s,h,c,a,v,b;this.m_localCenterA.SetV(u.GetLocalCenter());this.m_localCenterB.SetV(f.GetLocalCenter());y=u.GetTransform();tt=f.GetTransform();e=u.m_xf.R;o=this.m_localAnchor1.x-this.m_localCenterA.x;s=this.m_localAnchor1.y-this.m_localCenterA.y;l=e.col1.x*o+e.col2.x*s;s=e.col1.y*o+e.col2.y*s;o=l;e=f.m_xf.R;h=this.m_localAnchor2.x-this.m_localCenterB.x;c=this.m_localAnchor2.y-this.m_localCenterB.y;l=e.col1.x*h+e.col2.x*c;c=e.col1.y*h+e.col2.y*c;h=l;a=f.m_sweep.c.x+h-u.m_sweep.c.x-o;v=f.m_sweep.c.y+c-u.m_sweep.c.y-s;this.m_invMassA=u.m_invMass;this.m_invMassB=f.m_invMass;this.m_invIA=u.m_invI;this.m_invIB=f.m_invI;this.m_axis.SetV(i.MulMV(y.R,this.m_localXAxis1));this.m_a1=(a+o)*this.m_axis.y-(v+s)*this.m_axis.x;this.m_a2=h*this.m_axis.y-c*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0;this.m_perp.SetV(i.MulMV(y.R,this.m_localYAxis1));this.m_s1=(a+o)*this.m_perp.y-(v+s)*this.m_perp.x;this.m_s2=h*this.m_perp.y-c*this.m_perp.x;var k=this.m_invMassA,d=this.m_invMassB,p=this.m_invIA,w=this.m_invIB;if(this.m_K.col1.x=k+d+p*this.m_s1*this.m_s1+w*this.m_s2*this.m_s2,this.m_K.col1.y=p*this.m_s1*this.m_a1+w*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=k+d+p*this.m_a1*this.m_a1+w*this.m_a2*this.m_a2,this.m_enableLimit?(b=this.m_axis.x*a+this.m_axis.y*v,i.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*r.b2_linearSlop?this.m_limitState=n.e_equalLimits:b<=this.m_lowerTranslation?this.m_limitState!=n.e_atLowerLimit&&(this.m_limitState=n.e_atLowerLimit,this.m_impulse.y=0):b>=this.m_upperTranslation?this.m_limitState!=n.e_atUpperLimit&&(this.m_limitState=n.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=n.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=n.e_inactiveLimit,this.m_enableMotor==!1&&(this.m_motorImpulse=0),t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;var g=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,nt=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,it=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,rt=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;u.m_linearVelocity.x-=this.m_invMassA*g;u.m_linearVelocity.y-=this.m_invMassA*nt;u.m_angularVelocity-=this.m_invIA*it;f.m_linearVelocity.x+=this.m_invMassB*g;f.m_linearVelocity.y+=this.m_invMassB*nt;f.m_angularVelocity+=this.m_invIB*rt}else this.m_impulse.SetZero(),this.m_motorImpulse=0};e.prototype.SolveVelocityConstraints=function(r){var w=this.m_bodyA,b=this.m_bodyB,u=w.m_linearVelocity,h=w.m_angularVelocity,f=b.m_linearVelocity,c=b.m_angularVelocity,o=0,s=0,a=0,v=0,k,nt,d,l;if(this.m_enableMotor&&this.m_limitState!=n.e_equalLimits){var tt=this.m_axis.x*(f.x-u.x)+this.m_axis.y*(f.y-u.y)+this.m_a2*c-this.m_a1*h,y=this.m_motorMass*(this.m_motorSpeed-tt),it=this.m_motorImpulse,g=r.dt*this.m_maxMotorForce;this.m_motorImpulse=i.Clamp(this.m_motorImpulse+y,-g,g);y=this.m_motorImpulse-it;o=y*this.m_axis.x;s=y*this.m_axis.y;a=y*this.m_a1;v=y*this.m_a2;u.x-=this.m_invMassA*o;u.y-=this.m_invMassA*s;h-=this.m_invIA*a;f.x+=this.m_invMassB*o;f.y+=this.m_invMassB*s;c+=this.m_invIB*v}if(k=this.m_perp.x*(f.x-u.x)+this.m_perp.y*(f.y-u.y)+this.m_s2*c-this.m_s1*h,this.m_enableLimit&&this.m_limitState!=n.e_inactiveLimit){var rt=this.m_axis.x*(f.x-u.x)+this.m_axis.y*(f.y-u.y)+this.m_a2*c-this.m_a1*h,p=this.m_impulse.Copy(),e=this.m_K.Solve(new t,-k,-rt);this.m_impulse.Add(e);this.m_limitState==n.e_atLowerLimit?this.m_impulse.y=i.Max(this.m_impulse.y,0):this.m_limitState==n.e_atUpperLimit&&(this.m_impulse.y=i.Min(this.m_impulse.y,0));nt=-k-(this.m_impulse.y-p.y)*this.m_K.col2.x;d=0;d=this.m_K.col1.x!=0?nt/this.m_K.col1.x+p.x:p.x;this.m_impulse.x=d;e.x=this.m_impulse.x-p.x;e.y=this.m_impulse.y-p.y;o=e.x*this.m_perp.x+e.y*this.m_axis.x;s=e.x*this.m_perp.y+e.y*this.m_axis.y;a=e.x*this.m_s1+e.y*this.m_a1;v=e.x*this.m_s2+e.y*this.m_a2;u.x-=this.m_invMassA*o;u.y-=this.m_invMassA*s;h-=this.m_invIA*a;f.x+=this.m_invMassB*o;f.y+=this.m_invMassB*s;c+=this.m_invIB*v}else l=0,l=this.m_K.col1.x!=0?-k/this.m_K.col1.x:0,this.m_impulse.x+=l,o=l*this.m_perp.x,s=l*this.m_perp.y,a=l*this.m_s1,v=l*this.m_s2,u.x-=this.m_invMassA*o,u.y-=this.m_invMassA*s,h-=this.m_invIA*a,f.x+=this.m_invMassB*o,f.y+=this.m_invMassB*s,c+=this.m_invIB*v;w.m_linearVelocity.SetV(u);w.m_angularVelocity=h;b.m_linearVelocity.SetV(f);b.m_angularVelocity=c};e.prototype.SolvePositionConstraints=function(n){var o,s,h,c,b,k,e,u,ft,ht,ct;n===undefined&&(n=0);var d=this.m_bodyA,g=this.m_bodyB,nt=d.m_sweep.c,et=d.m_sweep.a,tt=g.m_sweep.c,ot=g.m_sweep.a,f,it=0,p=0,w=0,a=0,v=0,y=0,lt=0,rt=!1,ut=0,st=l.FromAngle(et),yt=l.FromAngle(ot);f=st;o=this.m_localAnchor1.x-this.m_localCenterA.x;s=this.m_localAnchor1.y-this.m_localCenterA.y;it=f.col1.x*o+f.col2.x*s;s=f.col1.y*o+f.col2.y*s;o=it;f=yt;h=this.m_localAnchor2.x-this.m_localCenterB.x;c=this.m_localAnchor2.y-this.m_localCenterB.y;it=f.col1.x*h+f.col2.x*c;c=f.col1.y*h+f.col2.y*c;h=it;b=tt.x+h-nt.x-o;k=tt.y+c-nt.y-s;this.m_enableLimit&&(this.m_axis=i.MulMV(st,this.m_localXAxis1),this.m_a1=(b+o)*this.m_axis.y-(k+s)*this.m_axis.x,this.m_a2=h*this.m_axis.y-c*this.m_axis.x,e=this.m_axis.x*b+this.m_axis.y*k,i.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*r.b2_linearSlop?(ut=i.Clamp(e,-r.b2_maxLinearCorrection,r.b2_maxLinearCorrection),y=i.Abs(e),rt=!0):e<=this.m_lowerTranslation?(ut=i.Clamp(e-this.m_lowerTranslation+r.b2_linearSlop,-r.b2_maxLinearCorrection,0),y=this.m_lowerTranslation-e,rt=!0):e>=this.m_upperTranslation&&(ut=i.Clamp(e-this.m_upperTranslation+r.b2_linearSlop,0,r.b2_maxLinearCorrection),y=e-this.m_upperTranslation,rt=!0));this.m_perp=i.MulMV(st,this.m_localYAxis1);this.m_s1=(b+o)*this.m_perp.y-(k+s)*this.m_perp.x;this.m_s2=h*this.m_perp.y-c*this.m_perp.x;u=new t;ft=this.m_perp.x*b+this.m_perp.y*k;y=i.Max(y,i.Abs(ft));lt=0;rt?(p=this.m_invMassA,w=this.m_invMassB,a=this.m_invIA,v=this.m_invIB,this.m_K.col1.x=p+w+a*this.m_s1*this.m_s1+v*this.m_s2*this.m_s2,this.m_K.col1.y=a*this.m_s1*this.m_a1+v*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=p+w+a*this.m_a1*this.m_a1+v*this.m_a2*this.m_a2,this.m_K.Solve(u,-ft,-ut)):(p=this.m_invMassA,w=this.m_invMassB,a=this.m_invIA,v=this.m_invIB,ht=p+w+a*this.m_s1*this.m_s1+v*this.m_s2*this.m_s2,ct=0,ct=ht!=0?-ft/ht:0,u.x=ct,u.y=0);var at=u.x*this.m_perp.x+u.y*this.m_axis.x,vt=u.x*this.m_perp.y+u.y*this.m_axis.y,pt=u.x*this.m_s1+u.y*this.m_a1,wt=u.x*this.m_s2+u.y*this.m_a2;return nt.x-=this.m_invMassA*at,nt.y-=this.m_invMassA*vt,et-=this.m_invIA*pt,tt.x+=this.m_invMassB*at,tt.y+=this.m_invMassB*vt,ot+=this.m_invIB*wt,d.m_sweep.a=et,g.m_sweep.a=ot,d.SynchronizeTransform(),g.SynchronizeTransform(),y<=r.b2_linearSlop&&lt<=r.b2_angularSlop};Box2D.inherit(b,Box2D.Dynamics.Joints.b2JointDef);b.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;b.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new t;this.localAnchorB=new t;this.localAxisA=new t};b.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=n.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=!1;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=!1;this.maxMotorForce=0;this.motorSpeed=0};b.prototype.Initialize=function(n,t,i,r){this.bodyA=n;this.bodyB=t;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.localAxisA=this.bodyA.GetLocalVector(r)};Box2D.inherit(s,Box2D.Dynamics.Joints.b2Joint);s.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;s.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new l;this.K1=new l;this.K2=new l;this.m_localAnchor=new t;this.m_target=new t;this.m_impulse=new t;this.m_mass=new l;this.m_C=new t};s.prototype.GetAnchorA=function(){return this.m_target};s.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};s.prototype.GetReactionForce=function(n){return n===undefined&&(n=0),new t(n*this.m_impulse.x,n*this.m_impulse.y)};s.prototype.GetReactionTorque=function(n){return n===undefined&&(n=0),0};s.prototype.GetTarget=function(){return this.m_target};s.prototype.SetTarget=function(n){this.m_bodyB.IsAwake()==!1&&this.m_bodyB.SetAwake(!0);this.m_target=n};s.prototype.GetMaxForce=function(){return this.m_maxForce};s.prototype.SetMaxForce=function(n){n===undefined&&(n=0);this.m_maxForce=n};s.prototype.GetFrequency=function(){return this.m_frequencyHz};s.prototype.SetFrequency=function(n){n===undefined&&(n=0);this.m_frequencyHz=n};s.prototype.GetDampingRatio=function(){return this.m_dampingRatio};s.prototype.SetDampingRatio=function(n){n===undefined&&(n=0);this.m_dampingRatio=n};s.prototype.b2MouseJoint=function(n){this.__super.b2Joint.call(this,n);this.m_target.SetV(n.target);var i=this.m_target.x-this.m_bodyB.m_xf.position.x,r=this.m_target.y-this.m_bodyB.m_xf.position.y,t=this.m_bodyB.m_xf.R;this.m_localAnchor.x=i*t.col1.x+r*t.col1.y;this.m_localAnchor.y=i*t.col2.x+r*t.col2.y;this.m_maxForce=n.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=n.frequencyHz;this.m_dampingRatio=n.dampingRatio;this.m_beta=0;this.m_gamma=0};s.prototype.InitVelocityConstraints=function(n){var t=this.m_bodyB,s=t.GetMass(),o=2*Math.PI*this.m_frequencyHz,c=2*s*this.m_dampingRatio*o,h=s*o*o,f,e,u;this.m_gamma=n.dt*(c+n.dt*h);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_beta=n.dt*h*this.m_gamma;f=t.m_xf.R;var i=this.m_localAnchor.x-t.m_sweep.localCenter.x,r=this.m_localAnchor.y-t.m_sweep.localCenter.y,l=f.col1.x*i+f.col2.x*r;r=f.col1.y*i+f.col2.y*r;i=l;e=t.m_invMass;u=t.m_invI;this.K1.col1.x=e;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=e;this.K2.col1.x=u*r*r;this.K2.col2.x=-u*i*r;this.K2.col1.y=-u*i*r;this.K2.col2.y=u*i*i;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=t.m_sweep.c.x+i-this.m_target.x;this.m_C.y=t.m_sweep.c.y+r-this.m_target.y;t.m_angularVelocity*=.98;this.m_impulse.x*=n.dtRatio;this.m_impulse.y*=n.dtRatio;t.m_linearVelocity.x+=e*this.m_impulse.x;t.m_linearVelocity.y+=e*this.m_impulse.y;t.m_angularVelocity+=u*(i*this.m_impulse.y-r*this.m_impulse.x)};s.prototype.SolveVelocityConstraints=function(n){var t=this.m_bodyB,i,f=0,h=0,r,u,c,l,s;i=t.m_xf.R;r=this.m_localAnchor.x-t.m_sweep.localCenter.x;u=this.m_localAnchor.y-t.m_sweep.localCenter.y;f=i.col1.x*r+i.col2.x*u;u=i.col1.y*r+i.col2.y*u;r=f;c=t.m_linearVelocity.x+-t.m_angularVelocity*u;l=t.m_linearVelocity.y+t.m_angularVelocity*r;i=this.m_mass;f=c+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;h=l+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var e=-(i.col1.x*f+i.col2.x*h),o=-(i.col1.y*f+i.col2.y*h),a=this.m_impulse.x,v=this.m_impulse.y;this.m_impulse.x+=e;this.m_impulse.y+=o;s=n.dt*this.m_maxForce;this.m_impulse.LengthSquared()>s*s&&this.m_impulse.Multiply(s/this.m_impulse.Length());e=this.m_impulse.x-a;o=this.m_impulse.y-v;t.m_linearVelocity.x+=t.m_invMass*e;t.m_linearVelocity.y+=t.m_invMass*o;t.m_angularVelocity+=t.m_invI*(r*o-u*e)};s.prototype.SolvePositionConstraints=function(n){return n===undefined&&(n=0),!0};Box2D.inherit(rt,Box2D.Dynamics.Joints.b2JointDef);rt.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;rt.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.target=new t};rt.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=n.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=.7};Box2D.inherit(f,Box2D.Dynamics.Joints.b2Joint);f.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;f.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new t;this.m_localAnchor2=new t;this.m_localXAxis1=new t;this.m_localYAxis1=new t;this.m_axis=new t;this.m_perp=new t;this.m_K=new ut;this.m_impulse=new y};f.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};f.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};f.prototype.GetReactionForce=function(n){return n===undefined&&(n=0),new t(n*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),n*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};f.prototype.GetReactionTorque=function(n){return n===undefined&&(n=0),n*this.m_impulse.y};f.prototype.GetJointTranslation=function(){var n=this.m_bodyA,u=this.m_bodyB,t=n.GetWorldPoint(this.m_localAnchor1),i=u.GetWorldPoint(this.m_localAnchor2),f=i.x-t.x,e=i.y-t.y,r=n.GetWorldVector(this.m_localXAxis1);return r.x*f+r.y*e};f.prototype.GetJointSpeed=function(){var t=this.m_bodyA,i=this.m_bodyB,n,r,u;n=t.m_xf.R;var f=this.m_localAnchor1.x-t.m_sweep.localCenter.x,e=this.m_localAnchor1.y-t.m_sweep.localCenter.y,h=n.col1.x*f+n.col2.x*e;e=n.col1.y*f+n.col2.y*e;f=h;n=i.m_xf.R;r=this.m_localAnchor2.x-i.m_sweep.localCenter.x;u=this.m_localAnchor2.y-i.m_sweep.localCenter.y;h=n.col1.x*r+n.col2.x*u;u=n.col1.y*r+n.col2.y*u;r=h;var v=t.m_sweep.c.x+f,y=t.m_sweep.c.y+e,p=i.m_sweep.c.x+r,w=i.m_sweep.c.y+u,b=p-v,k=w-y,o=t.GetWorldVector(this.m_localXAxis1),c=t.m_linearVelocity,l=i.m_linearVelocity,s=t.m_angularVelocity,a=i.m_angularVelocity;return b*-s*o.y+k*s*o.x+(o.x*(l.x+-a*u-c.x- -s*e)+o.y*(l.y+a*r-c.y-s*f))};f.prototype.IsLimitEnabled=function(){return this.m_enableLimit};f.prototype.EnableLimit=function(n){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=n};f.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};f.prototype.GetUpperLimit=function(){return this.m_upperTranslation};f.prototype.SetLimits=function(n,t){n===undefined&&(n=0);t===undefined&&(t=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=n;this.m_upperTranslation=t};f.prototype.IsMotorEnabled=function(){return this.m_enableMotor};f.prototype.EnableMotor=function(n){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=n};f.prototype.SetMotorSpeed=function(n){n===undefined&&(n=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=n};f.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};f.prototype.SetMaxMotorForce=function(n){n===undefined&&(n=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=n};f.prototype.GetMotorForce=function(){return this.m_motorImpulse};f.prototype.b2PrismaticJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_localXAxis1.SetV(t.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_motorMass=0;this.m_motorImpulse=0;this.m_lowerTranslation=t.lowerTranslation;this.m_upperTranslation=t.upperTranslation;this.m_maxMotorForce=t.maxMotorForce;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=n.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};f.prototype.InitVelocityConstraints=function(t){var u=this.m_bodyA,f=this.m_bodyB,e,v=0,w,tt,o,s,h,c,y,p,b;this.m_localCenterA.SetV(u.GetLocalCenter());this.m_localCenterB.SetV(f.GetLocalCenter());w=u.GetTransform();tt=f.GetTransform();e=u.m_xf.R;o=this.m_localAnchor1.x-this.m_localCenterA.x;s=this.m_localAnchor1.y-this.m_localCenterA.y;v=e.col1.x*o+e.col2.x*s;s=e.col1.y*o+e.col2.y*s;o=v;e=f.m_xf.R;h=this.m_localAnchor2.x-this.m_localCenterB.x;c=this.m_localAnchor2.y-this.m_localCenterB.y;v=e.col1.x*h+e.col2.x*c;c=e.col1.y*h+e.col2.y*c;h=v;y=f.m_sweep.c.x+h-u.m_sweep.c.x-o;p=f.m_sweep.c.y+c-u.m_sweep.c.y-s;this.m_invMassA=u.m_invMass;this.m_invMassB=f.m_invMass;this.m_invIA=u.m_invI;this.m_invIB=f.m_invI;this.m_axis.SetV(i.MulMV(w.R,this.m_localXAxis1));this.m_a1=(y+o)*this.m_axis.y-(p+s)*this.m_axis.x;this.m_a2=h*this.m_axis.y-c*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass);this.m_perp.SetV(i.MulMV(w.R,this.m_localYAxis1));this.m_s1=(y+o)*this.m_perp.y-(p+s)*this.m_perp.x;this.m_s2=h*this.m_perp.y-c*this.m_perp.x;var k=this.m_invMassA,d=this.m_invMassB,l=this.m_invIA,a=this.m_invIB;if(this.m_K.col1.x=k+d+l*this.m_s1*this.m_s1+a*this.m_s2*this.m_s2,this.m_K.col1.y=l*this.m_s1+a*this.m_s2,this.m_K.col1.z=l*this.m_s1*this.m_a1+a*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=l+a,this.m_K.col2.z=l*this.m_a1+a*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=k+d+l*this.m_a1*this.m_a1+a*this.m_a2*this.m_a2,this.m_enableLimit?(b=this.m_axis.x*y+this.m_axis.y*p,i.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*r.b2_linearSlop?this.m_limitState=n.e_equalLimits:b<=this.m_lowerTranslation?this.m_limitState!=n.e_atLowerLimit&&(this.m_limitState=n.e_atLowerLimit,this.m_impulse.z=0):b>=this.m_upperTranslation?this.m_limitState!=n.e_atUpperLimit&&(this.m_limitState=n.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=n.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=n.e_inactiveLimit,this.m_enableMotor==!1&&(this.m_motorImpulse=0),t.warmStarting){this.m_impulse.x*=t.dtRatio;this.m_impulse.y*=t.dtRatio;this.m_motorImpulse*=t.dtRatio;var g=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,nt=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,it=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,rt=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;u.m_linearVelocity.x-=this.m_invMassA*g;u.m_linearVelocity.y-=this.m_invMassA*nt;u.m_angularVelocity-=this.m_invIA*it;f.m_linearVelocity.x+=this.m_invMassB*g;f.m_linearVelocity.y+=this.m_invMassB*nt;f.m_angularVelocity+=this.m_invIB*rt}else this.m_impulse.SetZero(),this.m_motorImpulse=0};f.prototype.SolveVelocityConstraints=function(r){var b=this.m_bodyA,k=this.m_bodyB,f=b.m_linearVelocity,c=b.m_angularVelocity,e=k.m_linearVelocity,l=k.m_angularVelocity,o=0,s=0,v=0,p=0,d,g,h;if(this.m_enableMotor&&this.m_limitState!=n.e_equalLimits){var it=this.m_axis.x*(e.x-f.x)+this.m_axis.y*(e.y-f.y)+this.m_a2*l-this.m_a1*c,w=this.m_motorMass*(this.m_motorSpeed-it),rt=this.m_motorImpulse,tt=r.dt*this.m_maxMotorForce;this.m_motorImpulse=i.Clamp(this.m_motorImpulse+w,-tt,tt);w=this.m_motorImpulse-rt;o=w*this.m_axis.x;s=w*this.m_axis.y;v=w*this.m_a1;p=w*this.m_a2;f.x-=this.m_invMassA*o;f.y-=this.m_invMassA*s;c-=this.m_invIA*v;e.x+=this.m_invMassB*o;e.y+=this.m_invMassB*s;l+=this.m_invIB*p}if(d=this.m_perp.x*(e.x-f.x)+this.m_perp.y*(e.y-f.y)+this.m_s2*l-this.m_s1*c,g=l-c,this.m_enableLimit&&this.m_limitState!=n.e_inactiveLimit){var ut=this.m_axis.x*(e.x-f.x)+this.m_axis.y*(e.y-f.y)+this.m_a2*l-this.m_a1*c,a=this.m_impulse.Copy(),u=this.m_K.Solve33(new y,-d,-g,-ut);this.m_impulse.Add(u);this.m_limitState==n.e_atLowerLimit?this.m_impulse.z=i.Max(this.m_impulse.z,0):this.m_limitState==n.e_atUpperLimit&&(this.m_impulse.z=i.Min(this.m_impulse.z,0));var ft=-d-(this.m_impulse.z-a.z)*this.m_K.col3.x,et=-g-(this.m_impulse.z-a.z)*this.m_K.col3.y,nt=this.m_K.Solve22(new t,ft,et);nt.x+=a.x;nt.y+=a.y;this.m_impulse.x=nt.x;this.m_impulse.y=nt.y;u.x=this.m_impulse.x-a.x;u.y=this.m_impulse.y-a.y;u.z=this.m_impulse.z-a.z;o=u.x*this.m_perp.x+u.z*this.m_axis.x;s=u.x*this.m_perp.y+u.z*this.m_axis.y;v=u.x*this.m_s1+u.y+u.z*this.m_a1;p=u.x*this.m_s2+u.y+u.z*this.m_a2;f.x-=this.m_invMassA*o;f.y-=this.m_invMassA*s;c-=this.m_invIA*v;e.x+=this.m_invMassB*o;e.y+=this.m_invMassB*s;l+=this.m_invIB*p}else h=this.m_K.Solve22(new t,-d,-g),this.m_impulse.x+=h.x,this.m_impulse.y+=h.y,o=h.x*this.m_perp.x,s=h.x*this.m_perp.y,v=h.x*this.m_s1+h.y,p=h.x*this.m_s2+h.y,f.x-=this.m_invMassA*o,f.y-=this.m_invMassA*s,c-=this.m_invIA*v,e.x+=this.m_invMassB*o,e.y+=this.m_invMassB*s,l+=this.m_invIB*p;b.m_linearVelocity.SetV(f);b.m_angularVelocity=c;k.m_linearVelocity.SetV(e);k.m_angularVelocity=l};f.prototype.SolvePositionConstraints=function(n){var h,c,a,v,k,d,s,lt;n===undefined&&(n=0);var g=this.m_bodyA,nt=this.m_bodyB,tt=g.m_sweep.c,it=g.m_sweep.a,rt=nt.m_sweep.c,ut=nt.m_sweep.a,o,ft=0,w=0,b=0,f=0,e=0,p=0,at=0,et=!1,ot=0,st=l.FromAngle(it),wt=l.FromAngle(ut);o=st;h=this.m_localAnchor1.x-this.m_localCenterA.x;c=this.m_localAnchor1.y-this.m_localCenterA.y;ft=o.col1.x*h+o.col2.x*c;c=o.col1.y*h+o.col2.y*c;h=ft;o=wt;a=this.m_localAnchor2.x-this.m_localCenterB.x;v=this.m_localAnchor2.y-this.m_localCenterB.y;ft=o.col1.x*a+o.col2.x*v;v=o.col1.y*a+o.col2.y*v;a=ft;k=rt.x+a-tt.x-h;d=rt.y+v-tt.y-c;this.m_enableLimit&&(this.m_axis=i.MulMV(st,this.m_localXAxis1),this.m_a1=(k+h)*this.m_axis.y-(d+c)*this.m_axis.x,this.m_a2=a*this.m_axis.y-v*this.m_axis.x,s=this.m_axis.x*k+this.m_axis.y*d,i.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*r.b2_linearSlop?(ot=i.Clamp(s,-r.b2_maxLinearCorrection,r.b2_maxLinearCorrection),p=i.Abs(s),et=!0):s<=this.m_lowerTranslation?(ot=i.Clamp(s-this.m_lowerTranslation+r.b2_linearSlop,-r.b2_maxLinearCorrection,0),p=this.m_lowerTranslation-s,et=!0):s>=this.m_upperTranslation&&(ot=i.Clamp(s-this.m_upperTranslation+r.b2_linearSlop,0,r.b2_maxLinearCorrection),p=s-this.m_upperTranslation,et=!0));this.m_perp=i.MulMV(st,this.m_localYAxis1);this.m_s1=(k+h)*this.m_perp.y-(d+c)*this.m_perp.x;this.m_s2=a*this.m_perp.y-v*this.m_perp.x;var u=new y,ht=this.m_perp.x*k+this.m_perp.y*d,ct=ut-it-this.m_refAngle;if(p=i.Max(p,i.Abs(ht)),at=i.Abs(ct),et)w=this.m_invMassA,b=this.m_invMassB,f=this.m_invIA,e=this.m_invIB,this.m_K.col1.x=w+b+f*this.m_s1*this.m_s1+e*this.m_s2*this.m_s2,this.m_K.col1.y=f*this.m_s1+e*this.m_s2,this.m_K.col1.z=f*this.m_s1*this.m_a1+e*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=f+e,this.m_K.col2.z=f*this.m_a1+e*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=w+b+f*this.m_a1*this.m_a1+e*this.m_a2*this.m_a2,this.m_K.Solve33(u,-ht,-ct,-ot);else{w=this.m_invMassA;b=this.m_invMassB;f=this.m_invIA;e=this.m_invIB;var bt=w+b+f*this.m_s1*this.m_s1+e*this.m_s2*this.m_s2,vt=f*this.m_s1+e*this.m_s2,kt=f+e;this.m_K.col1.Set(bt,vt,0);this.m_K.col2.Set(vt,kt,0);lt=this.m_K.Solve22(new t,-ht,-ct);u.x=lt.x;u.y=lt.y;u.z=0}var yt=u.x*this.m_perp.x+u.z*this.m_axis.x,pt=u.x*this.m_perp.y+u.z*this.m_axis.y,dt=u.x*this.m_s1+u.y+u.z*this.m_a1,gt=u.x*this.m_s2+u.y+u.z*this.m_a2;return tt.x-=this.m_invMassA*yt,tt.y-=this.m_invMassA*pt,it-=this.m_invIA*dt,rt.x+=this.m_invMassB*yt,rt.y+=this.m_invMassB*pt,ut+=this.m_invIB*gt,g.m_sweep.a=it,nt.m_sweep.a=ut,g.SynchronizeTransform(),nt.SynchronizeTransform(),p<=r.b2_linearSlop&&at<=r.b2_angularSlop};Box2D.inherit(k,Box2D.Dynamics.Joints.b2JointDef);k.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;k.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new t;this.localAnchorB=new t;this.localAxisA=new t};k.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this);this.type=n.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=!1;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=!1;this.maxMotorForce=0;this.motorSpeed=0};k.prototype.Initialize=function(n,t,i,r){this.bodyA=n;this.bodyB=t;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.localAxisA=this.bodyA.GetLocalVector(r);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(o,Box2D.Dynamics.Joints.b2Joint);o.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;o.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new t;this.m_groundAnchor2=new t;this.m_localAnchor1=new t;this.m_localAnchor2=new t;this.m_u1=new t;this.m_u2=new t};o.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};o.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};o.prototype.GetReactionForce=function(n){return n===undefined&&(n=0),new t(n*this.m_impulse*this.m_u2.x,n*this.m_impulse*this.m_u2.y)};o.prototype.GetReactionTorque=function(n){return n===undefined&&(n=0),0};o.prototype.GetGroundAnchorA=function(){var n=this.m_ground.m_xf.position.Copy();return n.Add(this.m_groundAnchor1),n};o.prototype.GetGroundAnchorB=function(){var n=this.m_ground.m_xf.position.Copy();return n.Add(this.m_groundAnchor2),n};o.prototype.GetLength1=function(){var n=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),r=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,u=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,t=n.x-r,i=n.y-u;return Math.sqrt(t*t+i*i)};o.prototype.GetLength2=function(){var n=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),r=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,u=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,t=n.x-r,i=n.y-u;return Math.sqrt(t*t+i*i)};o.prototype.GetRatio=function(){return this.m_ratio};o.prototype.b2PulleyJoint=function(n){this.__super.b2Joint.call(this,n);this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=n.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=n.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=n.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=n.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(n.localAnchorA);this.m_localAnchor2.SetV(n.localAnchorB);this.m_ratio=n.ratio;this.m_constant=n.lengthA+this.m_ratio*n.lengthB;this.m_maxLength1=i.Min(n.maxLengthA,this.m_constant-this.m_ratio*o.b2_minPulleyLength);this.m_maxLength2=i.Min(n.maxLengthB,(this.m_constant-o.b2_minPulleyLength)/this.m_ratio);this.m_impulse=0;this.m_limitImpulse1=0;this.m_limitImpulse2=0};o.prototype.InitVelocityConstraints=function(t){var i=this.m_bodyA,u=this.m_bodyB,f,e,o,c,l,p,v,y;f=i.m_xf.R;var s=this.m_localAnchor1.x-i.m_sweep.localCenter.x,h=this.m_localAnchor1.y-i.m_sweep.localCenter.y,a=f.col1.x*s+f.col2.x*h;h=f.col1.y*s+f.col2.y*h;s=a;f=u.m_xf.R;e=this.m_localAnchor2.x-u.m_sweep.localCenter.x;o=this.m_localAnchor2.y-u.m_sweep.localCenter.y;a=f.col1.x*e+f.col2.x*o;o=f.col1.y*e+f.col2.y*o;e=a;var g=i.m_sweep.c.x+s,nt=i.m_sweep.c.y+h,tt=u.m_sweep.c.x+e,it=u.m_sweep.c.y+o,rt=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,ut=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,ft=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,et=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;if(this.m_u1.Set(g-rt,nt-ut),this.m_u2.Set(tt-ft,it-et),c=this.m_u1.Length(),l=this.m_u2.Length(),c>r.b2_linearSlop?this.m_u1.Multiply(1/c):this.m_u1.SetZero(),l>r.b2_linearSlop?this.m_u2.Multiply(1/l):this.m_u2.SetZero(),p=this.m_constant-c-this.m_ratio*l,p>0?(this.m_state=n.e_inactiveLimit,this.m_impulse=0):this.m_state=n.e_atUpperLimit,c<this.m_maxLength1?(this.m_limitState1=n.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=n.e_atUpperLimit,l<this.m_maxLength2?(this.m_limitState2=n.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=n.e_atUpperLimit,v=s*this.m_u1.y-h*this.m_u1.x,y=e*this.m_u2.y-o*this.m_u2.x,this.m_limitMass1=i.m_invMass+i.m_invI*v*v,this.m_limitMass2=u.m_invMass+u.m_invI*y*y,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,t.warmStarting){this.m_impulse*=t.dtRatio;this.m_limitImpulse1*=t.dtRatio;this.m_limitImpulse2*=t.dtRatio;var w=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,b=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,k=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,d=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;i.m_linearVelocity.x+=i.m_invMass*w;i.m_linearVelocity.y+=i.m_invMass*b;i.m_angularVelocity+=i.m_invI*(s*b-h*w);u.m_linearVelocity.x+=u.m_invMass*k;u.m_linearVelocity.y+=u.m_invMass*d;u.m_angularVelocity+=u.m_invI*(e*d-o*k)}else this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0};o.prototype.SolveVelocityConstraints=function(){var t=this.m_bodyA,r=this.m_bodyB,f,e,o;f=t.m_xf.R;var s=this.m_localAnchor1.x-t.m_sweep.localCenter.x,h=this.m_localAnchor1.y-t.m_sweep.localCenter.y,g=f.col1.x*s+f.col2.x*h;h=f.col1.y*s+f.col2.y*h;s=g;f=r.m_xf.R;e=this.m_localAnchor2.x-r.m_sweep.localCenter.x;o=this.m_localAnchor2.y-r.m_sweep.localCenter.y;g=f.col1.x*e+f.col2.x*o;o=f.col1.y*e+f.col2.y*o;e=g;var w=0,b=0,k=0,d=0,c=0,l=0,a=0,v=0,y=0,u=0,p=0;this.m_state==n.e_atUpperLimit&&(w=t.m_linearVelocity.x+-t.m_angularVelocity*h,b=t.m_linearVelocity.y+t.m_angularVelocity*s,k=r.m_linearVelocity.x+-r.m_angularVelocity*o,d=r.m_linearVelocity.y+r.m_angularVelocity*e,y=-(this.m_u1.x*w+this.m_u1.y*b)-this.m_ratio*(this.m_u2.x*k+this.m_u2.y*d),u=this.m_pulleyMass*-y,p=this.m_impulse,this.m_impulse=i.Max(0,this.m_impulse+u),u=this.m_impulse-p,c=-u*this.m_u1.x,l=-u*this.m_u1.y,a=-this.m_ratio*u*this.m_u2.x,v=-this.m_ratio*u*this.m_u2.y,t.m_linearVelocity.x+=t.m_invMass*c,t.m_linearVelocity.y+=t.m_invMass*l,t.m_angularVelocity+=t.m_invI*(s*l-h*c),r.m_linearVelocity.x+=r.m_invMass*a,r.m_linearVelocity.y+=r.m_invMass*v,r.m_angularVelocity+=r.m_invI*(e*v-o*a));this.m_limitState1==n.e_atUpperLimit&&(w=t.m_linearVelocity.x+-t.m_angularVelocity*h,b=t.m_linearVelocity.y+t.m_angularVelocity*s,y=-(this.m_u1.x*w+this.m_u1.y*b),u=-this.m_limitMass1*y,p=this.m_limitImpulse1,this.m_limitImpulse1=i.Max(0,this.m_limitImpulse1+u),u=this.m_limitImpulse1-p,c=-u*this.m_u1.x,l=-u*this.m_u1.y,t.m_linearVelocity.x+=t.m_invMass*c,t.m_linearVelocity.y+=t.m_invMass*l,t.m_angularVelocity+=t.m_invI*(s*l-h*c));this.m_limitState2==n.e_atUpperLimit&&(k=r.m_linearVelocity.x+-r.m_angularVelocity*o,d=r.m_linearVelocity.y+r.m_angularVelocity*e,y=-(this.m_u2.x*k+this.m_u2.y*d),u=-this.m_limitMass2*y,p=this.m_limitImpulse2,this.m_limitImpulse2=i.Max(0,this.m_limitImpulse2+u),u=this.m_limitImpulse2-p,a=-u*this.m_u2.x,v=-u*this.m_u2.y,r.m_linearVelocity.x+=r.m_invMass*a,r.m_linearVelocity.y+=r.m_invMass*v,r.m_angularVelocity+=r.m_invI*(e*v-o*a))};o.prototype.SolvePositionConstraints=function(t){t===undefined&&(t=0);var u=this.m_bodyA,f=this.m_bodyB,e,nt=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,tt=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,it=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,rt=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,s=0,h=0,c=0,l=0,v=0,y=0,p=0,w=0,b=0,k=0,o=0,a=0,d=0,g=0;return this.m_state==n.e_atUpperLimit&&(e=u.m_xf.R,s=this.m_localAnchor1.x-u.m_sweep.localCenter.x,h=this.m_localAnchor1.y-u.m_sweep.localCenter.y,d=e.col1.x*s+e.col2.x*h,h=e.col1.y*s+e.col2.y*h,s=d,e=f.m_xf.R,c=this.m_localAnchor2.x-f.m_sweep.localCenter.x,l=this.m_localAnchor2.y-f.m_sweep.localCenter.y,d=e.col1.x*c+e.col2.x*l,l=e.col1.y*c+e.col2.y*l,c=d,v=u.m_sweep.c.x+s,y=u.m_sweep.c.y+h,p=f.m_sweep.c.x+c,w=f.m_sweep.c.y+l,this.m_u1.Set(v-nt,y-tt),this.m_u2.Set(p-it,w-rt),b=this.m_u1.Length(),k=this.m_u2.Length(),b>r.b2_linearSlop?this.m_u1.Multiply(1/b):this.m_u1.SetZero(),k>r.b2_linearSlop?this.m_u2.Multiply(1/k):this.m_u2.SetZero(),o=this.m_constant-b-this.m_ratio*k,g=i.Max(g,-o),o=i.Clamp(o+r.b2_linearSlop,-r.b2_maxLinearCorrection,0),a=-this.m_pulleyMass*o,v=-a*this.m_u1.x,y=-a*this.m_u1.y,p=-this.m_ratio*a*this.m_u2.x,w=-this.m_ratio*a*this.m_u2.y,u.m_sweep.c.x+=u.m_invMass*v,u.m_sweep.c.y+=u.m_invMass*y,u.m_sweep.a+=u.m_invI*(s*y-h*v),f.m_sweep.c.x+=f.m_invMass*p,f.m_sweep.c.y+=f.m_invMass*w,f.m_sweep.a+=f.m_invI*(c*w-l*p),u.SynchronizeTransform(),f.SynchronizeTransform()),this.m_limitState1==n.e_atUpperLimit&&(e=u.m_xf.R,s=this.m_localAnchor1.x-u.m_sweep.localCenter.x,h=this.m_localAnchor1.y-u.m_sweep.localCenter.y,d=e.col1.x*s+e.col2.x*h,h=e.col1.y*s+e.col2.y*h,s=d,v=u.m_sweep.c.x+s,y=u.m_sweep.c.y+h,this.m_u1.Set(v-nt,y-tt),b=this.m_u1.Length(),b>r.b2_linearSlop?(this.m_u1.x*=1/b,this.m_u1.y*=1/b):this.m_u1.SetZero(),o=this.m_maxLength1-b,g=i.Max(g,-o),o=i.Clamp(o+r.b2_linearSlop,-r.b2_maxLinearCorrection,0),a=-this.m_limitMass1*o,v=-a*this.m_u1.x,y=-a*this.m_u1.y,u.m_sweep.c.x+=u.m_invMass*v,u.m_sweep.c.y+=u.m_invMass*y,u.m_sweep.a+=u.m_invI*(s*y-h*v),u.SynchronizeTransform()),this.m_limitState2==n.e_atUpperLimit&&(e=f.m_xf.R,c=this.m_localAnchor2.x-f.m_sweep.localCenter.x,l=this.m_localAnchor2.y-f.m_sweep.localCenter.y,d=e.col1.x*c+e.col2.x*l,l=e.col1.y*c+e.col2.y*l,c=d,p=f.m_sweep.c.x+c,w=f.m_sweep.c.y+l,this.m_u2.Set(p-it,w-rt),k=this.m_u2.Length(),k>r.b2_linearSlop?(this.m_u2.x*=1/k,this.m_u2.y*=1/k):this.m_u2.SetZero(),o=this.m_maxLength2-k,g=i.Max(g,-o),o=i.Clamp(o+r.b2_linearSlop,-r.b2_maxLinearCorrection,0),a=-this.m_limitMass2*o,p=-a*this.m_u2.x,w=-a*this.m_u2.y,f.m_sweep.c.x+=f.m_invMass*p,f.m_sweep.c.y+=f.m_invMass*w,f.m_sweep.a+=f.m_invI*(c*w-l*p),f.SynchronizeTransform()),g<r.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2});Box2D.inherit(d,Box2D.Dynamics.Joints.b2JointDef);d.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;d.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.groundAnchorA=new t;this.groundAnchorB=new t;this.localAnchorA=new t;this.localAnchorB=new t};d.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=n.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.lengthA=0;this.maxLengthA=0;this.lengthB=0;this.maxLengthB=0;this.ratio=1;this.collideConnected=!0};d.prototype.Initialize=function(n,t,i,r,u,f,e){var s,h,c,l,a;e===undefined&&(e=0);this.bodyA=n;this.bodyB=t;this.groundAnchorA.SetV(i);this.groundAnchorB.SetV(r);this.localAnchorA=this.bodyA.GetLocalPoint(u);this.localAnchorB=this.bodyB.GetLocalPoint(f);s=u.x-i.x;h=u.y-i.y;this.lengthA=Math.sqrt(s*s+h*h);c=f.x-r.x;l=f.y-r.y;this.lengthB=Math.sqrt(c*c+l*l);this.ratio=e;a=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=a-this.ratio*o.b2_minPulleyLength;this.maxLengthB=(a-o.b2_minPulleyLength)/this.ratio};Box2D.inherit(u,Box2D.Dynamics.Joints.b2Joint);u.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;u.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new l;this.K1=new l;this.K2=new l;this.K3=new l;this.impulse3=new y;this.impulse2=new t;this.reduced=new t;this.m_localAnchor1=new t;this.m_localAnchor2=new t;this.m_impulse=new y;this.m_mass=new ut};u.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};u.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};u.prototype.GetReactionForce=function(n){return n===undefined&&(n=0),new t(n*this.m_impulse.x,n*this.m_impulse.y)};u.prototype.GetReactionTorque=function(n){return n===undefined&&(n=0),n*this.m_impulse.z};u.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};u.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};u.prototype.IsLimitEnabled=function(){return this.m_enableLimit};u.prototype.EnableLimit=function(n){this.m_enableLimit=n};u.prototype.GetLowerLimit=function(){return this.m_lowerAngle};u.prototype.GetUpperLimit=function(){return this.m_upperAngle};u.prototype.SetLimits=function(n,t){n===undefined&&(n=0);t===undefined&&(t=0);this.m_lowerAngle=n;this.m_upperAngle=t};u.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor};u.prototype.EnableMotor=function(n){this.m_enableMotor=n};u.prototype.SetMotorSpeed=function(n){n===undefined&&(n=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=n};u.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};u.prototype.SetMaxMotorTorque=function(n){n===undefined&&(n=0);this.m_maxMotorTorque=n};u.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};u.prototype.b2RevoluteJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA);this.m_localAnchor2.SetV(t.localAnchorB);this.m_referenceAngle=t.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=t.lowerAngle;this.m_upperAngle=t.upperAngle;this.m_maxMotorTorque=t.maxMotorTorque;this.m_motorSpeed=t.motorSpeed;this.m_enableLimit=t.enableLimit;this.m_enableMotor=t.enableMotor;this.m_limitState=n.e_inactiveLimit};u.prototype.InitVelocityConstraints=function(t){var f=this.m_bodyA,e=this.m_bodyB,u,p=0,o,s,h,c,k,v,y;this.m_enableMotor||this.m_enableLimit;u=f.m_xf.R;o=this.m_localAnchor1.x-f.m_sweep.localCenter.x;s=this.m_localAnchor1.y-f.m_sweep.localCenter.y;p=u.col1.x*o+u.col2.x*s;s=u.col1.y*o+u.col2.y*s;o=p;u=e.m_xf.R;h=this.m_localAnchor2.x-e.m_sweep.localCenter.x;c=this.m_localAnchor2.y-e.m_sweep.localCenter.y;p=u.col1.x*h+u.col2.x*c;c=u.col1.y*h+u.col2.y*c;h=p;var w=f.m_invMass,b=e.m_invMass,l=f.m_invI,a=e.m_invI;this.m_mass.col1.x=w+b+s*s*l+c*c*a;this.m_mass.col2.x=-s*o*l-c*h*a;this.m_mass.col3.x=-s*l-c*a;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=w+b+o*o*l+h*h*a;this.m_mass.col3.y=o*l+h*a;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=l+a;this.m_motorMass=1/(l+a);this.m_enableMotor==!1&&(this.m_motorImpulse=0);this.m_enableLimit?(k=e.m_sweep.a-f.m_sweep.a-this.m_referenceAngle,i.Abs(this.m_upperAngle-this.m_lowerAngle)<2*r.b2_angularSlop?this.m_limitState=n.e_equalLimits:k<=this.m_lowerAngle?(this.m_limitState!=n.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=n.e_atLowerLimit):k>=this.m_upperAngle?(this.m_limitState!=n.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=n.e_atUpperLimit):(this.m_limitState=n.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=n.e_inactiveLimit;t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio,v=this.m_impulse.x,y=this.m_impulse.y,f.m_linearVelocity.x-=w*v,f.m_linearVelocity.y-=w*y,f.m_angularVelocity-=l*(o*y-s*v+this.m_motorImpulse+this.m_impulse.z),e.m_linearVelocity.x+=b*v,e.m_linearVelocity.y+=b*y,e.m_angularVelocity+=a*(h*y-c*v+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};u.prototype.SolveVelocityConstraints=function(t){var u=this.m_bodyA,f=this.m_bodyB,r,y=0,p=0,e=0,o=0,s=0,h=0,a=u.m_linearVelocity,c=u.m_angularVelocity,v=f.m_linearVelocity,l=f.m_angularVelocity,w=u.m_invMass,b=f.m_invMass,d=u.m_invI,g=f.m_invI,rt,ut;if(this.m_enableMotor&&this.m_limitState!=n.e_equalLimits){var ft=l-c-this.m_motorSpeed,k=this.m_motorMass*-ft,et=this.m_motorImpulse,it=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=i.Clamp(this.m_motorImpulse+k,-it,it);k=this.m_motorImpulse-et;c-=d*k;l+=g*k}if(this.m_enableLimit&&this.m_limitState!=n.e_inactiveLimit){r=u.m_xf.R;e=this.m_localAnchor1.x-u.m_sweep.localCenter.x;o=this.m_localAnchor1.y-u.m_sweep.localCenter.y;y=r.col1.x*e+r.col2.x*o;o=r.col1.y*e+r.col2.y*o;e=y;r=f.m_xf.R;s=this.m_localAnchor2.x-f.m_sweep.localCenter.x;h=this.m_localAnchor2.y-f.m_sweep.localCenter.y;y=r.col1.x*s+r.col2.x*h;h=r.col1.y*s+r.col2.y*h;s=y;var nt=v.x+-l*h-a.x- -c*o,tt=v.y+l*s-a.y-c*e,ot=l-c;this.m_mass.Solve33(this.impulse3,-nt,-tt,-ot);this.m_limitState==n.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==n.e_atLowerLimit?(p=this.m_impulse.z+this.impulse3.z,p<0&&(this.m_mass.Solve22(this.reduced,-nt,-tt),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==n.e_atUpperLimit&&(p=this.m_impulse.z+this.impulse3.z,p>0&&(this.m_mass.Solve22(this.reduced,-nt,-tt),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0));a.x-=w*this.impulse3.x;a.y-=w*this.impulse3.y;c-=d*(e*this.impulse3.y-o*this.impulse3.x+this.impulse3.z);v.x+=b*this.impulse3.x;v.y+=b*this.impulse3.y;l+=g*(s*this.impulse3.y-h*this.impulse3.x+this.impulse3.z)}else r=u.m_xf.R,e=this.m_localAnchor1.x-u.m_sweep.localCenter.x,o=this.m_localAnchor1.y-u.m_sweep.localCenter.y,y=r.col1.x*e+r.col2.x*o,o=r.col1.y*e+r.col2.y*o,e=y,r=f.m_xf.R,s=this.m_localAnchor2.x-f.m_sweep.localCenter.x,h=this.m_localAnchor2.y-f.m_sweep.localCenter.y,y=r.col1.x*s+r.col2.x*h,h=r.col1.y*s+r.col2.y*h,s=y,rt=v.x+-l*h-a.x- -c*o,ut=v.y+l*s-a.y-c*e,this.m_mass.Solve22(this.impulse2,-rt,-ut),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,a.x-=w*this.impulse2.x,a.y-=w*this.impulse2.y,c-=d*(e*this.impulse2.y-o*this.impulse2.x),v.x+=b*this.impulse2.x,v.y+=b*this.impulse2.y,l+=g*(s*this.impulse2.y-h*this.impulse2.x);u.m_linearVelocity.SetV(a);u.m_angularVelocity=c;f.m_linearVelocity.SetV(v);f.m_angularVelocity=l};u.prototype.SolvePositionConstraints=function(t){var it,p,s,h,c,l,g;t===undefined&&(t=0);var o=0,a,f=this.m_bodyA,e=this.m_bodyB,nt=0,et=0,tt=0,v=0,y=0;this.m_enableLimit&&this.m_limitState!=n.e_inactiveLimit&&(it=e.m_sweep.a-f.m_sweep.a-this.m_referenceAngle,p=0,this.m_limitState==n.e_equalLimits?(o=i.Clamp(it-this.m_lowerAngle,-r.b2_maxAngularCorrection,r.b2_maxAngularCorrection),p=-this.m_motorMass*o,nt=i.Abs(o)):this.m_limitState==n.e_atLowerLimit?(o=it-this.m_lowerAngle,nt=-o,o=i.Clamp(o+r.b2_angularSlop,-r.b2_maxAngularCorrection,0),p=-this.m_motorMass*o):this.m_limitState==n.e_atUpperLimit&&(o=it-this.m_upperAngle,nt=o,o=i.Clamp(o-r.b2_angularSlop,0,r.b2_maxAngularCorrection),p=-this.m_motorMass*o),f.m_sweep.a-=f.m_invI*p,e.m_sweep.a+=e.m_invI*p,f.SynchronizeTransform(),e.SynchronizeTransform());a=f.m_xf.R;s=this.m_localAnchor1.x-f.m_sweep.localCenter.x;h=this.m_localAnchor1.y-f.m_sweep.localCenter.y;tt=a.col1.x*s+a.col2.x*h;h=a.col1.y*s+a.col2.y*h;s=tt;a=e.m_xf.R;c=this.m_localAnchor2.x-e.m_sweep.localCenter.x;l=this.m_localAnchor2.y-e.m_sweep.localCenter.y;tt=a.col1.x*c+a.col2.x*l;l=a.col1.y*c+a.col2.y*l;c=tt;var w=e.m_sweep.c.x+c-f.m_sweep.c.x-s,b=e.m_sweep.c.y+l-f.m_sweep.c.y-h,ot=w*w+b*b,ft=Math.sqrt(ot);et=ft;var k=f.m_invMass,d=e.m_invMass,rt=f.m_invI,ut=e.m_invI,st=10*r.b2_linearSlop;if(ot>st*st){var lt=w/ft,at=b/ft,ct=k+d,ht=1/ct;v=ht*-w;y=ht*-b;g=.5;f.m_sweep.c.x-=g*k*v;f.m_sweep.c.y-=g*k*y;e.m_sweep.c.x+=g*d*v;e.m_sweep.c.y+=g*d*y;w=e.m_sweep.c.x+c-f.m_sweep.c.x-s;b=e.m_sweep.c.y+l-f.m_sweep.c.y-h}return this.K1.col1.x=k+d,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=k+d,this.K2.col1.x=rt*h*h,this.K2.col2.x=-rt*s*h,this.K2.col1.y=-rt*s*h,this.K2.col2.y=rt*s*s,this.K3.col1.x=ut*l*l,this.K3.col2.x=-ut*c*l,this.K3.col1.y=-ut*c*l,this.K3.col2.y=ut*c*c,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(u.tImpulse,-w,-b),v=u.tImpulse.x,y=u.tImpulse.y,f.m_sweep.c.x-=f.m_invMass*v,f.m_sweep.c.y-=f.m_invMass*y,f.m_sweep.a-=f.m_invI*(s*y-h*v),e.m_sweep.c.x+=e.m_invMass*v,e.m_sweep.c.y+=e.m_invMass*y,e.m_sweep.a+=e.m_invI*(c*y-l*v),f.SynchronizeTransform(),e.SynchronizeTransform(),et<=r.b2_linearSlop&&nt<=r.b2_angularSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new t});Box2D.inherit(g,Box2D.Dynamics.Joints.b2JointDef);g.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;g.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new t;this.localAnchorB=new t};g.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=n.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);this.referenceAngle=0;this.lowerAngle=0;this.upperAngle=0;this.maxMotorTorque=0;this.motorSpeed=0;this.enableLimit=!1;this.enableMotor=!1};g.prototype.Initialize=function(n,t,i){this.bodyA=n;this.bodyB=t;this.localAnchorA=this.bodyA.GetLocalPoint(i);this.localAnchorB=this.bodyB.GetLocalPoint(i);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(v,Box2D.Dynamics.Joints.b2Joint);v.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;v.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new t;this.m_localAnchorB=new t;this.m_impulse=new y;this.m_mass=new ut};v.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};v.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};v.prototype.GetReactionForce=function(n){return n===undefined&&(n=0),new t(n*this.m_impulse.x,n*this.m_impulse.y)};v.prototype.GetReactionTorque=function(n){return n===undefined&&(n=0),n*this.m_impulse.z};v.prototype.b2WeldJoint=function(n){this.__super.b2Joint.call(this,n);this.m_localAnchorA.SetV(n.localAnchorA);this.m_localAnchorB.SetV(n.localAnchorB);this.m_referenceAngle=n.referenceAngle;this.m_impulse.SetZero();this.m_mass=new ut};v.prototype.InitVelocityConstraints=function(n){var t,c=0,e=this.m_bodyA,o=this.m_bodyB,i,r,u,f;t=e.m_xf.R;i=this.m_localAnchorA.x-e.m_sweep.localCenter.x;r=this.m_localAnchorA.y-e.m_sweep.localCenter.y;c=t.col1.x*i+t.col2.x*r;r=t.col1.y*i+t.col2.y*r;i=c;t=o.m_xf.R;u=this.m_localAnchorB.x-o.m_sweep.localCenter.x;f=this.m_localAnchorB.y-o.m_sweep.localCenter.y;c=t.col1.x*u+t.col2.x*f;f=t.col1.y*u+t.col2.y*f;u=c;var l=e.m_invMass,a=o.m_invMass,s=e.m_invI,h=o.m_invI;this.m_mass.col1.x=l+a+r*r*s+f*f*h;this.m_mass.col2.x=-r*i*s-f*u*h;this.m_mass.col3.x=-r*s-f*h;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=l+a+i*i*s+u*u*h;this.m_mass.col3.y=i*s+u*h;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=s+h;n.warmStarting?(this.m_impulse.x*=n.dtRatio,this.m_impulse.y*=n.dtRatio,this.m_impulse.z*=n.dtRatio,e.m_linearVelocity.x-=l*this.m_impulse.x,e.m_linearVelocity.y-=l*this.m_impulse.y,e.m_angularVelocity-=s*(i*this.m_impulse.y-r*this.m_impulse.x+this.m_impulse.z),o.m_linearVelocity.x+=a*this.m_impulse.x,o.m_linearVelocity.y+=a*this.m_impulse.y,o.m_angularVelocity+=h*(u*this.m_impulse.y-f*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()};v.prototype.SolveVelocityConstraints=function(){var t,c=0,i=this.m_bodyA,r=this.m_bodyB,l=i.m_linearVelocity,s=i.m_angularVelocity,a=r.m_linearVelocity,h=r.m_angularVelocity,v=i.m_invMass,p=r.m_invMass,w=i.m_invI,b=r.m_invI,u,f,e,o;t=i.m_xf.R;u=this.m_localAnchorA.x-i.m_sweep.localCenter.x;f=this.m_localAnchorA.y-i.m_sweep.localCenter.y;c=t.col1.x*u+t.col2.x*f;f=t.col1.y*u+t.col2.y*f;u=c;t=r.m_xf.R;e=this.m_localAnchorB.x-r.m_sweep.localCenter.x;o=this.m_localAnchorB.y-r.m_sweep.localCenter.y;c=t.col1.x*e+t.col2.x*o;o=t.col1.y*e+t.col2.y*o;e=c;var k=a.x-h*o-l.x+s*f,d=a.y+h*e-l.y-s*u,g=h-s,n=new y;this.m_mass.Solve33(n,-k,-d,-g);this.m_impulse.Add(n);l.x-=v*n.x;l.y-=v*n.y;s-=w*(u*n.y-f*n.x+n.z);a.x+=p*n.x;a.y+=p*n.y;h+=b*(e*n.y-o*n.x+n.z);i.m_angularVelocity=s;r.m_angularVelocity=h};v.prototype.SolvePositionConstraints=function(n){var o,s,h,c,f;n===undefined&&(n=0);var e,v=0,t=this.m_bodyA,u=this.m_bodyB;e=t.m_xf.R;o=this.m_localAnchorA.x-t.m_sweep.localCenter.x;s=this.m_localAnchorA.y-t.m_sweep.localCenter.y;v=e.col1.x*o+e.col2.x*s;s=e.col1.y*o+e.col2.y*s;o=v;e=u.m_xf.R;h=this.m_localAnchorB.x-u.m_sweep.localCenter.x;c=this.m_localAnchorB.y-u.m_sweep.localCenter.y;v=e.col1.x*h+e.col2.x*c;c=e.col1.y*h+e.col2.y*c;h=v;var p=t.m_invMass,w=u.m_invMass,l=t.m_invI,a=u.m_invI,b=u.m_sweep.c.x+h-t.m_sweep.c.x-o,k=u.m_sweep.c.y+c-t.m_sweep.c.y-s,d=u.m_sweep.a-t.m_sweep.a-this.m_referenceAngle,nt=10*r.b2_linearSlop,g=Math.sqrt(b*b+k*k),tt=i.Abs(d);return g>nt&&(l*=1,a*=1),this.m_mass.col1.x=p+w+s*s*l+c*c*a,this.m_mass.col2.x=-s*o*l-c*h*a,this.m_mass.col3.x=-s*l-c*a,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=p+w+o*o*l+h*h*a,this.m_mass.col3.y=o*l+h*a,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=l+a,f=new y,this.m_mass.Solve33(f,-b,-k,-d),t.m_sweep.c.x-=p*f.x,t.m_sweep.c.y-=p*f.y,t.m_sweep.a-=l*(o*f.y-s*f.x+f.z),u.m_sweep.c.x+=w*f.x,u.m_sweep.c.y+=w*f.y,u.m_sweep.a+=a*(h*f.y-c*f.x+f.z),t.SynchronizeTransform(),u.SynchronizeTransform(),g<=r.b2_linearSlop&&tt<=r.b2_angularSlop};Box2D.inherit(nt,Box2D.Dynamics.Joints.b2JointDef);nt.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;nt.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new t;this.localAnchorB=new t};nt.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=n.e_weldJoint;this.referenceAngle=0};nt.prototype.Initialize=function(n,t,i){this.bodyA=n;this.bodyB=t;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}(),function(){var n=Box2D.Dynamics.b2DebugDraw;n.b2DebugDraw=function(){this.m_drawScale=1;this.m_lineThickness=1;this.m_alpha=1;this.m_fillAlpha=1;this.m_xformScale=1;var n=this;this.m_sprite={graphics:{clear:function(){n.m_ctx.clearRect(0,0,n.m_ctx.canvas.width,n.m_ctx.canvas.height)}}}};n.prototype._color=function(n,t){return"rgba("+((n&16711680)>>16)+","+((n&65280)>>8)+","+(n&255)+","+t+")"};n.prototype.b2DebugDraw=function(){this.m_drawFlags=0};n.prototype.SetFlags=function(n){n===undefined&&(n=0);this.m_drawFlags=n};n.prototype.GetFlags=function(){return this.m_drawFlags};n.prototype.AppendFlags=function(n){n===undefined&&(n=0);this.m_drawFlags|=n};n.prototype.ClearFlags=function(n){n===undefined&&(n=0);this.m_drawFlags&=~n};n.prototype.SetSprite=function(n){this.m_ctx=n};n.prototype.GetSprite=function(){return this.m_ctx};n.prototype.SetDrawScale=function(n){n===undefined&&(n=0);this.m_drawScale=n};n.prototype.GetDrawScale=function(){return this.m_drawScale};n.prototype.SetLineThickness=function(n){n===undefined&&(n=0);this.m_lineThickness=n;this.m_ctx.strokeWidth=n};n.prototype.GetLineThickness=function(){return this.m_lineThickness};n.prototype.SetAlpha=function(n){n===undefined&&(n=0);this.m_alpha=n};n.prototype.GetAlpha=function(){return this.m_alpha};n.prototype.SetFillAlpha=function(n){n===undefined&&(n=0);this.m_fillAlpha=n};n.prototype.GetFillAlpha=function(){return this.m_fillAlpha};n.prototype.SetXFormScale=function(n){n===undefined&&(n=0);this.m_xformScale=n};n.prototype.GetXFormScale=function(){return this.m_xformScale};n.prototype.DrawPolygon=function(n,t,i){var r,u,f;if(t){for(r=this.m_ctx,u=this.m_drawScale,r.beginPath(),r.strokeStyle=this._color(i.color,this.m_alpha),r.moveTo(n[0].x*u,n[0].y*u),f=1;f<t;f++)r.lineTo(n[f].x*u,n[f].y*u);r.lineTo(n[0].x*u,n[0].y*u);r.closePath();r.stroke()}};n.prototype.DrawSolidPolygon=function(n,t,i){var r,u,f;if(t){for(r=this.m_ctx,u=this.m_drawScale,r.beginPath(),r.strokeStyle=this._color(i.color,this.m_alpha),r.fillStyle=this._color(i.color,this.m_fillAlpha),r.moveTo(n[0].x*u,n[0].y*u),f=1;f<t;f++)r.lineTo(n[f].x*u,n[f].y*u);r.lineTo(n[0].x*u,n[0].y*u);r.closePath();r.fill();r.stroke()}};n.prototype.DrawCircle=function(n,t,i){if(t){var r=this.m_ctx,u=this.m_drawScale;r.beginPath();r.strokeStyle=this._color(i.color,this.m_alpha);r.arc(n.x*u,n.y*u,t*u,0,Math.PI*2,!0);r.closePath();r.stroke()}};n.prototype.DrawSolidCircle=function(n,t,i,r){if(t){var u=this.m_ctx,f=this.m_drawScale,e=n.x*f,o=n.y*f;u.moveTo(0,0);u.beginPath();u.strokeStyle=this._color(r.color,this.m_alpha);u.fillStyle=this._color(r.color,this.m_fillAlpha);u.arc(e,o,t*f,0,Math.PI*2,!0);u.moveTo(e,o);u.lineTo((n.x+i.x*t)*f,(n.y+i.y*t)*f);u.closePath();u.fill();u.stroke()}};n.prototype.DrawSegment=function(n,t,i){var r=this.m_ctx,u=this.m_drawScale;r.strokeStyle=this._color(i.color,this.m_alpha);r.beginPath();r.moveTo(n.x*u,n.y*u);r.lineTo(t.x*u,t.y*u);r.closePath();r.stroke()};n.prototype.DrawTransform=function(n){var t=this.m_ctx,i=this.m_drawScale;t.beginPath();t.strokeStyle=this._color(16711680,this.m_alpha);t.moveTo(n.position.x*i,n.position.y*i);t.lineTo((n.position.x+this.m_xformScale*n.R.col1.x)*i,(n.position.y+this.m_xformScale*n.R.col1.y)*i);t.strokeStyle=this._color(65280,this.m_alpha);t.moveTo(n.position.x*i,n.position.y*i);t.lineTo((n.position.x+this.m_xformScale*n.R.col2.x)*i,(n.position.y+this.m_xformScale*n.R.col2.y)*i);t.closePath();t.stroke()}}(),i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs;
/*
//# sourceMappingURL=Box2dWeb-2.1.a.3.min.js.map
*/